var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);import{j as s,u as r,a as n,b as a,c as i,d as l,Q as o,e as c}from"./query-vendor-ina_eMrr.js";import{c as d,g as u,a as m,u as x,d as h,O as p,N as f,L as g,b,R as v,e as j,f as y,h as w,B as N}from"./react-vendor-D3k8ZDeC.js";import{c as k,b as C,i as S,a as M,d as T,e as E,f as _}from"./utils-CYWMGOXB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var L,D={};const R=u(function(){if(L)return D;L=1;var e=d();return D.createRoot=e.createRoot,D.hydrateRoot=e.hydrateRoot,D}()),I=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},z=(...e)=>e.filter((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),O=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var A={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const $=m.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:n="",children:a,iconNode:i,...l},o)=>m.createElement("svg",{ref:o,...A,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:z("lucide",n),...!a&&!O(l)&&{"aria-hidden":"true"},...l},[...i.map(([e,t])=>m.createElement(e,t)),...Array.isArray(a)?a:[a]])),B=(e,t)=>{const s=m.forwardRef(({className:s,...r},n)=>{return m.createElement($,{ref:n,iconNode:t,className:z(`lucide-${a=I(e),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...r});var a});return s.displayName=I(e),s},P=B("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),W=B("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),F=B("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),G=B("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),K=B("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),U=B("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),q=B("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),H=B("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),V=B("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),X=B("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Y=B("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),J=B("chromium",[["path",{d:"M10.88 21.94 15.46 14",key:"xkve6t"}],["path",{d:"M21.17 8H12",key:"19dcdn"}],["path",{d:"M3.95 6.06 8.54 14",key:"g8jz9m"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]),Q=B("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Z=B("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ee=B("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),te=B("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),se=B("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),re=B("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),ne=B("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),ae=B("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),ie=B("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),le=B("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),oe=B("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),ce=B("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),de=B("file-code",[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]]),ue=B("file-plus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]),me=B("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),xe=B("folder-input",[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]]),he=B("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),pe=B("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),fe=B("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),ge=B("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),be=B("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),ve=B("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),je=B("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),ye=B("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),we=B("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),Ne=B("list-todo",[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["rect",{x:"3",y:"4",width:"6",height:"6",rx:"1",key:"cif1o7"}]]),ke=B("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Ce=B("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),Se=B("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Me=B("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),Te=B("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Ee=B("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),_e=B("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Le=B("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),De=B("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),Re=B("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Ie=B("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),ze=B("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Oe=B("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Ae=B("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),$e=B("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Be=B("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Pe=B("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),We=B("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Fe=B("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function Ge(e,t){let s;try{s=e()}catch(r){return}return{getItem:e=>{var t;const r=e=>null===e?null:JSON.parse(e,void 0),n=null!=(t=s.getItem(e))?t:null;return n instanceof Promise?n.then(r):r(n)},setItem:(e,t)=>s.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>s.removeItem(e)}}const Ke=e=>t=>{try{const s=e(t);return s instanceof Promise?s:{then:e=>Ke(e)(s),catch(e){return this}}}catch(s){return{then(e){return this},catch:e=>Ke(e)(s)}}},Ue=(e,t)=>(s,r,n)=>{let a={storage:Ge(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const l=new Set,o=new Set;let c=a.storage;if(!c)return e((...e)=>{s(...e)},r,n);const d=()=>{const e=a.partialize({...r()});return c.setItem(a.name,{state:e,version:a.version})},u=n.setState;n.setState=(e,t)=>(u(e,t),d());const m=e((...e)=>(s(...e),d()),r,n);let x;n.getInitialState=()=>m;const h=()=>{var e,t;if(!c)return;i=!1,l.forEach(e=>{var t;return e(null!=(t=r())?t:m)});const n=(null==(t=a.onRehydrateStorage)?void 0:t.call(a,null!=(e=r())?e:m))||void 0;return Ke(c.getItem.bind(c))(a.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===a.version)return[!1,e.state];if(a.migrate){const t=a.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;const[n,i]=e;if(x=a.merge(i,null!=(t=r())?t:m),s(x,!0),n)return d()}).then(()=>{null==n||n(x,void 0),x=r(),i=!0,o.forEach(e=>e(x))}).catch(e=>{null==n||n(void 0,e)})};return n.persist={setOptions:e=>{a={...a,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>h(),hasHydrated:()=>i,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(o.add(e),()=>{o.delete(e)})},a.skipHydration||h(),x||m},qe=k()(Ue(e=>({theme:"undefined"==typeof window?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",colorTheme:"default",setTheme:t=>e({theme:t}),setColorTheme:t=>e({colorTheme:t}),toggleTheme:()=>e(e=>({theme:"light"===e.theme?"dark":"light"}))}),{name:"theme-storage"}));"undefined"!=typeof window&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme-storage")||qe.getState().setTheme(e.matches?"dark":"light")});const He=(...e)=>{},Ve=(...e)=>{};class Xe extends Error{constructor(e,t,s){super(t),this.code=e,this.status=s,this.name="ApiError"}}let Ye=!1,Je=[];const Qe=new class{constructor(e){t(this,"baseURL"),this.baseURL=e}getAuthToken(){return et.getState().accessToken}async request(e,t={}){const s=`${this.baseURL}${e}`;let r=this.getAuthToken();const n=async e=>{const r=new Headers({"Content-Type":"application/json",...t.headers&&"object"==typeof t.headers?t.headers:{}});return e&&!r.get("Authorization")&&r.set("Authorization",`Bearer ${e}`),fetch(s,{...t,headers:r})},a=async()=>{if(Ye)return new Promise((e,t)=>{const s=setTimeout(()=>{t(new Error("Token refresh timeout"))},1e4);var r;r=t=>{clearTimeout(s),e(t)},Je.push(r)});Ye=!0;try{const e=et.getState();await e.refreshAccessToken();const t=e.accessToken;if(t)return function(e){Je.forEach(t=>t(e)),Je=[]}(t),t;throw new Error("Failed to get new token after refresh")}catch(e){throw this.clearAuthAndRedirect(),e}finally{Ye=!1}};try{let e,t=await n(r||"");if(401===t.status)try{const e=await a();e&&(r=e,t=await n(e))}catch{let e;try{const s=await t.text();e=s?JSON.parse(s):{error:{code:"UNAUTHORIZED",message:"Unauthorized"}}}catch{e={error:{code:"UNAUTHORIZED",message:"Unauthorized"}}}const s=e.error||{code:"UNAUTHORIZED",message:"Unauthorized"};throw new Xe(s.code,s.message,t.status)}if(204===t.status)return{data:void 0};try{const s=await t.text();if(!s||""===s.trim()){if(!t.ok)throw new Xe("EMPTY_RESPONSE","Server returned empty response",t.status);return{data:void 0}}e=JSON.parse(s)}catch(i){if(i instanceof Xe)throw i;throw new Xe("INVALID_RESPONSE",`Failed to parse server response: ${i instanceof Error?i.message:"Invalid JSON"}`,t.status)}if(!t.ok){const s=e.error||{code:"UNKNOWN_ERROR",message:"An error occurred"};throw new Xe(s.code,s.message,t.status)}return e}catch(l){if(l instanceof Xe)throw l;throw new Xe("NETWORK_ERROR",l instanceof Error?l.message:"Network request failed",0)}}clearAuthAndRedirect(){const{clearAuth:e}=et.getState();e(),window.location.pathname.includes("/login")||(window.location.href="/login")}async get(e,t){return this.request(e,{...t,method:"GET"})}async post(e,t,s){return this.request(e,{...s,method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t,s){return this.request(e,{...s,method:"PUT",body:t?JSON.stringify(t):void 0})}async patch(e,t,s){return this.request(e,{...s,method:"PATCH",body:t?JSON.stringify(t):void 0})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}}("/api/v1"),Ze={register:async e=>(await Qe.post("/auth/register",e)).data,login:async e=>(await Qe.post("/auth/login",e)).data,refreshToken:async e=>(await Qe.post("/auth/refresh",e)).data,async logout(e,t=!1){await Qe.post("/auth/logout",{refresh_token:e,revoke_all:t})}},et=k()(Ue((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,login:async(t,s,r=!1)=>{e({isLoading:!0});try{const n=await Ze.login({username:t,password:s,remember_me:r});e({user:n.user,accessToken:n.access_token,refreshToken:n.refresh_token,isAuthenticated:!0,isLoading:!1})}catch(n){throw e({isLoading:!1}),n}},register:async(t,s,r)=>{e({isLoading:!0});try{await Ze.register({username:t,password:s,email:r}),e({isLoading:!1})}catch(n){throw e({isLoading:!1}),n}},logout:async(s=!1)=>{const{refreshToken:r,accessToken:n}=t();if(r&&n)try{await Ze.logout(r,s)}catch(a){a instanceof Error&&a.message.includes("Token expired")}e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},refreshAccessToken:async()=>{const{refreshToken:s}=t();if(!s)throw new Error("No refresh token available");try{const t=await Ze.refreshToken({refresh_token:s});e({user:t.user,accessToken:t.access_token,isAuthenticated:!0})}catch(r){throw t().clearAuth(),r}},setUser:t=>{e({user:t})},clearAuth:()=>{e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1})}}),{name:"auth-storage",storage:Ge(()=>localStorage),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}));function tt(){const{theme:e,toggleTheme:t}=qe();return s.jsx("button",{onClick:t,className:"px-3 py-2 rounded-lg border border-border hover:border-primary hover:bg-card/50 transition-all duration-200 flex items-center justify-center gap-2",style:{color:"var(--foreground)"},"aria-label":"切换主题",title:"light"===e?"切换到暗色模式":"切换到亮色模式",children:"light"===e?s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})}):s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})})})}function st(){const{colorTheme:e,setColorTheme:t}=qe();return s.jsx("button",{onClick:()=>{t("default"===e?"orange":"default")},className:"px-3 py-2 rounded-lg border border-border hover:border-primary hover:bg-card/50 transition-all duration-200 flex items-center justify-center gap-2",style:{color:"var(--foreground)"},"aria-label":"切换颜色主题",title:"default"===e?"切换到活力橙":"切换到中性灰",children:"default"===e?s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}):s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})})}function rt(){const e=x(),t=h(),r=[{id:"bookmarks",label:"书签",icon:K,path:"/"},{id:"tab-groups",label:"标签页",icon:we,path:"/tab"},{id:"data",label:"数据",icon:ae,path:"/import-export"},{id:"extension",label:"插件",icon:ie,path:"/extension"}];return s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 sm:hidden",children:[s.jsx("div",{className:"grid grid-cols-4 h-16",children:r.map(r=>{const n=r.icon,a="/"===(i=r.path)?"/"===t.pathname:t.pathname.startsWith(i);var i;return s.jsxs("button",{onClick:()=>e(r.path),className:"flex flex-col items-center justify-center space-y-1 px-2 py-2 transition-colors duration-200 touch-manipulation "+(a?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[s.jsxs("div",{className:"relative",children:[s.jsx(n,{className:"h-5 w-5 "+(a?"text-blue-600 dark:text-blue-400":"")}),r.badge&&r.badge>0&&s.jsx("span",{className:"absolute -top-1 -right-1 h-4 w-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:r.badge>99?"99+":r.badge})]}),s.jsx("span",{className:"text-xs font-medium "+(a?"text-blue-600 dark:text-blue-400":""),children:r.label})]},r.id)})}),s.jsx("div",{className:"h-safe-area-inset-bottom bg-white dark:bg-gray-800"})]})}function nt(){const{theme:e,colorTheme:t}=qe(),r=x(),n=h(),{user:a,logout:i}=et(),[l,o]=m.useState(!1),c=m.useRef(null),d=n.pathname.startsWith("/tab");return m.useEffect(()=>{const e=e=>{c.current&&!c.current.contains(e.target)&&o(!1)};if(l)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]),s.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"var(--background)"},"data-theme":e,"data-color-theme":t,children:[s.jsx("header",{className:"h-16 sm:h-20 sticky top-0 z-50 backdrop-filter backdrop-blur-xl bg-card/80 border-b border-border/50 shadow-float flex items-center",children:s.jsxs("div",{className:"w-full mx-auto px-3 sm:px-6 flex items-center justify-between",children:[s.jsxs("button",{onClick:()=>r("/"),className:"flex items-center gap-2 sm:gap-3 hover:opacity-80 transition-opacity duration-200 focus:outline-none",title:"回到首页",children:[s.jsx("div",{className:"w-9 h-9 sm:w-11 sm:h-11 rounded-lg sm:rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-float",children:s.jsx(K,{className:"w-5 h-5 sm:w-7 sm:h-7",style:{color:"var(--foreground)"}})}),s.jsxs("div",{className:"block text-left",children:[s.jsx("h1",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--primary)"},children:"TMarks"}),s.jsx("p",{className:"text-xs font-medium hidden sm:block",style:{color:"var(--muted-foreground)"},children:d?"管理收纳的标签页组":"智能书签管理"})]})]}),s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-4",children:[s.jsx("button",{onClick:()=>{r(d?"/bookmarks":"/tab")},className:"hidden sm:flex items-center justify-center w-10 h-10 rounded-lg border border-border hover:border-primary hover:bg-card/50 transition-all duration-200",style:{color:"var(--foreground)"},title:d?"切换到书签":"切换到标签页组",children:d?s.jsx(K,{className:"w-5 h-5"}):s.jsx(we,{className:"w-5 h-5"})}),s.jsx(tt,{}),s.jsx(st,{}),a&&s.jsxs("div",{className:"relative",ref:c,children:[s.jsx("button",{onClick:()=>o(!l),className:"px-3 py-2 rounded-lg border border-border hover:border-primary hover:bg-card/50 transition-all duration-200 flex items-center justify-center gap-2",style:{color:"var(--foreground)"},title:a.username,children:s.jsx(Pe,{className:"w-5 h-5"})}),l&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 rounded-lg shadow-lg border border-border overflow-hidden z-50",style:{backgroundColor:"var(--card)"},children:[s.jsxs("button",{onClick:()=>{r("/extension"),o(!1)},className:"w-full px-4 py-3 flex items-center gap-2 hover:bg-muted/50 transition-colors duration-200",style:{color:"var(--foreground)"},children:[s.jsx(ie,{className:"w-4 h-4"}),s.jsx("span",{children:"浏览器插件"})]}),s.jsxs("button",{onClick:()=>{r("/api-keys"),o(!1)},className:"w-full px-4 py-3 flex items-center gap-2 hover:bg-muted/50 transition-colors duration-200",style:{color:"var(--foreground)"},children:[s.jsx(ye,{className:"w-4 h-4"}),s.jsx("span",{children:"API Keys"})]}),s.jsxs("button",{onClick:()=>{r("/share-settings"),o(!1)},className:"w-full px-4 py-3 flex items-center gap-2 hover:bg-muted/50 transition-colors duration-200",style:{color:"var(--foreground)"},children:[s.jsx(Re,{className:"w-4 h-4"}),s.jsx("span",{children:"公开分享"})]}),s.jsxs("button",{onClick:()=>{r("/import-export"),o(!1)},className:"w-full px-4 py-3 flex items-center gap-2 hover:bg-muted/50 transition-colors duration-200",style:{color:"var(--foreground)"},children:[s.jsx(ae,{className:"w-4 h-4"}),s.jsx("span",{children:"数据管理"})]}),s.jsxs("button",{onClick:()=>{r("/permissions"),o(!1)},className:"w-full px-4 py-3 flex items-center gap-2 hover:bg-muted/50 transition-colors duration-200",style:{color:"var(--foreground)"},children:[s.jsx(Ie,{className:"w-4 h-4"}),s.jsx("span",{children:"浏览器权限"})]}),s.jsxs("button",{onClick:async()=>{await i(),r("/login")},className:"w-full px-4 py-3 flex items-center gap-2 hover:bg-muted/50 transition-colors duration-200",style:{color:"var(--foreground)"},children:[s.jsx(Ce,{className:"w-4 h-4"}),s.jsx("span",{children:"登出"})]})]})]})]})]})}),s.jsx("main",{className:"w-full px-3 sm:px-6 pb-16 sm:pb-0",children:s.jsx("div",{className:"mx-auto",style:{maxWidth:"100%"},children:s.jsx(p,{})})}),s.jsx(rt,{})]})}function at(){const{theme:e,colorTheme:t}=qe(),r=x();return s.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"var(--background)"},"data-theme":e,"data-color-theme":t,children:[s.jsx("header",{className:"h-16 sm:h-20 sticky top-0 z-50 backdrop-filter backdrop-blur-xl bg-card/80 border-b border-border/50 shadow-float flex items-center",children:s.jsxs("div",{className:"w-full mx-auto px-3 sm:px-6 flex items-center justify-between",children:[s.jsxs("button",{onClick:()=>r("/"),className:"flex items-center gap-2 sm:gap-3 hover:opacity-80 transition-opacity duration-200 focus:outline-none",title:"回到首页",children:[s.jsx("div",{className:"w-9 h-9 sm:w-11 sm:h-11 rounded-lg sm:rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-float",children:s.jsx(K,{className:"w-5 h-5 sm:w-7 sm:h-7",style:{color:"var(--foreground)"}})}),s.jsxs("div",{className:"block text-left",children:[s.jsx("h1",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--primary)"},children:"TMarks"}),s.jsx("p",{className:"text-xs font-medium hidden sm:block",style:{color:"var(--muted-foreground)"},children:"智能书签管理"})]})]}),s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-4",children:[s.jsx(tt,{}),s.jsx(st,{}),s.jsxs("button",{onClick:()=>{const e=document.createElement("a");e.href="/tmarks-extension.zip",e.download="tmarks-extension.zip",document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"hidden sm:flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-all duration-200 border border-border hover:border-primary hover:bg-card/50",style:{color:"var(--foreground)"},title:"下载浏览器插件",children:[s.jsx(ie,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden md:inline",children:"插件"})]}),s.jsx("button",{onClick:()=>r("/login"),className:"px-3 py-2 sm:px-4 sm:py-2 text-sm font-medium rounded-lg transition-all duration-200 bg-primary text-primary-content hover:bg-primary/90 shadow-float",children:"登录"})]})]})}),s.jsx("main",{className:"w-full px-3 sm:px-6",children:s.jsx("div",{className:"mx-auto",style:{maxWidth:"100%"},children:s.jsx(p,{})})})]})}function it(){return et(e=>e.isAuthenticated)?s.jsx(p,{}):s.jsx(f,{to:"/login",replace:!0})}function lt(){const e=x(),t=et(e=>e.login),r=et(e=>e.isLoading),[n,a]=m.useState(""),[i,l]=m.useState(""),[o,c]=m.useState(!1),[d,u]=m.useState(""),[h,p]=m.useState(!1);return s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-gradient-to-br from-background via-background to-primary/5",children:[s.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[s.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-primary/20 rounded-full blur-3xl"}),s.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-secondary/20 rounded-full blur-3xl"})]}),s.jsxs("div",{className:"card w-full max-w-md shadow-float animate-fade-in relative z-10",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-secondary mb-4 shadow-float",children:s.jsx("svg",{className:"w-10 h-10 text-primary-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),s.jsx("h2",{className:"text-3xl font-bold mb-2 text-primary",children:"欢迎回来"}),s.jsx("p",{className:"text-base-content/60 text-sm",children:"登录到 TMarks 书签管理系统"})]}),d&&s.jsx("div",{className:"mb-6 p-4 bg-error/10 border-2 border-error/30 text-error rounded-xl text-sm shadow-float animate-fade-in",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{children:d})]})}),s.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),u(""),n&&i)try{await t(n,i,o),e("/")}catch(r){u(r instanceof Xe?r.message:"登录失败，请稍后重试")}else u("请输入用户名和密码")},className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"username",className:"block text-sm font-semibold mb-2 text-base-content",children:"用户名或邮箱"}),s.jsx("input",{id:"username",type:"text",className:"input",placeholder:"请输入用户名或邮箱",value:n,onChange:e=>a(e.target.value),disabled:r,autoComplete:"username"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold mb-2 text-base-content",children:"密码"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"password",type:h?"text":"password",className:"input pr-12",placeholder:"请输入密码",value:i,onChange:e=>l(e.target.value),disabled:r,autoComplete:"current-password"}),s.jsx("button",{type:"button",onClick:()=>p(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-base-content/40 hover:text-base-content/70 transition-colors p-1",tabIndex:-1,children:h?s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{id:"remember",type:"checkbox",className:"checkbox mr-3",checked:o,onChange:e=>c(e.target.checked),disabled:r}),s.jsx("label",{htmlFor:"remember",className:"text-sm font-medium cursor-pointer",children:"记住我 30 天"})]}),s.jsx("button",{type:"submit",className:"btn w-full mt-6",disabled:r,children:r?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",fill:"none",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"登录中..."]}):"立即登录"})]}),s.jsx("div",{className:"mt-8 pt-6 border-t border-base-300/50",children:s.jsxs("p",{className:"text-center text-sm text-base-content/60",children:["还没有账号？"," ",s.jsx(g,{to:"/register",className:"text-primary hover:text-primary/80 font-semibold transition-colors",children:"立即注册 →"})]})})]})]})}function ot(){const e=x(),t=et(e=>e.register),r=et(e=>e.isLoading),[n,a]=m.useState(""),[i,l]=m.useState(""),[o,c]=m.useState(""),[d,u]=m.useState(""),[h,p]=m.useState(""),[f,b]=m.useState(!1),[v,j]=m.useState(!1),[y,w]=m.useState(!1);return f?s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-gradient-to-br from-background via-background to-primary/5",children:[s.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[s.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-primary/20 rounded-full blur-3xl"}),s.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-secondary/20 rounded-full blur-3xl"})]}),s.jsxs("div",{className:"card w-full max-w-md text-center shadow-float animate-fade-in relative z-10",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-3xl bg-success mb-6 shadow-float mx-auto",children:s.jsx("svg",{className:"w-12 h-12 text-success-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-3xl font-bold mb-3 text-success",children:"注册成功！"}),s.jsx("p",{className:"text-base-content/60 text-lg",children:"即将跳转到登录页面..."}),s.jsx("div",{className:"mt-6 flex justify-center",children:s.jsx("div",{className:"animate-spin w-6 h-6 border-3 border-primary border-t-transparent rounded-full"})})]})]}):s.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 py-8 relative overflow-hidden bg-gradient-to-br from-background via-background to-primary/5",children:[s.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[s.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-primary/20 rounded-full blur-3xl"}),s.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-accent/10 rounded-full blur-3xl"}),s.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-secondary/20 rounded-full blur-3xl"})]}),s.jsxs("div",{className:"card w-full max-w-lg shadow-float animate-fade-in relative z-10",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-secondary mb-4 shadow-float",children:s.jsx("svg",{className:"w-10 h-10 text-primary-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),s.jsx("h2",{className:"text-3xl font-bold mb-2 text-primary",children:"加入 TMarks"}),s.jsx("p",{className:"text-base-content/60 text-sm",children:"开始你的智能书签管理之旅"})]}),h&&s.jsx("div",{className:"mb-6 p-4 bg-error/10 border-2 border-error/30 text-error rounded-xl text-sm shadow-float animate-fade-in",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{children:h})]})}),s.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),p(""),n&&o)if(n.length<3||n.length>20)p("用户名长度应为 3-20 个字符");else if(/^[a-zA-Z0-9_]+$/.test(n))if(o.length<8)p("密码至少需要 8 个字符");else if(o===d)if(!i||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))try{await t(n,o,i||void 0),b(!0),setTimeout(()=>{e("/login")},2e3)}catch(r){p(r instanceof Xe?r.message:"注册失败，请稍后重试")}else p("邮箱格式不正确");else p("两次输入的密码不一致");else p("用户名只能包含字母、数字和下划线");else p("请输入用户名和密码")},className:"space-y-5",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"username",className:"block text-sm font-semibold mb-2 text-base-content",children:["用户名 ",s.jsx("span",{className:"text-error text-base",children:"*"})]}),s.jsx("input",{id:"username",type:"text",className:"input",placeholder:"3-20个字符，字母数字下划线",value:n,onChange:e=>a(e.target.value),disabled:r,autoComplete:"username"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"email",className:"block text-sm font-semibold mb-2 text-base-content",children:["邮箱"," ",s.jsx("span",{className:"text-xs font-normal text-base-content/50",children:"(可选，用于密码找回)"})]}),s.jsx("input",{id:"email",type:"email",className:"input",placeholder:"your@email.com",value:i,onChange:e=>l(e.target.value),disabled:r,autoComplete:"email"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"password",className:"block text-sm font-semibold mb-2 text-base-content",children:["密码 ",s.jsx("span",{className:"text-error text-base",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"password",type:v?"text":"password",className:"input pr-12",placeholder:"至少8个字符",value:o,onChange:e=>c(e.target.value),disabled:r,autoComplete:"new-password"}),s.jsx("button",{type:"button",onClick:()=>j(!v),className:"absolute right-3 top-1/2 -translate-y-1/2 text-base-content/40 hover:text-base-content/70 transition-colors p-1",tabIndex:-1,children:v?s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold mb-2 text-base-content",children:["确认密码 ",s.jsx("span",{className:"text-error text-base",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"confirmPassword",type:y?"text":"password",className:"input pr-12",placeholder:"再次输入",value:d,onChange:e=>u(e.target.value),disabled:r,autoComplete:"new-password"}),s.jsx("button",{type:"button",onClick:()=>w(!y),className:"absolute right-3 top-1/2 -translate-y-1/2 text-base-content/40 hover:text-base-content/70 transition-colors p-1",tabIndex:-1,children:y?s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]})]}),s.jsx("button",{type:"submit",className:"btn w-full mt-6",disabled:r,children:r?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",fill:"none",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"注册中..."]}):"立即注册"})]}),s.jsx("div",{className:"mt-8 pt-6 border-t border-base-300/50",children:s.jsxs("p",{className:"text-center text-sm text-base-content/60",children:["已有账号？"," ",s.jsx(g,{to:"/login",className:"text-primary hover:text-primary/80 font-semibold transition-colors",children:"立即登录 →"})]})})]})]})}const ct={async getTags(e){const t=new URLSearchParams;(null==e?void 0:e.sort)&&t.set("sort",e.sort);const s=t.toString(),r=s?`/tags?${s}`:"/tags";return(await Qe.get(r)).data},createTag:async e=>(await Qe.post("/tags",e)).data.tag,updateTag:async(e,t)=>(await Qe.patch(`/tags/${e}`,t)).data.tag,async deleteTag(e){await Qe.delete(`/tags/${e}`)}},dt="tags";function ut(e,t){return r({queryKey:[dt,e],queryFn:()=>ct.getTags(e),staleTime:(null==t?void 0:t.staleTime)||3e5,gcTime:(null==t?void 0:t.gcTime)||6e5,refetchOnWindowFocus:!1,enabled:(null==t?void 0:t.enabled)??!0})}function mt(){const e=n();return a({mutationFn:e=>ct.createTag(e),onSuccess:()=>{e.invalidateQueries({queryKey:[dt]})}})}function xt({isOpen:e,title:t="确认",message:r,confirmText:n="确定",cancelText:a="取消",type:i="warning",onConfirm:l,onCancel:o}){m.useEffect(()=>(document.body.style.overflow=e?"hidden":"",()=>{document.body.style.overflow=""}),[e]);const c=()=>{o()};if(!e)return null;const d=(()=>{switch(i){case"error":return{bg:"bg-error/10",icon:"bg-error text-error-content",iconRing:"ring-error/20"};case"warning":return{bg:"bg-warning/10",icon:"bg-warning text-warning-content",iconRing:"ring-warning/20"};case"success":return{bg:"bg-success/10",icon:"bg-success text-success-content",iconRing:"ring-success/20"};default:return{bg:"bg-info/10",icon:"bg-info text-info-content",iconRing:"ring-info/20"}}})();return s.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-fade-in",children:[s.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:c}),s.jsxs("div",{className:"relative card rounded-3xl shadow-2xl border max-w-md w-full animate-scale-in",style:{backgroundColor:"var(--card)",borderColor:"var(--border)"},children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsxs("div",{className:`w-16 h-16 rounded-2xl ${d.icon} ${d.iconRing} ring-8 flex items-center justify-center shadow-lg`,children:["error"===i&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),"warning"===i&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"success"===i&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"info"===i&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})}),s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h3",{className:"font-bold text-2xl mb-3 text-foreground",children:t}),s.jsx("p",{className:"text-base text-muted-foreground leading-relaxed",children:r})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:c,className:"btn btn-outline flex-1",children:a}),s.jsx("button",{onClick:()=>{l()},className:"btn flex-1",children:n})]})]})]})}function ht({isOpen:e,title:t="提示",message:r,confirmText:n="确定",type:a="info",onConfirm:i}){m.useEffect(()=>(document.body.style.overflow=e?"hidden":"",()=>{document.body.style.overflow=""}),[e]);const l=()=>{i()};if(!e)return null;const o=(()=>{switch(a){case"error":return{bg:"bg-error/10",icon:"bg-error text-error-content",iconRing:"ring-error/20"};case"warning":return{bg:"bg-warning/10",icon:"bg-warning text-warning-content",iconRing:"ring-warning/20"};case"success":return{bg:"bg-success/10",icon:"bg-success text-success-content",iconRing:"ring-success/20"};default:return{bg:"bg-info/10",icon:"bg-info text-info-content",iconRing:"ring-info/20"}}})();return s.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-fade-in",children:[s.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:l}),s.jsxs("div",{className:"relative card rounded-3xl shadow-2xl border max-w-md w-full animate-scale-in",style:{backgroundColor:"var(--card)",borderColor:"var(--border)"},children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsxs("div",{className:`w-16 h-16 rounded-2xl ${o.icon} ${o.iconRing} ring-8 flex items-center justify-center shadow-lg`,children:["error"===a&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),"warning"===a&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"success"===a&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"info"===a&&s.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})}),s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h3",{className:"font-bold text-2xl mb-3 text-foreground",children:t}),s.jsx("p",{className:"text-base text-muted-foreground leading-relaxed",children:r})]}),s.jsx("button",{onClick:l,className:"btn w-full",children:n})]})]})}function pt({isOpen:e,title:t,initialName:r,onConfirm:n,onCancel:a,confirmLabel:i="保存",isSubmitting:l=!1,onDelete:o,isDeleting:c=!1}){const[d,u]=m.useState(r);return m.useEffect(()=>{e&&u(r)},[r,e]),e?s.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[s.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:a}),s.jsxs("div",{className:"relative w-full max-w-sm card p-5 space-y-4 animate-scale-in border border-border shadow-2xl rounded-xl",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-semibold mb-1",children:t}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"调整标签名称，仅影响当前标签。"})]}),s.jsxs("div",{className:"space-y-1.5",children:[s.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"标签名称"}),s.jsx("input",{type:"text",className:"input w-full",value:d,onChange:e=>u(e.target.value),placeholder:"输入标签名称",autoFocus:!0,onKeyDown:e=>{"Enter"!==e.key||l||n(d.trim()),"Escape"===e.key&&a()}})]}),s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[o?s.jsx("button",{type:"button",className:"btn btn-sm btn-error",onClick:o,disabled:l||c,children:c?"删除中...":"删除标签"}):s.jsx("span",{}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-outline",onClick:a,disabled:l||c,children:"取消"}),s.jsx("button",{type:"button",className:"btn btn-sm",onClick:()=>n(d.trim()),disabled:!d.trim()||l||c,children:l?"保存中...":i})]})]})]})]}):null}function ft({tags:e,onClose:t}){const[r,i]=m.useState(null),[l,o]=m.useState(""),[c,d]=m.useState(!1),[u,x]=m.useState(null),[h,p]=m.useState(!1),[f,g]=m.useState(""),[b,v]=m.useState(!1),[j,y]=m.useState(""),[w,N]=m.useState(!1),k=function(){const e=n();return a({mutationFn:e=>ct.deleteTag(e),onSuccess:()=>{e.invalidateQueries({queryKey:[dt]}),e.invalidateQueries({queryKey:["bookmarks"]})}})}(),C=function(){const e=n();return a({mutationFn:({id:e,data:t})=>ct.updateTag(e,t),onSuccess:()=>{e.invalidateQueries({queryKey:[dt]})}})}(),S=m.useMemo(()=>[...e].sort((e,t)=>(t.bookmark_count||0)-(e.bookmark_count||0)),[e]);return s.jsxs("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center p-4 animate-fade-in bg-background/80 backdrop-blur-sm",children:[s.jsx("div",{className:"absolute inset-0",onClick:t}),s.jsxs("div",{className:"relative card rounded-2xl shadow-2xl max-w-2xl w-full max-h-[85vh] flex flex-col border border-border animate-scale-in",style:{padding:0},children:[s.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-border",children:[s.jsxs("div",{className:"flex items-center gap-2.5",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-md",children:s.jsx("svg",{className:"w-5 h-5 text-primary-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-bold text-foreground",children:"标签管理"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"编辑标签名称或删除不需要的标签"})]})]}),s.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg hover:bg-muted flex items-center justify-center transition-colors text-muted-foreground/60 hover:text-foreground",title:"关闭",children:s.jsx("svg",{className:"w-4.5 h-4.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto px-5 py-3",children:0===S.length?s.jsxs("div",{className:"text-center py-12 text-muted-foreground/60",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-3",children:s.jsx("svg",{className:"w-8 h-8 text-muted-foreground/30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}),s.jsx("p",{className:"text-sm font-medium mb-1 text-foreground",children:"暂无标签"}),s.jsx("p",{className:"text-xs text-muted-foreground/50",children:"点击 + 按钮创建第一个标签"})]}):s.jsx("div",{className:"columns-1 sm:columns-2 lg:columns-3 gap-2.5 space-y-2.5",children:S.map((e,t)=>s.jsx("div",{className:"break-inside-avoid cursor-pointer group",style:{animationDelay:30*t+"ms"},onClick:()=>(e=>{i(e),o(e.name),N(!0)})(e),children:s.jsxs("div",{className:"relative rounded-xl border border-border bg-card/95 shadow-sm hover:shadow-md hover:shadow-primary/10 transition-all duration-200 hover:-translate-y-0.5",children:[s.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx("button",{type:"button",className:"w-7 h-7 rounded-full bg-primary/10 text-primary flex items-center justify-center",title:"编辑标签",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})}),s.jsx("div",{className:"p-3.5 space-y-2",children:s.jsxs("div",{className:"space-y-0.5",children:[s.jsx("h3",{className:"text-base font-semibold text-foreground truncate",children:e.name}),void 0!==e.bookmark_count&&s.jsx("p",{className:"text-xs text-muted-foreground/70",children:0===e.bookmark_count?"暂无关联书签":`${e.bookmark_count} 个关联书签`})]})})]})},e.id))})}),s.jsx("div",{className:"px-5 py-3 border-t border-border bg-muted/30",children:s.jsx("button",{onClick:t,className:"btn w-full",children:"完成"})})]}),s.jsx(xt,{isOpen:c,title:"删除标签",message:`确定要删除标签"${null==u?void 0:u.name}"吗？关联的书签不会被删除。`,type:"warning",onConfirm:async()=>{if(u){d(!1);try{await k.mutateAsync(u.id),(null==r?void 0:r.id)===u.id&&(i(null),N(!1),o("")),g("标签已成功删除"),p(!0)}catch(e){y("删除失败，请重试"),v(!0)}finally{x(null)}}},onCancel:()=>{d(!1),x(null)}}),s.jsx(ht,{isOpen:h,title:"操作成功",message:f,type:"success",onConfirm:()=>p(!1)}),s.jsx(ht,{isOpen:b,title:"操作失败",message:j,type:"error",onConfirm:()=>v(!1)}),s.jsx(pt,{isOpen:w&&Boolean(r),title:"编辑标签",initialName:(null==r?void 0:r.name)??"",onConfirm:e=>(async e=>{if(!r)return;const t=(null==e?void 0:e.trim())??l.trim();if(t)try{await C.mutateAsync({id:r.id,data:{name:t}}),i(null),o(""),N(!1),g("标签已成功更新"),p(!0)}catch(s){y("更新失败，请重试"),v(!0)}})(e),onCancel:()=>{i(null),o(""),N(!1)},confirmLabel:"保存",isSubmitting:C.isPending,onDelete:()=>{r&&(x(r),d(!0))},isDeleting:k.isPending})]})}function gt({selectedTags:e,onTagsChange:t,bookmarks:r,tagLayout:n,onTagLayoutChange:a,readOnly:i=!1,availableTags:l,tagSortBy:o,onTagSortChange:c}){const[d,u]=m.useState(!1),[x,h]=m.useState(!1),[p,f]=m.useState(""),[g,b]=m.useState(""),[v,j]=m.useState(""),[y,w]=m.useState("usage"),N=m.useRef(null),k=void 0!==o?o:y,C=c||w,{data:S,isLoading:M}=ut({sort:k},{enabled:!l}),T=mt(),E=m.useMemo(()=>l||(null==S?void 0:S.tags)||[],[l,null==S?void 0:S.tags]),_=!l&&M;m.useEffect(()=>{const e=setTimeout(()=>{j(g)},200);return()=>clearTimeout(e)},[g]),m.useEffect(()=>(N.current&&(clearTimeout(N.current),N.current=null),g.trim()&&(N.current=setTimeout(()=>{b(""),j("")},15e3)),()=>{N.current&&(clearTimeout(N.current),N.current=null)}),[g]);const L=m.useMemo(()=>{const e=new Map;for(const t of r){if(!t.tags||t.tags.length<2)continue;const s=t.tags.reduce((e,t)=>(t.id&&e.push(t.id),e),[]);if(!(s.length<2))for(let t=0;t<s.length;t++){const r=s[t];e.has(r)||e.set(r,new Set);for(let n=0;n<s.length;n++){if(t===n)continue;const a=s[n];e.get(r).add(a)}}}return e},[r]),D=m.useMemo(()=>{if(0===e.length)return new Set;if(1===e.length){const t=L.get(e[0]);return t?new Set([...t].filter(t=>!e.includes(t))):new Set}const t=L.get(e[0]);if(!t)return new Set;const s=new Set;return t.forEach(t=>{if(e.includes(t))return;e.every(e=>{const s=L.get(e);return s&&s.has(t)})&&s.add(t)}),s},[e,L]),R=m.useMemo(()=>{if(!v.trim())return E;const e=v.toLowerCase();return E.filter(t=>t.name.toLowerCase().includes(e))},[E,v]),I=m.useMemo(()=>{const t=[],s=[],r=[];for(const n of R)e.includes(n.id)?t.push(n):D.has(n.id)?s.push(n):r.push(n);return[...t,...s,...r]},[R,e,D]);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"card flex flex-col h-full shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[s.jsx("h3",{className:"text-lg sm:text-xl font-bold text-primary",children:"标签"}),!i&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>h(!0),className:"w-8 h-8 sm:w-9 sm:h-9 rounded-xl flex items-center justify-center transition-all shadow-float bg-muted hover:bg-secondary text-foreground touch-manipulation",title:"管理标签",children:s.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),s.jsx("button",{onClick:()=>u(!d),className:"w-8 h-8 sm:w-9 sm:h-9 rounded-xl flex items-center justify-center font-bold text-lg sm:text-xl transition-all shadow-float touch-manipulation "+(d?"bg-error text-error-content rotate-45":"bg-gradient-to-br from-primary to-secondary text-primary-content"),title:d?"取消":"新建标签",children:"+"})]})]}),!i&&d&&s.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!i&&p.trim())try{await T.mutateAsync({name:p.trim()}),f(""),u(!1)}catch(t){}},className:"mb-4 sm:mb-5 animate-fade-in",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"input flex-1 h-10 sm:h-auto text-sm sm:text-base",placeholder:"输入标签名称...",value:p,onChange:e=>f(e.target.value),autoFocus:!0}),s.jsx("button",{type:"submit",className:"btn btn-sm w-10 h-10 sm:w-auto sm:h-auto touch-manipulation",disabled:T.isPending,children:T.isPending?"...":"✓"})]})}),s.jsxs("div",{className:"mb-4 sm:mb-5 space-y-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx("svg",{className:"absolute left-3 sm:left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/40 pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),s.jsx("input",{type:"text",className:"input w-full pl-10 sm:pl-11 h-10 sm:h-auto text-sm sm:text-base",placeholder:"搜索标签...",value:g,onChange:e=>b(e.target.value)})]}),s.jsxs("div",{className:"inline-flex items-center justify-between w-full rounded-xl bg-muted p-1",children:[s.jsx("button",{onClick:()=>C("usage"),className:"flex-1 py-2 px-2 rounded-lg transition-all flex items-center justify-center "+("usage"===k?"bg-primary text-primary-content shadow-float":"text-muted-foreground/70 hover:text-foreground"),title:"使用频率排序","aria-label":"使用频率排序",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),s.jsx("button",{onClick:()=>C("name"),className:"flex-1 py-2 px-2 rounded-lg transition-all flex items-center justify-center "+("name"===k?"bg-primary text-primary-content shadow-float":"text-muted-foreground/70 hover:text-foreground"),title:"字母序排序","aria-label":"字母序排序",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})})}),s.jsx("button",{onClick:()=>a("grid"),className:"flex-1 py-2 px-2 rounded-lg transition-all flex items-center justify-center "+("grid"===n?"bg-secondary text-secondary-content shadow-float":"text-muted-foreground/70 hover:text-foreground"),title:"标准网格","aria-label":"标准网格",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 5h6v6H4zM14 5h6v6h-6zM4 15h6v6H4zM14 15h6v6h-6z"})})}),s.jsx("button",{onClick:()=>a("masonry"),className:"flex-1 py-2 px-2 rounded-lg transition-all flex items-center justify-center "+("masonry"===n?"bg-secondary text-secondary-content shadow-float":"text-muted-foreground/70 hover:text-foreground"),title:"标题横向瀑布","aria-label":"标题横向瀑布",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4h5v16H4zM10 10h5v10h-5zM16 6h5v14h-5z"})})}),s.jsx("button",{onClick:()=>t([]),disabled:0===e.length,className:"flex-1 py-2 px-2 rounded-lg transition-all flex items-center justify-center "+(0===e.length?"text-muted-foreground/50 cursor-not-allowed":"text-muted-foreground/80 hover:text-foreground hover:bg-base-200"),title:"清空选中标签","aria-label":"清空选中标签",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-1",children:[_&&s.jsxs("div",{className:"text-center py-8 text-muted-foreground/60 text-sm",children:[s.jsxs("svg",{className:"animate-spin h-6 w-6 mx-auto mb-2",viewBox:"0 0 24 24",fill:"none",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"加载中..."]}),!_&&0===R.length&&s.jsxs("div",{className:"text-center py-12 text-muted-foreground/60",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),s.jsx("p",{className:"text-sm",children:g?"没有找到匹配的标签":i?"发布者尚未公开任何标签":"暂无标签，点击 + 创建"})]}),!_&&I.length>0&&s.jsx("div",{className:""+("masonry"===n?"flex flex-wrap items-start gap-2 justify-around":"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 justify-center"),children:I.map(r=>s.jsx(bt,{tag:r,isSelected:e.includes(r.id),isRelated:D.has(r.id),hasSelection:e.length>0,layout:n,onToggle:()=>(s=>{let r;r=e.includes(s)?e.filter(e=>e!==s):[...e,s],t(r)})(r.id)},r.id))})]})]}),!i&&x&&s.jsx(ft,{tags:E,onClose:()=>h(!1)})]})}function bt({tag:e,isSelected:t,isRelated:r,hasSelection:n,layout:a,onToggle:i}){const l=t?"border border-transparent bg-primary text-primary-content shadow-inner ring-1 ring-primary/40":r?"border border-transparent bg-accent/5 text-accent":n?"border border-transparent bg-base-200/80 text-muted-foreground opacity-70 ring-1 ring-transparent":"border border-border bg-card hover:border-primary/50 ring-1 ring-transparent",o=t?"bg-primary-content/20 border-2 border-primary-content":r?"bg-accent/20 border-2 border-accent":"bg-transparent border-2 border-border",c=t?"bg-primary-content/25 text-primary-content":r?"bg-accent/20 text-accent":n?"bg-base-300 text-muted-foreground":"bg-muted text-muted-foreground",d="masonry"===a?"inline-flex items-center gap-2 px-3 py-2 rounded-lg":"flex w-full items-center justify-between px-2.5 py-2",u=t||r,m=t?"var(--accent)":"var(--primary)",x=t?.9:.65,h=t?"1s":"3s";return s.jsxs("div",{className:`relative overflow-hidden rounded-lg cursor-pointer transition-all ${l}`,onClick:i,children:[u&&s.jsxs("div",{className:"pointer-events-none absolute inset-0 z-0 rounded-lg overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 h-0.5",style:{background:`repeating-linear-gradient(90deg,\n                ${m} 0px,\n                ${m} 8px,\n                transparent 8px,\n                transparent 12px)`,opacity:x,animation:`tag-marquee-move-right ${h} linear infinite`}}),s.jsx("div",{className:"absolute top-0 right-0 bottom-0 w-0.5",style:{background:`repeating-linear-gradient(0deg,\n                ${m} 0px,\n                ${m} 8px,\n                transparent 8px,\n                transparent 12px)`,opacity:x,animation:`tag-marquee-move-down ${h} linear infinite`}}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5",style:{background:`repeating-linear-gradient(-90deg,\n                ${m} 0px,\n                ${m} 8px,\n                transparent 8px,\n                transparent 12px)`,opacity:x,animation:`tag-marquee-move-left ${h} linear infinite`}}),s.jsx("div",{className:"absolute top-0 left-0 bottom-0 w-0.5",style:{background:`repeating-linear-gradient(180deg,\n                ${m} 0px,\n                ${m} 8px,\n                transparent 8px,\n                transparent 12px)`,opacity:x,animation:`tag-marquee-move-up ${h} linear infinite`}})]}),s.jsx("div",{className:`relative z-10 ${d}`,children:s.jsxs("div",{className:"flex items-center gap-2 "+("masonry"===a?"":"flex-1 min-w-0"),children:[s.jsx("div",{className:`w-3.5 h-3.5 rounded flex-shrink-0 flex items-center justify-center ${o}`,children:t&&s.jsx("svg",{className:"w-2 h-2 text-primary-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.5,d:"M5 13l4 4L19 7"})})}),s.jsx("span",{className:`text-xs ${"masonry"===a?"whitespace-nowrap":"truncate flex-1"} ${t?"font-semibold":"font-medium"}`,children:e.name}),void 0!==e.bookmark_count&&s.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${c}`,children:e.bookmark_count})]})})]})}const vt={async getBookmarks(e){const t=new URLSearchParams;(null==e?void 0:e.keyword)&&t.set("keyword",e.keyword),(null==e?void 0:e.tags)&&t.set("tags",e.tags),(null==e?void 0:e.page_size)&&t.set("page_size",e.page_size.toString()),(null==e?void 0:e.page_cursor)&&t.set("page_cursor",e.page_cursor),(null==e?void 0:e.sort)&&t.set("sort",e.sort),void 0!==(null==e?void 0:e.archived)&&t.set("archived",e.archived.toString()),void 0!==(null==e?void 0:e.pinned)&&t.set("pinned",e.pinned.toString());const s=t.toString(),r=s?`/bookmarks?${s}`:"/bookmarks";return(await Qe.get(r)).data},createBookmark:async e=>(await Qe.post("/bookmarks",e)).data.bookmark,updateBookmark:async(e,t)=>(await Qe.patch(`/bookmarks/${e}`,t)).data.bookmark,async deleteBookmark(e){await Qe.delete(`/bookmarks/${e}`)},restoreBookmark:async e=>(await Qe.put(`/bookmarks/${e}`)).data.bookmark,recordClick:async e=>(await Qe.post(`/bookmarks/${e}/click`)).data,batchAction:async e=>(await Qe.patch("/bookmarks/bulk",e)).data,checkUrlExists:async e=>(await Qe.get(`/bookmarks/check-url?url=${encodeURIComponent(e)}`)).data},jt="bookmarks";function yt(){return a({mutationFn:e=>vt.recordClick(e)})}function wt({bookmarks:e,onEdit:t,readOnly:r=!1}){const n=m.useRef(null),a=e.length>200,i=l({count:e.length,getScrollElement:()=>n.current,estimateSize:()=>150,overscan:5,enabled:a});return s.jsxs("div",{ref:n,className:"space-y-2 sm:space-y-3 scrollbar-hide",style:a?{height:"600px",overflow:"auto"}:void 0,children:[a&&s.jsx("div",{style:{height:`${i.getTotalSize()}px`,width:"100%",position:"relative"},children:i.getVirtualItems().map(n=>{const a=e[n.index];return a?s.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${n.start}px)`},children:s.jsx(Nt,{bookmark:a,onEdit:t?()=>t(a):void 0,readOnly:r})},a.id):null})}),!a&&e.map(e=>s.jsx(Nt,{bookmark:e,onEdit:t?()=>t(e):void 0,readOnly:r},e.id))]})}const Nt=m.memo(function({bookmark:e,onEdit:t,readOnly:r=!1}){const n=yt();return s.jsxs("div",{className:"card hover:shadow-lg transition-all relative group mb-2 sm:mb-3 touch-manipulation",children:[!!t&&!r&&s.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),t()},className:"absolute top-2 right-2 sm:top-3 sm:right-3 w-9 h-9 sm:w-8 sm:h-8 rounded-lg bg-card hover:bg-muted backdrop-blur-sm flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all hover:scale-110 shadow-lg z-10 touch-manipulation",title:"编辑",children:s.jsx("svg",{className:"w-4 h-4 text-base-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.cover_image&&s.jsx("div",{className:"flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-base-200",children:s.jsx("img",{src:e.cover_image,alt:e.title,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.style.display="none"}})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("div",{className:"flex items-start justify-between gap-2",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"font-semibold text-base mb-1 flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{r||n.mutate(e.id),window.open(e.url,"_blank","noopener,noreferrer")},className:"hover:text-primary transition-colors text-left",style:{display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-word"},title:e.title,children:e.title}),!!e.is_pinned&&s.jsx("span",{className:"bg-warning text-warning-content text-xs px-2 py-0.5 rounded-full font-medium",title:"已置顶",children:"置顶"}),!!e.is_archived&&s.jsx("span",{className:"bg-base-content/40 text-card text-xs px-2 py-0.5 rounded-full font-medium",title:"已归档",children:"归档"})]}),s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline block mb-2",style:{display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-all"},children:e.url}),e.description&&s.jsx("p",{className:"text-sm text-base-content/70 line-clamp-2 mb-2",children:e.description}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.tags.map(e=>s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:e.name},e.id))})]})})})]})]})});async function kt(e){try{const t=await function(e){return new Promise((t,s)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>t(r),r.onerror=()=>s(new Error("Failed to load image")),r.src=e})}(e);return{type:function(e,t){if(0===e||0===t)return"unknown";const s=e/t;return s>=.8&&s<=1.25?"favicon":s>1.25?"cover":"unknown"}(t.naturalWidth,t.naturalHeight),width:t.naturalWidth,height:t.naturalHeight,aspectRatio:t.naturalWidth/t.naturalHeight}}catch{return{type:"unknown",width:0,height:0,aspectRatio:0}}}const Ct=m.memo(function({src:e,alt:t,className:r="",onTypeDetected:n}){const[a,i]=m.useState("unknown"),[l,o]=m.useState(!1),[c,d]=m.useState(!1);m.useEffect(()=>{let t=!1;return kt(e).then(e=>{t||(i(e.type),null==n||n(e.type))}).catch(()=>{t||(i("unknown"),d(!0))}),()=>{t=!0}},[e,n]);const u=m.useCallback(()=>{o(!0),d(!1)},[]),x=m.useCallback(()=>{d(!0),o(!1)},[]);return c?null:s.jsx("img",{src:e,alt:t,className:`${r} ${l?"opacity-100":"opacity-0"} transition-opacity duration-200`,"data-image-type":a,onLoad:u,onError:x})});function St({bookmarks:e,onEdit:t,readOnly:r=!1}){const n=m.useRef(null),[a,i]=m.useState(1);return m.useEffect(()=>{const e=()=>{if(!n.current)return;const e=n.current.offsetWidth;let t=1;for(let s=1;s<=4;s++){if(!(e>=280*s+16*(s-1)))break;t=s}i(t)};e();const t=new ResizeObserver(e);return n.current&&t.observe(n.current),()=>{t.disconnect()}},[]),s.jsx("div",{ref:n,className:"gap-3 sm:gap-4",style:{columnCount:a,columnGap:"1rem"},children:e.map(e=>s.jsx("div",{className:"break-inside-avoid mb-3 sm:mb-4",children:s.jsx(Mt,{bookmark:e,onEdit:t?()=>t(e):void 0,readOnly:r})},e.id))})}function Mt({bookmark:e,onEdit:t,readOnly:r=!1}){const[n,a]=m.useState("unknown"),i=yt(),l=()=>{r||i.mutate(e.id),window.open(e.url,"_blank","noopener,noreferrer")};return s.jsxs("div",{className:"card hover:shadow-xl transition-all relative group flex flex-col cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary/60 touch-manipulation",role:"link",tabIndex:0,onClick:l,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l())},"aria-label":`打开书签 ${e.title}`,children:[!!t&&!r&&s.jsx("button",{onClick:e=>{e.stopPropagation(),t()},className:"absolute top-2 right-2 sm:top-3 sm:right-3 w-9 h-9 sm:w-8 sm:h-8 rounded-lg bg-card hover:bg-muted backdrop-blur-sm flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all hover:scale-110 shadow-lg z-10 touch-manipulation",title:"编辑",children:s.jsx("svg",{className:"w-4 h-4 text-base-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.cover_image&&""!==e.cover_image.trim()&&s.jsx("div",{className:"relative bg-base-200 overflow-hidden flex-shrink-0 "+("favicon"===n?"h-20 flex items-center justify-center":"h-32"),style:{borderTopLeftRadius:"calc(var(--radius) * 1.5)",borderTopRightRadius:"calc(var(--radius) * 1.5)"},children:s.jsx(Ct,{src:e.cover_image,alt:e.title,className:"favicon"===n?"w-12 h-12 object-contain":"w-full h-full object-cover",onTypeDetected:a})}),s.jsxs("div",{className:"flex flex-col p-3 gap-2 relative",children:[(!!e.is_pinned||!!e.is_archived)&&s.jsxs("div",{className:"flex gap-1 mb-1",children:[!!e.is_pinned&&s.jsx("span",{className:"bg-warning text-warning-content text-xs px-1.5 py-0.5 rounded-full font-medium",children:"置顶"}),!!e.is_archived&&s.jsx("span",{className:"bg-base-content/40 text-base-100 text-xs px-1.5 py-0.5 rounded-full font-medium",children:"归档"})]}),s.jsx("h3",{className:"font-semibold text-sm line-clamp-2 hover:text-primary transition-colors leading-snug",title:e.title,children:e.title}),e.description&&s.jsx("p",{className:"text-xs text-base-content/70 line-clamp-3 leading-relaxed",children:e.description}),e.tags&&e.tags.length>0&&s.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-1",children:[e.tags.slice(0,4).map(e=>s.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:e.name},e.id)),e.tags.length>4&&s.jsxs("span",{className:"text-[11px] text-base-content/60 flex items-center px-1",children:["+",e.tags.length-4]})]})]})]})}function Tt({bookmarks:e,onEdit:t,readOnly:r=!1}){return s.jsxs("div",{className:"rounded-xl border border-base-300 overflow-hidden",children:[s.jsxs("div",{className:"grid grid-cols-[minmax(0,2fr)_minmax(0,2fr)_minmax(0,2fr)_auto] gap-4 px-4 py-2 text-xs uppercase tracking-wide text-base-content/50 bg-base-200",children:[s.jsx("span",{children:"标题"}),s.jsx("span",{children:"网址"}),s.jsx("span",{children:"备注"}),s.jsx("span",{className:"text-right",children:r?"":"操作"})]}),s.jsx("div",{children:e.map(e=>s.jsx(Et,{bookmark:e,onEdit:t?()=>t(e):void 0,readOnly:r},e.id))})]})}function Et({bookmark:e,onEdit:t,readOnly:r=!1}){const n=yt();return s.jsxs("div",{className:"grid grid-cols-[minmax(0,2fr)_minmax(0,2fr)_minmax(0,2fr)_auto] gap-4 px-4 py-3 text-sm items-center border-t border-base-200 first:border-t-0 hover:bg-base-200/60",children:[s.jsx("button",{type:"button",onClick:()=>{r||n.mutate(e.id),window.open(e.url,"_blank","noopener,noreferrer")},className:"text-left font-medium truncate hover:text-primary",title:e.title,children:e.title||e.url}),s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary truncate hover:underline",title:e.url,children:e.url}),s.jsx("span",{className:"text-xs text-base-content/70 truncate",title:e.description||void 0,children:e.description||"—"}),s.jsx("div",{className:"flex justify-end",children:t&&!r?s.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),t()},className:"text-xs font-medium px-3 py-1 rounded-md bg-base-300 hover:bg-base-200 transition-colors",children:"编辑"}):null})]})}function _t({bookmarks:e,onEdit:t,readOnly:r=!1}){return s.jsx("div",{className:"columns-1 sm:columns-2 xl:columns-4 gap-2.5 sm:gap-3",children:e.map(e=>s.jsx("div",{className:"break-inside-avoid mb-2.5 sm:mb-3",children:s.jsx(Lt,{bookmark:e,onEdit:t?()=>t(e):void 0,readOnly:r})},e.id))})}function Lt({bookmark:e,onEdit:t,readOnly:r=!1}){var n;const a=yt(),i=m.useRef(!1),l=m.useMemo(()=>{try{return new URL(e.url).hostname}catch{return e.url.replace(/^https?:\/\//i,"").split("/")[0]||e.url}},[e.url]),o=()=>{r||a.mutate(e.id),window.open(e.url,"_blank","noopener,noreferrer")};return s.jsx("div",{className:"relative group",children:s.jsxs("div",{className:"rounded-xl border border-border/70 bg-card/95 backdrop-blur-sm shadow-md transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-primary/10",children:[s.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-xl bg-gradient-to-br from-primary/4 via-transparent to-secondary/8 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),!!t&&!r&&s.jsx("button",{type:"button",onMouseDown:e=>{var t,s;e.preventDefault(),e.stopPropagation(),null==(s=(t=e.nativeEvent).stopImmediatePropagation)||s.call(t)},onClick:e=>{var s,r;e.preventDefault(),e.stopPropagation(),null==(r=(s=e.nativeEvent).stopImmediatePropagation)||r.call(s),i.current=!0,setTimeout(()=>{i.current=!1},0),t()},className:"absolute top-3 right-3 w-8 h-8 rounded-xl border border-white/20 bg-card/80 hover:bg-muted/90 backdrop-blur-sm flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all shadow-lg",title:"编辑",children:s.jsx("svg",{className:"w-4 h-4 text-base-content",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),s.jsxs("div",{className:"relative z-10 px-5 py-4 space-y-2 pointer-events-none",children:[s.jsx("button",{type:"button",onClick:e=>{if(i.current)return i.current=!1,void e.preventDefault();o()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o())},className:"pointer-events-auto inline-flex max-w-full text-left text-sm font-semibold leading-snug text-foreground line-clamp-2 hover:text-primary transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/60 rounded-md pr-12",children:(null==(n=e.title)?void 0:n.trim())||e.url}),s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"pointer-events-auto block text-xs text-muted-foreground/70 truncate hover:text-primary",onClick:()=>{r||a.mutate(e.id)},children:l})]})]})})}function Dt({bookmarks:e,isLoading:t,viewMode:r="list",onEdit:n,readOnly:a=!1,previousCount:i=0}){if(t&&0===e.length){const e=i>0?Math.min(i,10):3;return s.jsx("div",{className:"space-y-4",children:[...Array(e)].map((e,t)=>s.jsx("div",{className:"card animate-pulse shadow-float",children:s.jsx("div",{className:"h-32 bg-gradient-to-r from-base-300 via-base-200 to-base-300 rounded-xl"})},t))})}return 0===e.length?s.jsxs("div",{className:"card text-center py-16 shadow-float",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 rounded-3xl bg-gradient-to-br from-primary/20 to-secondary/20 mb-6 mx-auto",children:s.jsx("svg",{className:"w-16 h-16 text-primary/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),s.jsx("h3",{className:"text-2xl font-bold mb-3 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"暂无书签"}),s.jsx("p",{className:"text-base-content/60 text-base",children:a?"发布者尚未公开任何书签，或公开内容已取消":'点击右上角 "新增书签" 按钮开始收藏精彩内容'})]}):s.jsxs(s.Fragment,{children:[t&&e.length>0&&s.jsxs("div",{className:"mb-4 flex items-center justify-center gap-2 text-sm text-primary",children:[s.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",fill:"none",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{children:"加载中..."})]}),"list"===r?s.jsx(wt,{bookmarks:e,onEdit:n,readOnly:a}):"minimal"===r?s.jsx(Tt,{bookmarks:e,onEdit:n,readOnly:a}):"title"===r?s.jsx(_t,{bookmarks:e,onEdit:n,readOnly:a}):s.jsx(St,{bookmarks:e,onEdit:n,readOnly:a})]})}function Rt({bookmark:e,onClose:t,onSuccess:r}){const i=!!e,[l,o]=m.useState((null==e?void 0:e.title)||""),[c,d]=m.useState((null==e?void 0:e.url)||""),[u,x]=m.useState((null==e?void 0:e.description)||""),[h,p]=m.useState((null==e?void 0:e.cover_image)||""),[f,g]=m.useState((null==e?void 0:e.tags.map(e=>e.id))||[]),[b,v]=m.useState((null==e?void 0:e.is_pinned)||!1),[j,y]=m.useState((null==e?void 0:e.is_archived)||!1),[w,N]=m.useState((null==e?void 0:e.is_public)||!1),[k,C]=m.useState(""),[S,M]=m.useState(""),[T,E]=m.useState(!1),[_,L]=m.useState(null),[D,R]=m.useState(!1),I=function(){const e=n();return a({mutationFn:e=>vt.createBookmark(e),onSuccess:()=>{e.invalidateQueries({queryKey:[jt]})}})}(),z=function(){const e=n();return a({mutationFn:({id:e,data:t})=>vt.updateBookmark(e,t),onSuccess:()=>{e.invalidateQueries({queryKey:[jt]})}})}(),O=function(){const e=n();return a({mutationFn:e=>vt.deleteBookmark(e),onSuccess:()=>{e.invalidateQueries({queryKey:[jt]})}})}(),A=mt(),{data:$}=ut(),B=(null==$?void 0:$.tags)||[];m.useEffect(()=>{const e=setTimeout(async()=>{if(!c.trim()||i)return L(null),void R(!1);if(c.trim().length<10)return L(null),void R(!1);try{new URL(c)}catch{return L(null),void R(!1)}R(!0);try{const e=await vt.checkUrlExists(c.trim());e.exists&&e.bookmark?L({exists:!0,bookmark:e.bookmark}):L(null)}catch(e){}finally{R(!1)}},800);return()=>clearTimeout(e)},[c,i]);const P=e=>{f.includes(e)?g(f.filter(t=>t!==e)):g([...f,e])},W=async()=>{const e=S.trim();if(!e)return;const t=e.split(/[,，]/).map(e=>e.trim()).filter(e=>e.length>0);if(0===t.length)return;const s=[...f];for(const n of t){const e=B.find(e=>e.name.toLowerCase()===n.toLowerCase());if(e)s.includes(e.id)||s.push(e.id);else try{const e=await A.mutateAsync({name:n});s.push(e.id)}catch(r){return void C(`创建标签"${n}"失败，请重试`)}}g(s),M("")},F=I.isPending||z.isPending||O.isPending||A.isPending;return s.jsxs("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-[9998] p-4",children:[s.jsxs("div",{className:"card w-full max-w-4xl max-h-[92vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-foreground",children:i?"编辑书签":"新增书签"}),s.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg hover:bg-muted flex items-center justify-center text-foreground transition-colors",disabled:F,children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),k&&s.jsxs("div",{className:"mb-3 p-2.5 bg-error/10 border border-error/30 text-error rounded-lg text-xs animate-fade-in flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{children:k})]}),s.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),C(""),l.trim())if(c.trim()){try{new URL(c)}catch{return void C("URL 格式不正确")}if(i||!(null==_?void 0:_.exists))try{if(i&&e){const t={tag_ids:f,is_pinned:b,is_archived:j,is_public:w};l.trim()!==(e.title||"")&&(t.title=l.trim()),c.trim()!==(e.url||"")&&(t.url=c.trim());const s=e.description||"";u.trim()!==s&&(t.description=u.trim()?u.trim():null);const r=e.cover_image||"";h.trim()!==r&&(t.cover_image=h.trim()?h.trim():null),await z.mutateAsync({id:e.id,data:t})}else{const e={title:l.trim(),url:c.trim(),description:u.trim()?u.trim():void 0,cover_image:h.trim()?h.trim():void 0,tag_ids:f,is_pinned:b,is_archived:j,is_public:w};await I.mutateAsync(e)}null==r||r(),t()}catch(n){C(n instanceof Error?n.message:"操作失败，请重试")}else C("该 URL 已存在于书签中")}else C("请输入书签URL");else C("请输入书签标题")},className:"space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"title",className:"block text-xs font-medium mb-1.5 text-foreground",children:["标题 ",s.jsx("span",{className:"text-error",children:"*"})]}),s.jsx("input",{id:"title",type:"text",className:"input",placeholder:"书签标题",value:l,onChange:e=>o(e.target.value),disabled:F,autoFocus:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"url",className:"block text-xs font-medium mb-1.5 text-foreground",children:["URL ",s.jsx("span",{className:"text-error",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"url",type:"url",className:"input "+(_?"border-warning":""),placeholder:"https://example.com",value:c,onChange:e=>d(e.target.value),disabled:F}),D&&s.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:s.jsxs("svg",{className:"animate-spin h-4 w-4 text-muted-foreground",viewBox:"0 0 24 24",fill:"none",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),_&&s.jsxs("div",{className:"mt-1.5 p-2 bg-warning/10 border border-warning/30 rounded-lg text-xs text-warning animate-fade-in flex items-start gap-2",children:[s.jsx("svg",{className:"w-4 h-4 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium",children:"该 URL 已存在"}),s.jsxs("p",{className:"mt-0.5 text-muted-foreground",children:["书签：",_.bookmark.title]})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"description",className:"block text-xs font-medium mb-1.5 text-foreground",children:"描述"}),s.jsx("textarea",{id:"description",className:"input min-h-[60px] resize-none text-sm",placeholder:"书签描述（可选）",value:u,onChange:e=>x(e.target.value),disabled:F})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"coverImage",className:"block text-xs font-medium mb-1.5 text-foreground",children:"封面图 URL"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{id:"coverImage",type:"url",className:"input flex-1",placeholder:"https://example.com/image.jpg",value:h,onChange:e=>p(e.target.value),disabled:F}),h&&s.jsx("img",{src:h,alt:"预览",className:"w-[60px] h-[60px] object-cover rounded-lg flex-shrink-0",onError:e=>{e.currentTarget.style.display="none"}})]})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[s.jsxs("label",{className:"block text-xs font-medium text-foreground",children:["标签",s.jsx("span",{className:"text-xs text-muted-foreground ml-1.5",children:"（支持逗号批量添加）"})]}),f.length>0&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:["已选 ",f.length," 个"]})]}),s.jsx("input",{type:"text",className:"input mb-2",placeholder:"输入标签名称（多个用逗号分隔），按 Enter 添加...",value:S,onChange:e=>M(e.target.value),onKeyDown:async e=>{"Enter"===e.key&&(e.preventDefault(),await W())},disabled:F}),f.length>0&&s.jsx("div",{className:"mb-2 p-2 bg-primary/5 border border-primary/20 rounded-lg",children:s.jsx("div",{className:"flex flex-wrap gap-1.5",children:f.map(e=>{const t=B.find(t=>t.id===e);return t?s.jsxs("button",{type:"button",onClick:()=>P(t.id),className:"text-xs px-2.5 py-1 rounded-full bg-primary text-primary-content hover:bg-primary/90 transition-colors shadow-sm",disabled:F,children:[t.name," ×"]},t.id):null})})}),s.jsx("div",{className:"p-2.5 bg-muted rounded-lg max-h-[120px] overflow-y-auto scrollbar-hide",children:s.jsx("div",{className:"flex flex-wrap gap-1.5",children:0===B.length?s.jsx("p",{className:"text-xs text-muted-foreground py-1",children:"暂无标签，在上方输入框输入后按 Enter 创建"}):B.filter(e=>!f.includes(e.id)).map(e=>s.jsx("button",{type:"button",onClick:()=>P(e.id),className:"text-xs px-2.5 py-1 rounded-full bg-card border border-border text-foreground hover:border-primary/50 hover:bg-primary/5 transition-colors",disabled:F,children:e.name},e.id))})})]}),s.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:b,onChange:e=>v(e.target.checked),disabled:F}),s.jsx("span",{className:"text-xs text-foreground",children:"置顶"})]}),s.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:j,onChange:e=>y(e.target.checked),disabled:F}),s.jsx("span",{className:"text-xs text-foreground",children:"归档"})]}),s.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:w,onChange:e=>N(e.target.checked),disabled:F}),s.jsx("span",{className:"text-xs text-foreground",children:"公开分享"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[i&&s.jsx("button",{type:"button",onClick:()=>{E(!0)},className:"btn btn-sm btn-outline border-2 border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground px-4",disabled:F,title:"删除书签",children:O.isPending?"删除中...":"删除"}),s.jsx("button",{type:"submit",className:"btn btn-sm px-6",disabled:F,children:I.isPending||z.isPending?"保存中...":i?"保存":"创建"}),s.jsx("button",{type:"button",onClick:t,className:"btn btn-sm btn-outline px-4",disabled:F,children:"取消"})]})]})]})]}),s.jsx(xt,{isOpen:T,title:"删除书签",message:"确定要删除这个书签吗？此操作无法撤销。",type:"error",confirmText:"删除",cancelText:"取消",onConfirm:async()=>{if(e){E(!1);try{await O.mutateAsync(e.id),null==r||r(),t()}catch(s){C(s instanceof Error?s.message:"删除失败，请重试")}}},onCancel:()=>E(!1)})]})}function It({hasMore:e,isLoading:t,onLoadMore:r,currentCount:n,totalLoaded:a}){return e||0!==n?s.jsxs("div",{className:"card text-center py-6 mt-6",children:[s.jsx("div",{className:"text-sm text-base-content/60 mb-4",children:e?s.jsxs(s.Fragment,{children:["已加载 ",a," 个书签",n>0&&s.jsxs("span",{children:["，当前显示 ",n," 个"]})]}):s.jsxs(s.Fragment,{children:["共 ",a," 个书签",n>0&&n!==a&&s.jsxs("span",{children:["，当前显示 ",n," 个"]})]})}),e&&s.jsx("button",{onClick:r,disabled:t,className:"btn btn-primary",children:t?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"loading loading-spinner loading-sm"}),"加载中..."]}):"加载更多"}),!e&&a>0&&s.jsx("div",{className:"text-sm text-base-content/40",children:"已加载全部书签"})]}):null}const zt=[{value:"created",label:"按创建时间",icon:U,description:"最新创建的在前",group:"time"},{value:"updated",label:"按更新时间",icon:_e,description:"最近更新的在前",group:"time"},{value:"pinned",label:"置顶优先",icon:Ee,description:"置顶书签优先显示",group:"priority"},{value:"popular",label:"按热门程度",icon:Ae,description:"点击次数多的在前",group:"engagement"}];function Ot({value:e,onChange:t,className:r=""}){const[n,a]=m.useState(!1),[i,l]=m.useState(-1),[o,c]=m.useState(null),d=m.useRef(null),u=m.useRef(null),x=zt.find(t=>t.value===e),h=(null==x?void 0:x.icon)||se;m.useEffect(()=>{const e=e=>{var s,r;if(n)switch(e.key){case"Escape":a(!1),null==(s=d.current)||s.focus();break;case"ArrowDown":e.preventDefault(),l(e=>e<zt.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),l(e=>e>0?e-1:zt.length-1);break;case"Enter":case" ":e.preventDefault(),i>=0&&zt[i]&&(t(zt[i].value),a(!1),null==(r=d.current)||r.focus())}};if(n)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n,i,t]),m.useEffect(()=>{const e=e=>{var t,s;const r=e.target;!n||(null==(t=d.current)?void 0:t.contains(r))||(null==(s=u.current)?void 0:s.contains(r))||(a(!1),c(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]);const p="undefined"!=typeof document&&n&&o?b.createPortal(s.jsx("div",{ref:e=>{u.current=e},className:"rounded-lg border border-border shadow-lg overflow-hidden",style:{position:"absolute",top:o.top,left:o.left,width:o.width??200,backgroundColor:"var(--card)",zIndex:1e3},role:"listbox","aria-label":"排序选项",children:zt.map(r=>s.jsxs("button",{type:"button",onClick:()=>{return e=r.value,t(e),a(!1),c(null),void(null==(s=d.current)||s.focus());var e,s},className:"w-full px-3 py-2 text-sm flex items-center gap-2 transition-colors "+(e===r.value?"bg-primary/10 text-primary font-medium":"text-base-content/80 hover:bg-base-200/60"),children:[s.jsx(r.icon,{className:"w-4 h-4"}),s.jsx("span",{children:r.label})]},r.value))}),document.body):null;return s.jsxs(s.Fragment,{children:[p,s.jsx("div",{className:`relative ${r}`,children:s.jsxs("button",{ref:d,type:"button",onClick:()=>{a(e=>{const t=!e;if(t){if(d.current){const e=d.current.getBoundingClientRect(),t=Math.max(e.width,200),s=window.scrollX+window.innerWidth-t-12,r=Math.min(e.left+window.scrollX,s);c({top:e.bottom+window.scrollY+8,left:r,width:t})}}else c(null);return t}),l(-1)},className:`\n            w-full sm:w-auto min-w-[160px] h-11 px-4 py-2\n            bg-card border border-border rounded-xl\n            flex items-center justify-between gap-3\n            text-sm font-medium text-foreground\n            transition-all duration-200 ease-out\n            hover:bg-muted hover:border-primary/30\n            focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary\n            shadow-sm hover:shadow-md\n            ${n?"bg-muted border-primary/50 shadow-md":""}\n          `,"aria-expanded":n,"aria-haspopup":"listbox","aria-label":"选择排序方式",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"w-4 h-4 text-primary"}),s.jsx("span",{className:"truncate",children:null==x?void 0:x.label})]}),s.jsx(V,{className:"w-4 h-4 text-muted-foreground transition-transform duration-200 "+(n?"rotate-180":"")})]})})]})}const At={getPreferences:async()=>(await Qe.get("/preferences")).data.preferences,updatePreferences:async e=>(await Qe.patch("/preferences",e)).data.preferences},$t="preferences";const Bt="tmarks:view_mode",Pt="tmarks:view_mode_updated_at",Wt=["list","card","minimal","title"],Ft={all:"全部书签",public:"仅公开",private:"仅私密"},Gt=["all","public","private"];function Kt(e){return!!e&&Wt.includes(e)}function Ut(){if("undefined"==typeof window)return null;const e=window.localStorage.getItem(Bt);return Kt(e)?e:null}function qt(e,t){"undefined"!=typeof window&&(window.localStorage.setItem(Bt,e),window.localStorage.setItem(Pt,String("number"==typeof t&&Number.isFinite(t)?t:Date.now())))}function Ht({mode:e}){return"card"===e?s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 5a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5h6v6h-6zM4 15h6v6H4zM14 15h6v6h-6z"})}):"minimal"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 5.5v13M17 5.5v13"})]}):"title"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h8M4 12h12M4 18h10"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5v2M18 11v2M16 17v2"})]}):s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 4h18l-7 8v6l-4 2v-8L3 4z"})})}function Vt({filter:e}){return"public"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):"private"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("rect",{x:"4",y:"10",width:"16",height:"10",rx:"2",ry:"2"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10V7a4 4 0 118 0v3"})]}):s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}function Xt(){const[e,t]=m.useState([]),[l,o]=m.useState([]),[c,d]=m.useState(""),[u,x]=m.useState(""),[h,p]=m.useState("popular"),[f,g]=m.useState(()=>Ut()??"card"),[v,j]=m.useState("all"),[y,w]=m.useState("grid"),[N,k]=m.useState(!1),[C,S]=m.useState(null),[M,T]=m.useState(!1),E=m.useRef(0),_=m.useRef(null),L=m.useRef(null),D=m.useRef(null),R=m.useRef(null),I=m.useRef(null),z=m.useRef(null),O=m.useRef(null),[A,$]=m.useState(null),[B,P]=m.useState(null),[W,F]=m.useState(!1),[G,K]=m.useState(!1),{data:U}=r({queryKey:[$t],queryFn:()=>At.getPreferences()}),q=function(){const e=n();return a({mutationFn:e=>At.updatePreferences(e),onSuccess:()=>{e.invalidateQueries({queryKey:[$t]})}})}();m.useEffect(()=>(D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{o(e)},300),()=>{D.current&&clearTimeout(D.current)}),[e]),m.useEffect(()=>{const e=setTimeout(()=>{x(c)},500);return()=>clearTimeout(e)},[c]),m.useEffect(()=>{if((null==U?void 0:U.view_mode)&&Kt(U.view_mode)){const e=Ut(),t=function(){if("undefined"==typeof window)return 0;const e=window.localStorage.getItem(Pt),t=e?Number(e):0;return Number.isFinite(t)?t:0}(),s=U.updated_at?new Date(U.updated_at).getTime():0;(!e||s>t)&&(g(U.view_mode),qt(U.view_mode,s))}(null==U?void 0:U.tag_layout)&&w(U.tag_layout)},[U]),m.useEffect(()=>{const e=e=>{var t,s,r,n;const a=e.target;!W||(null==(t=R.current)?void 0:t.contains(a))||(null==(s=z.current)?void 0:s.contains(a))||(F(!1),$(null)),!G||(null==(r=I.current)?void 0:r.contains(a))||(null==(n=O.current)?void 0:n.contains(a))||(K(!1),P(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[W,G]);const H=m.useMemo(()=>{const e={};return u.trim()&&(e.keyword=u.trim()),l.length>0&&(e.tags=l.join(",")),e.sort=h,e},[u,l,h]),V=i({queryKey:[jt,X=H],queryFn:({pageParam:e})=>vt.getBookmarks({...X,page_cursor:"string"==typeof e?e:void 0}),initialPageParam:void 0,getNextPageParam:e=>{var t;return(null==(t=e.meta)?void 0:t.has_more)?e.meta.next_cursor:void 0},staleTime:3e5,gcTime:6e5,refetchOnWindowFocus:!1});var X;const{refetch:Y}=ut(),J=m.useMemo(()=>{var e,t;return(null==(t=null==(e=V.data)?void 0:e.pages)?void 0:t.length)?V.data.pages.flatMap(e=>e.bookmarks):[]},[V.data]),Q=m.useMemo(()=>"all"===v?J:J.filter(e=>"public"===v?e.is_public:!e.is_public),[J,v]),Z=m.useMemo(()=>{var e,t;const s=null==(e=V.data)?void 0:e.pages;if(!s||0===s.length)return 0;const r=(null==(t=s[s.length-1])?void 0:t.bookmarks)??[];return"public"===v?r.filter(e=>e.is_public).length:"private"===v?r.filter(e=>!e.is_public).length:r.length},[V.data,v]),ee=V.isLoading&&0===J.length,te=V.isFetching&&!ee;m.useEffect(()=>{Q.length>0&&(E.current=Q.length)},[Q.length]),m.useEffect(()=>(_.current&&(clearTimeout(_.current),_.current=null),e.length>0&&(_.current=setTimeout(()=>{t([]),o([])},3e4)),()=>{_.current&&(clearTimeout(_.current),_.current=null)}),[e]),m.useEffect(()=>(L.current&&(clearTimeout(L.current),L.current=null),c.trim()&&(L.current=setTimeout(()=>{d(""),x("")},15e3)),()=>{L.current&&(clearTimeout(L.current),L.current=null)}),[c]);const se=Boolean(V.hasNextPage),re=e=>{F(!1),K(!1),$(null),P(null),z.current=null,O.current=null,S(e||null),k(!0)},ne=e=>{w(e),q.mutate({tag_layout:e})},ae="undefined"!=typeof document&&G&&B?b.createPortal(s.jsx("div",{ref:e=>{O.current=e},className:"rounded-lg border border-border shadow-lg overflow-hidden",style:{position:"absolute",top:B.top,left:B.left,width:B.width??180,backgroundColor:"var(--card)",zIndex:1e3},children:Gt.map(e=>s.jsxs("button",{type:"button",onClick:()=>(j(e),K(!1),P(null),void(O.current=null)),className:"w-full px-3 py-2 text-sm flex items-center gap-2 transition-colors "+(v===e?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:bg-muted"),children:[s.jsx(Vt,{filter:e}),s.jsx("span",{children:Ft[e]})]},e))}),document.body):null,ie="undefined"!=typeof document&&W&&A?b.createPortal(s.jsx("div",{ref:e=>{z.current=e},className:"rounded-lg border border-border shadow-lg overflow-hidden",style:{position:"absolute",top:A.top,left:A.left,width:A.width??200,backgroundColor:"var(--card)",zIndex:1e3},children:Wt.map(e=>s.jsxs("button",{type:"button",onClick:()=>{return g(t=e),qt(t),q.mutate({view_mode:t}),F(!1),$(null),void(z.current=null);var t},className:"w-full px-3 py-2 text-sm flex items-center gap-2 transition-colors "+(f===e?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:bg-muted"),children:[s.jsx(Ht,{mode:e}),s.jsx("span",{children:"list"===e?"列表视图":"card"===e?"卡片视图":"minimal"===e?"极简列表":"标题瀑布"})]},e))}),document.body):null;return s.jsxs(s.Fragment,{children:[ae,ie,s.jsxs("div",{className:"w-full mx-auto py-3 sm:py-4 md:py-6 px-3 sm:px-4 md:px-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-3 sm:gap-4 md:gap-6",children:[s.jsx("aside",{className:"hidden lg:block lg:col-span-3 order-2 lg:order-1 fixed top-[calc(5rem+0.75rem)] sm:top-[calc(5rem+1rem)] md:top-[calc(5rem+1.5rem)] left-3 sm:left-4 md:left-6 bottom-3 w-[calc(25%-1.5rem)] z-40",children:s.jsx(gt,{selectedTags:e,onTagsChange:t,tagLayout:y,onTagLayoutChange:ne,bookmarks:Q,isLoadingBookmarks:ee||te})}),s.jsx("main",{className:"lg:col-span-9 lg:col-start-4 order-1 lg:order-2",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-5",children:[s.jsx("div",{className:"card shadow-float",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 w-full sm:min-w-[280px]",children:[s.jsx("button",{onClick:()=>T(!0),className:"lg:hidden w-11 h-11 rounded-xl flex items-center justify-center transition-all shadow-float bg-card border border-border hover:bg-muted hover:border-primary/30 text-foreground",title:"打开标签","aria-label":"打开标签",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}),s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx("svg",{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),s.jsx("input",{type:"text",className:"input w-full pl-10 sm:pl-12 h-11 sm:h-auto text-sm sm:text-base",placeholder:"搜索书签标题、描述或URL...",value:c,onChange:e=>d(e.target.value)})]})})]}),s.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[s.jsx("div",{className:"relative flex-1 sm:flex-initial",children:s.jsx(Ot,{value:h,onChange:p,className:"w-full sm:w-auto"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"relative",children:s.jsx("button",{ref:I,onClick:()=>{K(e=>{const t=!e;if(t){if(I.current){const e=I.current.getBoundingClientRect(),t=Math.max(e.width+100,160),s=window.scrollX+window.innerWidth-t-12,r=Math.min(e.left+window.scrollX,s);P({top:e.bottom+window.scrollY+8,left:r,width:t})}F(!1),$(null)}else P(null);return t})},className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center transition-all shadow-float touch-manipulation "+("all"===v?"bg-muted text-foreground hover:bg-muted/80":"public"===v?"bg-success/10 text-success hover:bg-success/20":"bg-warning/10 text-warning hover:bg-warning/20"),title:`${Ft[v]}筛选`,"aria-label":`${Ft[v]}筛选`,type:"button",children:s.jsx(Vt,{filter:v})})}),s.jsx("div",{className:"relative",children:s.jsx("button",{ref:R,onClick:()=>{F(e=>{const t=!e;if(t){if(R.current){const e=R.current.getBoundingClientRect(),t=Math.max(e.width+110,180),s=window.scrollX+window.innerWidth-t-12,r=Math.min(e.left+window.scrollX,s);$({top:e.bottom+window.scrollY+8,left:r,width:t})}K(!1),P(null)}else $(null);return t})},className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center transition-all shadow-float bg-muted text-foreground hover:bg-muted/80 touch-manipulation",title:"切换视图","aria-label":"切换视图",type:"button",children:s.jsx(Ht,{mode:f})})}),s.jsx("button",{onClick:()=>re(),className:"w-12 h-12 sm:w-11 sm:h-11 rounded-xl bg-gradient-to-br from-primary to-secondary text-primary-content flex items-center justify-center shrink-0 shadow-float hover:shadow-xl transition-all hover:scale-105 active:scale-95 touch-manipulation",title:"新增书签","aria-label":"新增书签",type:"button",children:s.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]})]})}),s.jsx(Dt,{bookmarks:Q,isLoading:ee||te,viewMode:f,onEdit:re,previousCount:E.current}),!ee&&Q.length>0&&s.jsx(It,{hasMore:se,isLoading:V.isFetchingNextPage,onLoadMore:()=>{V.hasNextPage&&V.fetchNextPage()},currentCount:Z,totalLoaded:Q.length})]})})]}),M&&s.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:()=>T(!1)}),s.jsxs("div",{className:"absolute left-0 top-0 bottom-0 w-80 max-w-[85vw] bg-background border-r border-border shadow-xl animate-in slide-in-from-left duration-300",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border bg-background",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"标签筛选"}),s.jsx("button",{onClick:()=>T(!1),className:"w-8 h-8 rounded-lg flex items-center justify-center hover:bg-muted transition-colors","aria-label":"关闭标签抽屉",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-background",children:s.jsx(gt,{selectedTags:e,onTagsChange:s=>{t(s),s.length>=2&&s.length>e.length&&setTimeout(()=>T(!1),500)},tagLayout:y,onTagLayoutChange:ne,bookmarks:Q,isLoadingBookmarks:ee||te})})]})]}),N&&s.jsx(Rt,{bookmark:C,onClose:()=>{k(!1),S(null)},onSuccess:()=>{V.refetch(),Y()}})]})]})}const Yt={async getTabGroups(e){const t=new URLSearchParams;(null==e?void 0:e.page_size)&&t.set("page_size",e.page_size.toString()),(null==e?void 0:e.page_cursor)&&t.set("page_cursor",e.page_cursor);const s=t.toString(),r=s?`/../tab-groups?${s}`:"/../tab-groups";return(await Qe.get(r)).data},async getAllTabGroups(){var e;const t=[];let s;do{const r=await this.getTabGroups({page_size:100,page_cursor:s});t.push(...r.tab_groups),s=null==(e=r.meta)?void 0:e.next_cursor}while(s);return t},getTabGroup:async e=>(await Qe.get(`/../tab-groups/${e}`)).data.tab_group,createTabGroup:async e=>(await Qe.post("/../tab-groups",e)).data.tab_group,createFolder:async(e,t)=>(await Qe.post("/../tab-groups",{title:e,parent_id:t,is_folder:!0})).data.tab_group,updateTabGroup:async(e,t)=>(await Qe.patch(`/../tab-groups/${e}`,t)).data.tab_group,async deleteTabGroup(e){await Qe.delete(`/../tab-groups/${e}`)},updateTabGroupItem:async(e,t)=>(await Qe.patch(`/../tab-groups/items/${e}`,t)).data.item,async deleteTabGroupItem(e){await Qe.delete(`/../tab-groups/items/${e}`)},moveTabGroupItem:async(e,t,s)=>(await Qe.post(`/../tab-groups/items/${e}/move`,{target_group_id:t,position:s})).data.item,addItemsToGroup:async(e,t)=>(await Qe.post(`/../tab-groups/${e}/items/batch`,{items:t})).data,getTrash:async()=>(await Qe.get("/../tab-groups/trash")).data,async restoreTabGroup(e){await Qe.post(`/../tab-groups/${e}/restore`,{})},async permanentDeleteTabGroup(e){await Qe.delete(`/../tab-groups/${e}/permanent-delete`)},createShare:async(e,t)=>(await Qe.post(`/../tab-groups/${e}/share`,t||{})).data,getShare:async e=>(await Qe.get(`/../tab-groups/${e}/share`)).data,async deleteShare(e){await Qe.delete(`/../tab-groups/${e}/share`)},getStatistics:async(e=30)=>(await Qe.get(`/../statistics?days=${e}`)).data};function Jt({groupId:e,groupTitle:t,onClose:r}){const[n,a]=m.useState(null),[i,l]=m.useState(""),[o,c]=m.useState(!0),[d,u]=m.useState(!1),[x,h]=m.useState(null),p=m.useCallback(async()=>{try{c(!0),h(null);try{const t=await Yt.getShare(e);a(t.share),l(t.share_url)}catch{const t=await Yt.createShare(e,{is_public:!0});a(t.share),l(t.share_url)}}catch(t){h("创建分享链接失败")}finally{c(!1)}},[e]);m.useEffect(()=>{p()},[p]);return s.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"rounded shadow-xl max-w-md w-full",style:{backgroundColor:"var(--card)"},children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Re,{className:"w-6 h-6 text-primary"}),s.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"分享标签页组"})]}),s.jsx("button",{onClick:r,className:"text-muted-foreground hover:text-foreground transition-colors",children:s.jsx(We,{className:"w-6 h-6"})})]}),s.jsx("div",{className:"p-6",children:o?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"生成分享链接中..."})]}):x?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-destructive mb-4",children:x}),s.jsx("button",{onClick:p,className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"重试"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"标签页组名称"}),s.jsx("p",{className:"text-foreground font-medium",children:t})]}),n&&s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[s.jsx(ce,{className:"w-4 h-4"}),s.jsxs("span",{children:["浏览次数: ",n.view_count]})]})}),s.jsxs("div",{className:"mb-6",children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"分享链接"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:i,readOnly:!0,className:"input flex-1 text-sm"}),s.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(i),u(!0),setTimeout(()=>u(!1),2e3)}catch(e){alert("复制失败")}},className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 transition-colors flex items-center gap-2",children:d?s.jsxs(s.Fragment,{children:[s.jsx(H,{className:"w-4 h-4"}),"已复制"]}):s.jsxs(s.Fragment,{children:[s.jsx(ne,{className:"w-4 h-4"}),"复制"]})})]})]}),s.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded p-4 mb-4",children:s.jsx("p",{className:"text-sm text-foreground",children:"💡 任何人都可以通过此链接查看您的标签页组，但无法编辑。"})}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("button",{onClick:async()=>{if(confirm("确定要删除分享链接吗？"))try{await Yt.deleteShare(e),r()}catch(t){alert("删除失败")}},className:"px-4 py-2 text-destructive hover:bg-destructive/10 rounded transition-colors",children:"删除分享"}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-muted text-foreground rounded hover:bg-muted/80 transition-colors",children:"关闭"})]})]})})]})})}function Qt({searchQuery:e,onSearchChange:t,sortBy:r,onSortChange:n,onBatchModeToggle:a,batchMode:i}){var l;const o=[{value:"created",label:"按创建时间"},{value:"title",label:"按标题"},{value:"count",label:"按标签页数量"}],c=(null==(l=o.find(e=>e.value===r))?void 0:l.label)||"排序";return s.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.jsxs("div",{className:"flex-1 relative min-w-0",children:[s.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),s.jsx("input",{type:"text",placeholder:"搜索标签页组...",value:e,onChange:e=>t(e.target.value),className:"input w-full pl-10"})]}),s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsx("select",{value:r,onChange:e=>n(e.target.value),className:"appearance-none w-10 h-10 flex items-center justify-center border border-border rounded hover:bg-muted transition-colors cursor-pointer opacity-0 absolute inset-0",title:c,children:o.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx("div",{className:"w-10 h-10 flex items-center justify-center border border-border rounded hover:bg-muted transition-colors pointer-events-none",style:{backgroundColor:"var(--card)"},children:s.jsx(G,{className:"w-5 h-5 text-muted-foreground"})})]}),s.jsx("button",{onClick:a,className:"w-10 h-10 flex-shrink-0 flex items-center justify-center rounded transition-colors "+(i?"bg-primary text-primary-foreground":"border border-border hover:bg-muted text-muted-foreground"),title:i?"退出批量操作":"批量操作",children:s.jsx(ee,{className:"w-5 h-5"})}),s.jsx(g,{to:"/tab/statistics",className:"w-10 h-10 flex-shrink-0 flex items-center justify-center border border-border rounded hover:bg-muted transition-colors text-muted-foreground",title:"统计",children:s.jsx(q,{className:"w-5 h-5"})}),s.jsx(g,{to:"/tab/trash",className:"w-10 h-10 flex-shrink-0 flex items-center justify-center border border-border rounded hover:bg-muted transition-colors text-muted-foreground",title:"回收站",children:s.jsx(P,{className:"w-5 h-5"})})]})}function Zt({selectedCount:e,onSelectAll:t,onDeselectAll:r,onBatchDelete:n,onBatchPin:a,onBatchTodo:i,onBatchExport:l,onCancel:o}){return s.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded p-4 mb-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm font-medium text-foreground",children:["已选择 ",e," 个标签页"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:t,className:"text-sm text-primary hover:text-primary/80 transition-colors",children:"全选"}),s.jsx("span",{className:"text-border",children:"|"}),s.jsx("button",{onClick:r,className:"text-sm text-primary hover:text-primary/80 transition-colors",children:"取消全选"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-3 py-1.5 bg-card border border-border rounded hover:bg-muted transition-colors text-sm",disabled:0===e,children:[s.jsx(Ee,{className:"w-4 h-4"}),"固定"]}),s.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-3 py-1.5 bg-card border border-border rounded hover:bg-muted transition-colors text-sm",disabled:0===e,children:[s.jsx(ze,{className:"w-4 h-4"}),"待办"]}),s.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-3 py-1.5 bg-card border border-border rounded hover:bg-muted transition-colors text-sm",disabled:0===e,children:[s.jsx(ie,{className:"w-4 h-4"}),"导出"]}),s.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-3 py-1.5 bg-destructive text-destructive-foreground rounded hover:bg-destructive/90 transition-colors text-sm",disabled:0===e,children:[s.jsx(Oe,{className:"w-4 h-4"}),"删除"]}),s.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-3 py-1.5 bg-muted text-foreground rounded hover:bg-muted/80 transition-colors text-sm",children:[s.jsx(We,{className:"w-4 h-4"}),"取消"]})]})]})})}function es({isSearching:e,searchQuery:t}){return e?s.jsxs("div",{className:"text-center py-16",children:[s.jsx(De,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"没有找到匹配的标签页组"}),s.jsxs("p",{className:"text-muted-foreground",children:['尝试使用不同的关键词搜索 "',t,'"']})]}):s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx(we,{className:"w-12 h-12 text-primary"})}),s.jsx("h3",{className:"text-2xl font-bold text-foreground mb-3",children:"还没有标签页组"}),s.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"使用浏览器扩展收集标签页，或者在这里创建新的标签页组来开始管理您的标签页"}),s.jsx("div",{className:"flex items-center justify-center gap-4",children:s.jsx("div",{className:"text-sm text-muted-foreground/80",children:"💡 提示：安装浏览器扩展可以快速收集当前窗口的所有标签页"})})]})}const ts={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},ss={date:C({formats:{full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},defaultWidth:"full"}),time:C({formats:{full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},defaultWidth:"full"}),dateTime:C({formats:{full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},defaultWidth:"full"})};function rs(e,t,s){const r="eeee p";return S(e,t,s)?r:e.getTime()>t.getTime()?"'下个'"+r:"'上个'"+r}const ns={lastWeek:rs,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:rs,other:"PP p"},as={code:"zh-CN",formatDistance:(e,t,s)=>{let r;const n=ts[e];return r="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",String(t)),(null==s?void 0:s.addSuffix)?s.comparison&&s.comparison>0?r+"内":r+"前":r},formatLong:ss,formatRelative:(e,t,s,r)=>{const n=ns[e];return"function"==typeof n?n(t,s,r):n},localize:{ordinalNumber:(e,t)=>{const s=Number(e);switch(null==t?void 0:t.unit){case"date":return s.toString()+"日";case"hour":return s.toString()+"时";case"minute":return s.toString()+"分";case"second":return s.toString()+"秒";default:return"第 "+s.toString()}},era:M({values:{narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},defaultWidth:"wide"}),quarter:M({values:{narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:M({values:{narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},defaultWidth:"wide"}),day:M({values:{narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},defaultWidth:"wide"}),dayPeriod:M({values:{narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},defaultWidth:"wide",formattingValues:{narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:E({matchPattern:/^(第\s*)?\d+(日|时|分|秒)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:T({matchPatterns:{narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^(前)/i,/^(公元)/i]},defaultParseWidth:"any"}),quarter:T({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},defaultMatchWidth:"wide",parsePatterns:{any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:T({matchPatterns:{narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},defaultParseWidth:"any"}),day:T({matchPatterns:{narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},defaultMatchWidth:"wide",parsePatterns:{any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},defaultParseWidth:"any"}),dayPeriod:T({matchPatterns:{any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}};function is({group:e,isEditingTitle:t,editingTitle:r,onEditTitle:n,onSaveTitle:a,onCancelEdit:i,onTitleChange:l,onShareClick:o,onOpenAll:c,onExport:d,onDelete:u,isDeleting:m}){var x;return s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"flex items-center gap-3 mb-2",children:t?s.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.jsx("input",{type:"text",value:r,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key?a():"Escape"===e.key&&i()},className:"input flex-1",autoFocus:!0}),s.jsx("button",{onClick:a,className:"p-2 text-success hover:bg-success/10 rounded transition-colors",title:"保存",children:s.jsx(H,{className:"w-5 h-5"})}),s.jsx("button",{onClick:i,className:"p-2 text-muted-foreground hover:bg-muted rounded transition-colors",title:"取消",children:s.jsx(We,{className:"w-5 h-5"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"text-xl font-semibold text-foreground flex-1",children:e.title}),s.jsx("button",{onClick:n,className:"p-2 text-muted-foreground hover:bg-muted rounded transition-colors",title:"重命名",children:s.jsx(Te,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(U,{className:"w-4 h-4"}),s.jsx("span",{children:_(new Date(e.created_at),{addSuffix:!0,locale:as})})]}),s.jsx("div",{className:"flex items-center gap-1",children:s.jsxs("span",{children:[(null==(x=e.items)?void 0:x.length)||0," 个标签页"]})})]})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx("button",{onClick:c,disabled:!e.items||0===e.items.length,className:"p-2 text-muted-foreground hover:bg-muted rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"打开全部",children:s.jsx(he,{className:"w-5 h-5"})}),s.jsx("button",{onClick:d,disabled:!e.items||0===e.items.length,className:"p-2 text-muted-foreground hover:bg-muted rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"导出 Markdown",children:s.jsx(ie,{className:"w-5 h-5"})}),s.jsx("button",{onClick:o,className:"p-2 text-muted-foreground hover:bg-muted rounded transition-colors",title:"分享",children:s.jsx(Re,{className:"w-5 h-5"})}),s.jsx("button",{onClick:u,disabled:m,className:"p-2 text-destructive hover:bg-destructive/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:m?"删除中...":"删除",children:s.jsx(Oe,{className:"w-5 h-5"})})]})]})}const ls="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function os(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function cs(e){return"nodeType"in e}function ds(e){var t,s;return e?os(e)?e:cs(e)&&null!=(t=null==(s=e.ownerDocument)?void 0:s.defaultView)?t:window:window}function us(e){const{Document:t}=ds(e);return e instanceof t}function ms(e){return!os(e)&&e instanceof ds(e).HTMLElement}function xs(e){return e instanceof ds(e).SVGElement}function hs(e){return e?os(e)?e.document:cs(e)?us(e)?e:ms(e)||xs(e)?e.ownerDocument:document:document:document}const ps=ls?m.useLayoutEffect:m.useEffect;function fs(e){const t=m.useRef(e);return ps(()=>{t.current=e}),m.useCallback(function(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return null==t.current?void 0:t.current(...s)},[])}function gs(e,t){void 0===t&&(t=[e]);const s=m.useRef(e);return ps(()=>{s.current!==e&&(s.current=e)},t),s}function bs(e,t){const s=m.useRef();return m.useMemo(()=>{const t=e(s.current);return s.current=t,t},[...t])}function vs(e){const t=fs(e),s=m.useRef(null),r=m.useCallback(e=>{e!==s.current&&(null==t||t(e,s.current)),s.current=e},[]);return[s,r]}function js(e){const t=m.useRef();return m.useEffect(()=>{t.current=e},[e]),t.current}let ys={};function ws(e,t){return m.useMemo(()=>{if(t)return t;const s=null==ys[e]?0:ys[e]+1;return ys[e]=s,e+"-"+s},[e,t])}function Ns(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];return r.reduce((t,s)=>{const r=Object.entries(s);for(const[n,a]of r){const s=t[n];null!=s&&(t[n]=s+e*a)}return t},{...t})}}const ks=Ns(1),Cs=Ns(-1);function Ss(e){if(!e)return!1;const{KeyboardEvent:t}=ds(e.target);return t&&e instanceof t}function Ms(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=ds(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:s}=e.touches[0];return{x:t,y:s}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:s}=e.changedTouches[0];return{x:t,y:s}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const Ts=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:s}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:s}=e;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(e){if(e)return[Ts.Translate.toString(e),Ts.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:s,easing:r}=e;return t+" "+s+"ms "+r}}}),Es="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function _s(e){return e.matches(Es)?e:e.querySelector(Es)}const Ls={display:"none"};function Ds(e){let{id:t,value:s}=e;return v.createElement("div",{id:t,style:Ls},s)}function Rs(e){let{id:t,announcement:s,ariaLiveType:r="assertive"}=e;return v.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},s)}const Is=m.createContext(null);const zs={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Os={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function As(e){let{announcements:t=Os,container:s,hiddenTextDescribedById:r,screenReaderInstructions:n=zs}=e;const{announce:a,announcement:i}=function(){const[e,t]=m.useState("");return{announce:m.useCallback(e=>{null!=e&&t(e)},[]),announcement:e}}(),l=ws("DndLiveRegion"),[o,c]=m.useState(!1);if(m.useEffect(()=>{c(!0)},[]),function(e){const t=m.useContext(Is);m.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}(m.useMemo(()=>({onDragStart(e){let{active:s}=e;a(t.onDragStart({active:s}))},onDragMove(e){let{active:s,over:r}=e;t.onDragMove&&a(t.onDragMove({active:s,over:r}))},onDragOver(e){let{active:s,over:r}=e;a(t.onDragOver({active:s,over:r}))},onDragEnd(e){let{active:s,over:r}=e;a(t.onDragEnd({active:s,over:r}))},onDragCancel(e){let{active:s,over:r}=e;a(t.onDragCancel({active:s,over:r}))}}),[a,t])),!o)return null;const d=v.createElement(v.Fragment,null,v.createElement(Ds,{id:r,value:n.draggable}),v.createElement(Rs,{id:l,announcement:i}));return s?b.createPortal(d,s):d}var $s,Bs;function Ps(){}function Ws(e,t){return m.useMemo(()=>({sensor:e,options:null!=t?t:{}}),[e,t])}function Fs(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return m.useMemo(()=>[...t].filter(e=>null!=e),[...t])}(Bs=$s||($s={})).DragStart="dragStart",Bs.DragMove="dragMove",Bs.DragEnd="dragEnd",Bs.DragCancel="dragCancel",Bs.DragOver="dragOver",Bs.RegisterDroppable="registerDroppable",Bs.SetDroppableDisabled="setDroppableDisabled",Bs.UnregisterDroppable="unregisterDroppable";const Gs=Object.freeze({x:0,y:0});function Ks(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Us(e,t){const s=Ms(e);if(!s)return"0 0";return(s.x-t.left)/t.width*100+"% "+(s.y-t.top)/t.height*100+"%"}function qs(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return s-r}function Hs(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return r-s}function Vs(e){let{left:t,top:s,height:r,width:n}=e;return[{x:t,y:s},{x:t+n,y:s},{x:t,y:s+r},{x:t+n,y:s+r}]}function Xs(e,t,s){return void 0===t&&(t=e.left),void 0===s&&(s=e.top),{x:t+.5*e.width,y:s+.5*e.height}}const Ys=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const n=Xs(t,t.left,t.top),a=[];for(const i of r){const{id:e}=i,t=s.get(e);if(t){const s=Ks(Xs(t),n);a.push({id:e,data:{droppableContainer:i,value:s}})}}return a.sort(qs)};function Js(e,t){const s=Math.max(t.top,e.top),r=Math.max(t.left,e.left),n=Math.min(t.left+t.width,e.left+e.width),a=Math.min(t.top+t.height,e.top+e.height),i=n-r,l=a-s;if(r<n&&s<a){const s=t.width*t.height,r=e.width*e.height,n=i*l;return Number((n/(s+r-n)).toFixed(4))}return 0}const Qs=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const n=[];for(const a of r){const{id:e}=a,r=s.get(e);if(r){const s=Js(r,t);s>0&&n.push({id:e,data:{droppableContainer:a,value:s}})}}return n.sort(Hs)};function Zs(e,t){const{top:s,left:r,bottom:n,right:a}=t;return s<=e.y&&e.y<=n&&r<=e.x&&e.x<=a}function er(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Gs}function tr(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];return r.reduce((t,s)=>({...t,top:t.top+e*s.y,bottom:t.bottom+e*s.y,left:t.left+e*s.x,right:t.right+e*s.x}),{...t})}}const sr=tr(1);function rr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}const nr={ignoreTransform:!1};function ar(e,t){void 0===t&&(t=nr);let s=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:r}=ds(e).getComputedStyle(e);t&&(s=function(e,t,s){const r=rr(t);if(!r)return e;const{scaleX:n,scaleY:a,x:i,y:l}=r,o=e.left-i-(1-n)*parseFloat(s),c=e.top-l-(1-a)*parseFloat(s.slice(s.indexOf(" ")+1)),d=n?e.width/n:e.width,u=a?e.height/a:e.height;return{width:d,height:u,top:c,right:o+d,bottom:c+u,left:o}}(s,t,r))}const{top:r,left:n,width:a,height:i,bottom:l,right:o}=s;return{top:r,left:n,width:a,height:i,bottom:l,right:o}}function ir(e){return ar(e,{ignoreTransform:!0})}function lr(e,t){const s=[];return e?function r(n){if(null!=t&&s.length>=t)return s;if(!n)return s;if(us(n)&&null!=n.scrollingElement&&!s.includes(n.scrollingElement))return s.push(n.scrollingElement),s;if(!ms(n)||xs(n))return s;if(s.includes(n))return s;const a=ds(e).getComputedStyle(n);return n!==e&&function(e,t){void 0===t&&(t=ds(e).getComputedStyle(e));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=t[e];return"string"==typeof r&&s.test(r)})}(n,a)&&s.push(n),function(e,t){return void 0===t&&(t=ds(e).getComputedStyle(e)),"fixed"===t.position}(n,a)?s:r(n.parentNode)}(e):s}function or(e){const[t]=lr(e,1);return null!=t?t:null}function cr(e){return ls&&e?os(e)?e:cs(e)?us(e)||e===hs(e).scrollingElement?window:ms(e)?e:null:null:null}function dr(e){return os(e)?e.scrollX:e.scrollLeft}function ur(e){return os(e)?e.scrollY:e.scrollTop}function mr(e){return{x:dr(e),y:ur(e)}}var xr,hr;function pr(e){return!(!ls||!e)&&e===document.scrollingElement}function fr(e){const t={x:0,y:0},s=pr(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-s.width,y:e.scrollHeight-s.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}(hr=xr||(xr={}))[hr.Forward=1]="Forward",hr[hr.Backward=-1]="Backward";const gr={x:.2,y:.2};function br(e,t,s,r,n){let{top:a,left:i,right:l,bottom:o}=s;void 0===r&&(r=10),void 0===n&&(n=gr);const{isTop:c,isBottom:d,isLeft:u,isRight:m}=fr(e),x={x:0,y:0},h={x:0,y:0},p=t.height*n.y,f=t.width*n.x;return!c&&a<=t.top+p?(x.y=xr.Backward,h.y=r*Math.abs((t.top+p-a)/p)):!d&&o>=t.bottom-p&&(x.y=xr.Forward,h.y=r*Math.abs((t.bottom-p-o)/p)),!m&&l>=t.right-f?(x.x=xr.Forward,h.x=r*Math.abs((t.right-f-l)/f)):!u&&i<=t.left+f&&(x.x=xr.Backward,h.x=r*Math.abs((t.left+f-i)/f)),{direction:x,speed:h}}function vr(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:s,right:r,bottom:n}=e.getBoundingClientRect();return{top:t,left:s,right:r,bottom:n,width:e.clientWidth,height:e.clientHeight}}function jr(e){return e.reduce((e,t)=>ks(e,mr(t)),Gs)}function yr(e,t){if(void 0===t&&(t=ar),!e)return;const{top:s,left:r,bottom:n,right:a}=t(e);or(e)&&(n<=0||a<=0||s>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const wr=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+dr(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+ur(t),0)}]];class Nr{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=lr(t),r=jr(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[n,a,i]of wr)for(const e of a)Object.defineProperty(this,e,{get:()=>{const t=i(s),a=r[n]-t;return this.rect[e]+a},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class kr{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,s){var r;null==(r=this.target)||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function Cr(e,t){const s=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(s**2+r**2)>t:"x"in t&&"y"in t?s>t.x&&r>t.y:"x"in t?s>t.x:"y"in t&&r>t.y}var Sr,Mr,Tr,Er;function _r(e){e.preventDefault()}function Lr(e){e.stopPropagation()}(Mr=Sr||(Sr={})).Click="click",Mr.DragStart="dragstart",Mr.Keydown="keydown",Mr.ContextMenu="contextmenu",Mr.Resize="resize",Mr.SelectionChange="selectionchange",Mr.VisibilityChange="visibilitychange",(Er=Tr||(Tr={})).Space="Space",Er.Down="ArrowDown",Er.Right="ArrowRight",Er.Left="ArrowLeft",Er.Up="ArrowUp",Er.Esc="Escape",Er.Enter="Enter",Er.Tab="Tab";const Dr={start:[Tr.Space,Tr.Enter],cancel:[Tr.Esc],end:[Tr.Space,Tr.Enter,Tr.Tab]},Rr=(e,t)=>{let{currentCoordinates:s}=t;switch(e.code){case Tr.Right:return{...s,x:s.x+25};case Tr.Left:return{...s,x:s.x-25};case Tr.Down:return{...s,y:s.y+25};case Tr.Up:return{...s,y:s.y-25}}};class Ir{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new kr(hs(t)),this.windowListeners=new kr(ds(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Sr.Resize,this.handleCancel),this.windowListeners.add(Sr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Sr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&yr(s),t(Gs)}handleKeyDown(e){if(Ss(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:n=Dr,coordinateGetter:a=Rr,scrollBehavior:i="smooth"}=r,{code:l}=e;if(n.end.includes(l))return void this.handleEnd(e);if(n.cancel.includes(l))return void this.handleCancel(e);const{collisionRect:o}=s.current,c=o?{x:o.left,y:o.top}:Gs;this.referenceCoordinates||(this.referenceCoordinates=c);const d=a(e,{active:t,context:s.current,currentCoordinates:c});if(d){const t=Cs(d,c),r={x:0,y:0},{scrollableAncestors:n}=s.current;for(const s of n){const n=e.code,{isTop:a,isRight:l,isLeft:o,isBottom:c,maxScroll:u,minScroll:m}=fr(s),x=vr(s),h={x:Math.min(n===Tr.Right?x.right-x.width/2:x.right,Math.max(n===Tr.Right?x.left:x.left+x.width/2,d.x)),y:Math.min(n===Tr.Down?x.bottom-x.height/2:x.bottom,Math.max(n===Tr.Down?x.top:x.top+x.height/2,d.y))},p=n===Tr.Right&&!l||n===Tr.Left&&!o,f=n===Tr.Down&&!c||n===Tr.Up&&!a;if(p&&h.x!==d.x){const e=s.scrollLeft+t.x,a=n===Tr.Right&&e<=u.x||n===Tr.Left&&e>=m.x;if(a&&!t.y)return void s.scrollTo({left:e,behavior:i});r.x=a?s.scrollLeft-e:n===Tr.Right?s.scrollLeft-u.x:s.scrollLeft-m.x,r.x&&s.scrollBy({left:-r.x,behavior:i});break}if(f&&h.y!==d.y){const e=s.scrollTop+t.y,a=n===Tr.Down&&e<=u.y||n===Tr.Up&&e>=m.y;if(a&&!t.x)return void s.scrollTo({top:e,behavior:i});r.y=a?s.scrollTop-e:n===Tr.Down?s.scrollTop-u.y:s.scrollTop-m.y,r.y&&s.scrollBy({top:-r.y,behavior:i});break}}this.handleMove(e,ks(Cs(d,this.referenceCoordinates),r))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function zr(e){return Boolean(e&&"distance"in e)}function Or(e){return Boolean(e&&"delay"in e)}Ir.activators=[{eventName:"onKeyDown",handler:(e,t,s)=>{let{keyboardCodes:r=Dr,onActivation:n}=t,{active:a}=s;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const t=a.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==n||n({event:e.nativeEvent}),!0)}return!1}}];class Ar{constructor(e,t,s){var r;void 0===s&&(s=function(e){const{EventTarget:t}=ds(e);return e instanceof t?e:hs(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:n}=e,{target:a}=n;this.props=e,this.events=t,this.document=hs(a),this.documentListeners=new kr(this.document),this.listeners=new kr(s),this.windowListeners=new kr(ds(a)),this.initialCoordinates=null!=(r=Ms(n))?r:Gs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Sr.Resize,this.handleCancel),this.windowListeners.add(Sr.DragStart,_r),this.windowListeners.add(Sr.VisibilityChange,this.handleCancel),this.windowListeners.add(Sr.ContextMenu,_r),this.documentListeners.add(Sr.Keydown,this.handleKeydown),t){if(null!=s&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Or(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(zr(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Sr.Click,Lr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Sr.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:n}=this,{onMove:a,options:{activationConstraint:i}}=n;if(!r)return;const l=null!=(t=Ms(e))?t:Gs,o=Cs(r,l);if(!s&&i){if(zr(i)){if(null!=i.tolerance&&Cr(o,i.tolerance))return this.handleCancel();if(Cr(o,i.distance))return this.handleStart()}return Or(i)&&Cr(o,i.tolerance)?this.handleCancel():void this.handlePending(i,o)}e.cancelable&&e.preventDefault(),a(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===Tr.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const $r={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Br extends Ar{constructor(e){const{event:t}=e,s=hs(t.target);super(e,$r,s)}}Br.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return!(!s.isPrimary||0!==s.button)&&(null==r||r({event:s}),!0)}}];const Pr={move:{name:"mousemove"},end:{name:"mouseup"}};var Wr,Fr;(Fr=Wr||(Wr={}))[Fr.RightClick=2]="RightClick";(class extends Ar{constructor(e){super(e,Pr,hs(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return s.button!==Wr.RightClick&&(null==r||r({event:s}),!0)}}];const Gr={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var Kr,Ur,qr,Hr;function Vr(e){let{acceleration:t,activator:s=Kr.Pointer,canScroll:r,draggingRect:n,enabled:a,interval:i=5,order:l=qr.TreeOrder,pointerCoordinates:o,scrollableAncestors:c,scrollableAncestorRects:d,delta:u,threshold:x}=e;const h=function(e){let{delta:t,disabled:s}=e;const r=js(t);return bs(e=>{if(s||!r||!e)return Xr;const n={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[xr.Backward]:e.x[xr.Backward]||-1===n.x,[xr.Forward]:e.x[xr.Forward]||1===n.x},y:{[xr.Backward]:e.y[xr.Backward]||-1===n.y,[xr.Forward]:e.y[xr.Forward]||1===n.y}}},[s,t,r])}({delta:u,disabled:!a}),[p,f]=function(){const e=m.useRef(null);return[m.useCallback((t,s)=>{e.current=setInterval(t,s)},[]),m.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),g=m.useRef({x:0,y:0}),b=m.useRef({x:0,y:0}),v=m.useMemo(()=>{switch(s){case Kr.Pointer:return o?{top:o.y,bottom:o.y,left:o.x,right:o.x}:null;case Kr.DraggableRect:return n}},[s,n,o]),j=m.useRef(null),y=m.useCallback(()=>{const e=j.current;if(!e)return;const t=g.current.x*b.current.x,s=g.current.y*b.current.y;e.scrollBy(t,s)},[]),w=m.useMemo(()=>l===qr.TreeOrder?[...c].reverse():c,[l,c]);m.useEffect(()=>{if(a&&c.length&&v){for(const e of w){if(!1===(null==r?void 0:r(e)))continue;const s=c.indexOf(e),n=d[s];if(!n)continue;const{direction:a,speed:l}=br(e,n,v,t,x);for(const e of["x","y"])h[e][a[e]]||(l[e]=0,a[e]=0);if(l.x>0||l.y>0)return f(),j.current=e,p(y,i),g.current=l,void(b.current=a)}g.current={x:0,y:0},b.current={x:0,y:0},f()}else f()},[t,y,r,f,a,i,JSON.stringify(v),JSON.stringify(h),p,c,w,d,JSON.stringify(x)])}(class extends Ar{constructor(e){super(e,Gr)}static setup(){return window.addEventListener(Gr.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Gr.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;const{touches:n}=s;return!(n.length>1)&&(null==r||r({event:s}),!0)}}],(Ur=Kr||(Kr={}))[Ur.Pointer=0]="Pointer",Ur[Ur.DraggableRect=1]="DraggableRect",(Hr=qr||(qr={}))[Hr.TreeOrder=0]="TreeOrder",Hr[Hr.ReversedTreeOrder=1]="ReversedTreeOrder";const Xr={x:{[xr.Backward]:!1,[xr.Forward]:!1},y:{[xr.Backward]:!1,[xr.Forward]:!1}};var Yr,Jr,Qr;(Jr=Yr||(Yr={}))[Jr.Always=0]="Always",Jr[Jr.BeforeDragging=1]="BeforeDragging",Jr[Jr.WhileDragging=2]="WhileDragging",(Qr||(Qr={})).Optimized="optimized";const Zr=new Map;function en(e,t){return bs(s=>e?s||("function"==typeof t?t(e):e):null,[t,e])}function tn(e){let{callback:t,disabled:s}=e;const r=fs(t),n=m.useMemo(()=>{if(s||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(r)},[s]);return m.useEffect(()=>()=>null==n?void 0:n.disconnect(),[n]),n}function sn(e){return new Nr(ar(e),e)}function rn(e,t,s){void 0===t&&(t=sn);const[r,n]=m.useState(null);function a(){n(r=>{if(!e)return null;var n;if(!1===e.isConnected)return null!=(n=null!=r?r:s)?n:null;const a=t(e);return JSON.stringify(r)===JSON.stringify(a)?r:a})}const i=function(e){let{callback:t,disabled:s}=e;const r=fs(t),n=m.useMemo(()=>{if(s||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(r)},[r,s]);return m.useEffect(()=>()=>null==n?void 0:n.disconnect(),[n]),n}({callback(t){if(e)for(const s of t){const{type:t,target:r}=s;if("childList"===t&&r instanceof HTMLElement&&r.contains(e)){a();break}}}}),l=tn({callback:a});return ps(()=>{a(),e?(null==l||l.observe(e),null==i||i.observe(document.body,{childList:!0,subtree:!0})):(null==l||l.disconnect(),null==i||i.disconnect())},[e]),r}const nn=[];function an(e,t){void 0===t&&(t=[]);const s=m.useRef(null);return m.useEffect(()=>{s.current=null},t),m.useEffect(()=>{const t=e!==Gs;t&&!s.current&&(s.current=e),!t&&s.current&&(s.current=null)},[e]),s.current?Cs(e,s.current):Gs}function ln(e){return m.useMemo(()=>e?function(e){const t=e.innerWidth,s=e.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}(e):null,[e])}const on=[];function cn(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ms(t)?t:e}const dn=[{sensor:Br,options:{}},{sensor:Ir,options:{}}],un={current:{}},mn={draggable:{measure:ir},droppable:{measure:ir,strategy:Yr.WhileDragging,frequency:Qr.Optimized},dragOverlay:{measure:ar}};class xn extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return null!=(t=null==(s=this.get(e))?void 0:s.node.current)?t:void 0}}const hn={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new xn,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ps},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:mn,measureDroppableContainers:Ps,windowRect:null,measuringScheduled:!1},pn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ps,draggableNodes:new Map,over:null,measureDroppableContainers:Ps},fn=m.createContext(pn),gn=m.createContext(hn);function bn(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new xn}}}function vn(e,t){switch(t.type){case $s.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case $s.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case $s.DragEnd:case $s.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $s.RegisterDroppable:{const{element:s}=t,{id:r}=s,n=new xn(e.droppable.containers);return n.set(r,s),{...e,droppable:{...e.droppable,containers:n}}}case $s.SetDroppableDisabled:{const{id:s,key:r,disabled:n}=t,a=e.droppable.containers.get(s);if(!a||r!==a.key)return e;const i=new xn(e.droppable.containers);return i.set(s,{...a,disabled:n}),{...e,droppable:{...e.droppable,containers:i}}}case $s.UnregisterDroppable:{const{id:s,key:r}=t,n=e.droppable.containers.get(s);if(!n||r!==n.key)return e;const a=new xn(e.droppable.containers);return a.delete(s),{...e,droppable:{...e.droppable,containers:a}}}default:return e}}function jn(e){let{disabled:t}=e;const{active:s,activatorEvent:r,draggableNodes:n}=m.useContext(fn),a=js(r),i=js(null==s?void 0:s.id);return m.useEffect(()=>{if(!t&&!r&&a&&null!=i){if(!Ss(a))return;if(document.activeElement===a.target)return;const e=n.get(i);if(!e)return;const{activatorNode:t,node:s}=e;if(!t.current&&!s.current)return;requestAnimationFrame(()=>{for(const e of[t.current,s.current]){if(!e)continue;const t=_s(e);if(t){t.focus();break}}})}},[r,t,n,i,a]),null}function yn(e,t){let{transform:s,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),s):s}const wn=m.createContext({...Gs,scaleX:1,scaleY:1});var Nn,kn;(kn=Nn||(Nn={}))[kn.Uninitialized=0]="Uninitialized",kn[kn.Initializing=1]="Initializing",kn[kn.Initialized=2]="Initialized";const Cn=m.memo(function(e){var t,s,r,n;let{id:a,accessibility:i,autoScroll:l=!0,children:o,sensors:c=dn,collisionDetection:d=Qs,measuring:u,modifiers:x,...h}=e;const p=m.useReducer(vn,void 0,bn),[f,g]=p,[j,y]=function(){const[e]=m.useState(()=>new Set),t=m.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[m.useCallback(t=>{let{type:s,event:r}=t;e.forEach(e=>{var t;return null==(t=e[s])?void 0:t.call(e,r)})},[e]),t]}(),[w,N]=m.useState(Nn.Uninitialized),k=w===Nn.Initialized,{draggable:{active:C,nodes:S,translate:M},droppable:{containers:T}}=f,E=null!=C?S.get(C):null,_=m.useRef({initial:null,translated:null}),L=m.useMemo(()=>{var e;return null!=C?{id:C,data:null!=(e=null==E?void 0:E.data)?e:un,rect:_}:null},[C,E]),D=m.useRef(null),[R,I]=m.useState(null),[z,O]=m.useState(null),A=gs(h,Object.values(h)),$=ws("DndDescribedBy",a),B=m.useMemo(()=>T.getEnabled(),[T]),P=(W=u,m.useMemo(()=>({draggable:{...mn.draggable,...null==W?void 0:W.draggable},droppable:{...mn.droppable,...null==W?void 0:W.droppable},dragOverlay:{...mn.dragOverlay,...null==W?void 0:W.dragOverlay}}),[null==W?void 0:W.draggable,null==W?void 0:W.droppable,null==W?void 0:W.dragOverlay]));var W;const{droppableRects:F,measureDroppableContainers:G,measuringScheduled:K}=function(e,t){let{dragging:s,dependencies:r,config:n}=t;const[a,i]=m.useState(null),{frequency:l,measure:o,strategy:c}=n,d=m.useRef(e),u=function(){switch(c){case Yr.Always:return!1;case Yr.BeforeDragging:return s;default:return!s}}(),x=gs(u),h=m.useCallback(function(e){void 0===e&&(e=[]),x.current||i(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[x]),p=m.useRef(null),f=bs(t=>{if(u&&!s)return Zr;if(!t||t===Zr||d.current!==e||null!=a){const t=new Map;for(let s of e){if(!s)continue;if(a&&a.length>0&&!a.includes(s.id)&&s.rect.current){t.set(s.id,s.rect.current);continue}const e=s.node.current,r=e?new Nr(o(e),e):null;s.rect.current=r,r&&t.set(s.id,r)}return t}return t},[e,a,s,u,o]);return m.useEffect(()=>{d.current=e},[e]),m.useEffect(()=>{u||h()},[s,u]),m.useEffect(()=>{a&&a.length>0&&i(null)},[JSON.stringify(a)]),m.useEffect(()=>{u||"number"!=typeof l||null!==p.current||(p.current=setTimeout(()=>{h(),p.current=null},l))},[l,u,h,...r]),{droppableRects:f,measureDroppableContainers:h,measuringScheduled:null!=a}}(B,{dragging:k,dependencies:[M.x,M.y],config:P.droppable}),U=function(e,t){const s=null!=t?e.get(t):void 0,r=s?s.node.current:null;return bs(e=>{var s;return null==t?null:null!=(s=null!=r?r:e)?s:null},[r,t])}(S,C),q=m.useMemo(()=>z?Ms(z):null,[z]),H=function(){const e=!1===(null==R?void 0:R.autoScrollEnabled),t="object"==typeof l?!1===l.enabled:!1===l,s=k&&!e&&!t;if("object"==typeof l)return{...l,enabled:s};return{enabled:s}}(),V=function(e,t){return en(e,t)}(U,P.draggable.measure);!function(e){let{activeNode:t,measure:s,initialRect:r,config:n=!0}=e;const a=m.useRef(!1),{x:i,y:l}="boolean"==typeof n?{x:n,y:n}:n;ps(()=>{if(!i&&!l||!t)return void(a.current=!1);if(a.current||!r)return;const e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;const n=er(s(e),r);if(i||(n.x=0),l||(n.y=0),a.current=!0,Math.abs(n.x)>0||Math.abs(n.y)>0){const t=or(e);t&&t.scrollBy({top:n.y,left:n.x})}},[t,i,l,r,s])}({activeNode:null!=C?S.get(C):null,config:H.layoutShiftCompensation,initialRect:V,measure:P.draggable.measure});const X=rn(U,P.draggable.measure,V),Y=rn(U?U.parentElement:null),J=m.useRef({activatorEvent:null,active:null,activeNode:U,collisionRect:null,collisions:null,droppableRects:F,draggableNodes:S,draggingNode:null,draggingNodeRect:null,droppableContainers:T,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Q=T.getNodeFor(null==(t=J.current.over)?void 0:t.id),Z=function(e){let{measure:t}=e;const[s,r]=m.useState(null),n=tn({callback:m.useCallback(e=>{for(const{target:s}of e)if(ms(s)){r(e=>{const r=t(s);return e?{...e,width:r.width,height:r.height}:r});break}},[t])}),a=m.useCallback(e=>{const s=cn(e);null==n||n.disconnect(),s&&(null==n||n.observe(s)),r(s?t(s):null)},[t,n]),[i,l]=vs(a);return m.useMemo(()=>({nodeRef:i,rect:s,setRef:l}),[s,i,l])}({measure:P.dragOverlay.measure}),ee=null!=(s=Z.nodeRef.current)?s:U,te=k?null!=(r=Z.rect)?r:X:null,se=Boolean(Z.nodeRef.current&&Z.rect),re=er(ne=se?null:X,en(ne));var ne;const ae=ln(ee?ds(ee):null),ie=function(e){const t=m.useRef(e),s=bs(s=>e?s&&s!==nn&&e&&t.current&&e.parentNode===t.current.parentNode?s:lr(e):nn,[e]);return m.useEffect(()=>{t.current=e},[e]),s}(k?null!=Q?Q:U:null),le=function(e,t){void 0===t&&(t=ar);const[s]=e,r=ln(s?ds(s):null),[n,a]=m.useState(on);function i(){a(()=>e.length?e.map(e=>pr(e)?r:new Nr(t(e),e)):on)}const l=tn({callback:i});return ps(()=>{null==l||l.disconnect(),i(),e.forEach(e=>null==l?void 0:l.observe(e))},[e]),n}(ie),oe=yn(x,{transform:{x:M.x-re.x,y:M.y-re.y,scaleX:1,scaleY:1},activatorEvent:z,active:L,activeNodeRect:X,containerNodeRect:Y,draggingNodeRect:te,over:J.current.over,overlayNodeRect:Z.rect,scrollableAncestors:ie,scrollableAncestorRects:le,windowRect:ae}),ce=q?ks(q,M):null,de=function(e){const[t,s]=m.useState(null),r=m.useRef(e),n=m.useCallback(e=>{const t=cr(e.target);t&&s(e=>e?(e.set(t,mr(t)),new Map(e)):null)},[]);return m.useEffect(()=>{const t=r.current;if(e!==t){a(t);const i=e.map(e=>{const t=cr(e);return t?(t.addEventListener("scroll",n,{passive:!0}),[t,mr(t)]):null}).filter(e=>null!=e);s(i.length?new Map(i):null),r.current=e}return()=>{a(e),a(t)};function a(e){e.forEach(e=>{const t=cr(e);null==t||t.removeEventListener("scroll",n)})}},[n,e]),m.useMemo(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>ks(e,t),Gs):jr(e):Gs,[e,t])}(ie),ue=an(de),me=an(de,[X]),xe=ks(oe,ue),he=te?sr(te,oe):null,pe=L&&he?d({active:L,collisionRect:he,droppableRects:F,droppableContainers:B,pointerCoordinates:ce}):null,fe=function(e,t){if(!e||0===e.length)return null;const[s]=e;return s[t]}(pe,"id"),[ge,be]=m.useState(null),ve=function(e,t,s){return{...e,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}(se?oe:ks(oe,me),null!=(n=null==ge?void 0:ge.rect)?n:null,X),je=m.useRef(null),ye=m.useCallback((e,t)=>{let{sensor:s,options:r}=t;if(null==D.current)return;const n=S.get(D.current);if(!n)return;const a=e.nativeEvent,i=new s({active:D.current,activeNode:n,event:a,options:r,context:J,onAbort(e){if(!S.get(e))return;const{onDragAbort:t}=A.current,s={id:e};null==t||t(s),j({type:"onDragAbort",event:s})},onPending(e,t,s,r){if(!S.get(e))return;const{onDragPending:n}=A.current,a={id:e,constraint:t,initialCoordinates:s,offset:r};null==n||n(a),j({type:"onDragPending",event:a})},onStart(e){const t=D.current;if(null==t)return;const s=S.get(t);if(!s)return;const{onDragStart:r}=A.current,n={activatorEvent:a,active:{id:t,data:s.data,rect:_}};b.unstable_batchedUpdates(()=>{null==r||r(n),N(Nn.Initializing),g({type:$s.DragStart,initialCoordinates:e,active:t}),j({type:"onDragStart",event:n}),I(je.current),O(a)})},onMove(e){g({type:$s.DragMove,coordinates:e})},onEnd:l($s.DragEnd),onCancel:l($s.DragCancel)});function l(e){return async function(){const{active:t,collisions:s,over:r,scrollAdjustedTranslate:n}=J.current;let i=null;if(t&&n){const{cancelDrop:l}=A.current;if(i={activatorEvent:a,active:t,collisions:s,delta:n,over:r},e===$s.DragEnd&&"function"==typeof l){await Promise.resolve(l(i))&&(e=$s.DragCancel)}}D.current=null,b.unstable_batchedUpdates(()=>{g({type:e}),N(Nn.Uninitialized),be(null),I(null),O(null),je.current=null;const t=e===$s.DragEnd?"onDragEnd":"onDragCancel";if(i){const e=A.current[t];null==e||e(i),j({type:t,event:i})}})}}je.current=i},[S]),we=function(e,t){return m.useMemo(()=>e.reduce((e,s)=>{const{sensor:r}=s;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:t(e.handler,s)}))]},[]),[e,t])}(c,m.useCallback((e,t)=>(s,r)=>{const n=s.nativeEvent,a=S.get(r);if(null!==D.current||!a||n.dndKit||n.defaultPrevented)return;const i={active:a};!0===e(s,t.options,i)&&(n.dndKit={capturedBy:t.sensor},D.current=r,ye(s,t))},[S,ye]));!function(e){m.useEffect(()=>{if(!ls)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(c),ps(()=>{X&&w===Nn.Initializing&&N(Nn.Initialized)},[X,w]),m.useEffect(()=>{const{onDragMove:e}=A.current,{active:t,activatorEvent:s,collisions:r,over:n}=J.current;if(!t||!s)return;const a={active:t,activatorEvent:s,collisions:r,delta:{x:xe.x,y:xe.y},over:n};b.unstable_batchedUpdates(()=>{null==e||e(a),j({type:"onDragMove",event:a})})},[xe.x,xe.y]),m.useEffect(()=>{const{active:e,activatorEvent:t,collisions:s,droppableContainers:r,scrollAdjustedTranslate:n}=J.current;if(!e||null==D.current||!t||!n)return;const{onDragOver:a}=A.current,i=r.get(fe),l=i&&i.rect.current?{id:i.id,rect:i.rect.current,data:i.data,disabled:i.disabled}:null,o={active:e,activatorEvent:t,collisions:s,delta:{x:n.x,y:n.y},over:l};b.unstable_batchedUpdates(()=>{be(l),null==a||a(o),j({type:"onDragOver",event:o})})},[fe]),ps(()=>{J.current={activatorEvent:z,active:L,activeNode:U,collisionRect:he,collisions:pe,droppableRects:F,draggableNodes:S,draggingNode:ee,draggingNodeRect:te,droppableContainers:T,over:ge,scrollableAncestors:ie,scrollAdjustedTranslate:xe},_.current={initial:te,translated:he}},[L,U,pe,he,S,ee,te,F,T,ge,ie,xe]),Vr({...H,delta:M,draggingRect:he,pointerCoordinates:ce,scrollableAncestors:ie,scrollableAncestorRects:le});const Ne=m.useMemo(()=>({active:L,activeNode:U,activeNodeRect:X,activatorEvent:z,collisions:pe,containerNodeRect:Y,dragOverlay:Z,draggableNodes:S,droppableContainers:T,droppableRects:F,over:ge,measureDroppableContainers:G,scrollableAncestors:ie,scrollableAncestorRects:le,measuringConfiguration:P,measuringScheduled:K,windowRect:ae}),[L,U,X,z,pe,Y,Z,S,T,F,ge,G,ie,le,P,K,ae]),ke=m.useMemo(()=>({activatorEvent:z,activators:we,active:L,activeNodeRect:X,ariaDescribedById:{draggable:$},dispatch:g,draggableNodes:S,over:ge,measureDroppableContainers:G}),[z,we,L,X,g,$,S,ge,G]);return v.createElement(Is.Provider,{value:y},v.createElement(fn.Provider,{value:ke},v.createElement(gn.Provider,{value:Ne},v.createElement(wn.Provider,{value:ve},o)),v.createElement(jn,{disabled:!1===(null==i?void 0:i.restoreFocus)})),v.createElement(As,{...i,hiddenTextDescribedById:$}))}),Sn=m.createContext(null),Mn="button";function Tn(e){let{id:t,data:s,disabled:r=!1,attributes:n}=e;const a=ws("Draggable"),{activators:i,activatorEvent:l,active:o,activeNodeRect:c,ariaDescribedById:d,draggableNodes:u,over:x}=m.useContext(fn),{role:h=Mn,roleDescription:p="draggable",tabIndex:f=0}=null!=n?n:{},g=(null==o?void 0:o.id)===t,b=m.useContext(g?wn:Sn),[v,j]=vs(),[y,w]=vs(),N=function(e,t){return m.useMemo(()=>e.reduce((e,s)=>{let{eventName:r,handler:n}=s;return e[r]=e=>{n(e,t)},e},{}),[e,t])}(i,t),k=gs(s);ps(()=>(u.set(t,{id:t,key:a,node:v,activatorNode:y,data:k}),()=>{const e=u.get(t);e&&e.key===a&&u.delete(t)}),[u,t]);return{active:o,activatorEvent:l,activeNodeRect:c,attributes:m.useMemo(()=>({role:h,tabIndex:f,"aria-disabled":r,"aria-pressed":!(!g||h!==Mn)||void 0,"aria-roledescription":p,"aria-describedby":d.draggable}),[r,h,f,g,p,d.draggable]),isDragging:g,listeners:r?void 0:N,node:v,over:x,setNodeRef:j,setActivatorNodeRef:w,transform:b}}function En(){return m.useContext(gn)}const _n={timeout:25};function Ln(e){let{animation:t,children:s}=e;const[r,n]=m.useState(null),[a,i]=m.useState(null),l=js(s);return s||r||!l||n(l),ps(()=>{if(!a)return;const e=null==r?void 0:r.key,s=null==r?void 0:r.props.id;null!=e&&null!=s?Promise.resolve(t(s,a)).then(()=>{n(null)}):n(null)},[t,r,a]),v.createElement(v.Fragment,null,s,r?m.cloneElement(r,{ref:i}):null)}const Dn={x:0,y:0,scaleX:1,scaleY:1};function Rn(e){let{children:t}=e;return v.createElement(fn.Provider,{value:pn},v.createElement(wn.Provider,{value:Dn},t))}const In={position:"fixed",touchAction:"none"},zn=e=>Ss(e)?"transform 250ms ease":void 0,On=m.forwardRef((e,t)=>{let{as:s,activatorEvent:r,adjustScale:n,children:a,className:i,rect:l,style:o,transform:c,transition:d=zn}=e;if(!l)return null;const u=n?c:{...c,scaleX:1,scaleY:1},m={...In,width:l.width,height:l.height,top:l.top,left:l.left,transform:Ts.Transform.toString(u),transformOrigin:n&&r?Us(r,l):void 0,transition:"function"==typeof d?d(r):d,...o};return v.createElement(s,{className:i,style:m,ref:t},a)}),An={duration:250,easing:"ease",keyframes:e=>{let{transform:{initial:t,final:s}}=e;return[{transform:Ts.Transform.toString(t)},{transform:Ts.Transform.toString(s)}]},sideEffects:(e=>t=>{let{active:s,dragOverlay:r}=t;const n={},{styles:a,className:i}=e;if(null!=a&&a.active)for(const[e,l]of Object.entries(a.active))void 0!==l&&(n[e]=s.node.style.getPropertyValue(e),s.node.style.setProperty(e,l));if(null!=a&&a.dragOverlay)for(const[e,l]of Object.entries(a.dragOverlay))void 0!==l&&r.node.style.setProperty(e,l);return null!=i&&i.active&&s.node.classList.add(i.active),null!=i&&i.dragOverlay&&r.node.classList.add(i.dragOverlay),function(){for(const[e,t]of Object.entries(n))s.node.style.setProperty(e,t);null!=i&&i.active&&s.node.classList.remove(i.active)}})({styles:{active:{opacity:"0"}}})};function $n(e){let{config:t,draggableNodes:s,droppableContainers:r,measuringConfiguration:n}=e;return fs((e,a)=>{if(null===t)return;const i=s.get(e);if(!i)return;const l=i.node.current;if(!l)return;const o=cn(a);if(!o)return;const{transform:c}=ds(a).getComputedStyle(a),d=rr(c);if(!d)return;const u="function"==typeof t?t:function(e){const{duration:t,easing:s,sideEffects:r,keyframes:n}={...An,...e};return e=>{let{active:a,dragOverlay:i,transform:l,...o}=e;if(!t)return;const c={x:i.rect.left-a.rect.left,y:i.rect.top-a.rect.top},d={scaleX:1!==l.scaleX?a.rect.width*l.scaleX/i.rect.width:1,scaleY:1!==l.scaleY?a.rect.height*l.scaleY/i.rect.height:1},u={x:l.x-c.x,y:l.y-c.y,...d},m=n({...o,active:a,dragOverlay:i,transform:{initial:l,final:u}}),[x]=m,h=m[m.length-1];if(JSON.stringify(x)===JSON.stringify(h))return;const p=null==r?void 0:r({active:a,dragOverlay:i,...o}),f=i.node.animate(m,{duration:t,easing:s,fill:"forwards"});return new Promise(e=>{f.onfinish=()=>{null==p||p(),e()}})}}(t);return yr(l,n.draggable.measure),u({active:{id:e,data:i.data,node:l,rect:n.draggable.measure(l)},draggableNodes:s,dragOverlay:{node:a,rect:n.dragOverlay.measure(o)},droppableContainers:r,measuringConfiguration:n,transform:d})})}let Bn=0;const Pn=v.memo(e=>{let{adjustScale:t=!1,children:s,dropAnimation:r,style:n,transition:a,modifiers:i,wrapperElement:l="div",className:o,zIndex:c=999}=e;const{activatorEvent:d,active:u,activeNodeRect:x,containerNodeRect:h,draggableNodes:p,droppableContainers:f,dragOverlay:g,over:b,measuringConfiguration:j,scrollableAncestors:y,scrollableAncestorRects:w,windowRect:N}=En(),k=m.useContext(wn),C=(S=null==u?void 0:u.id,m.useMemo(()=>{if(null!=S)return Bn++,Bn},[S]));var S;const M=yn(i,{activatorEvent:d,active:u,activeNodeRect:x,containerNodeRect:h,draggingNodeRect:g.rect,over:b,overlayNodeRect:g.rect,scrollableAncestors:y,scrollableAncestorRects:w,transform:k,windowRect:N}),T=en(x),E=$n({config:r,draggableNodes:p,droppableContainers:f,measuringConfiguration:j}),_=T?g.setRef:void 0;return v.createElement(Rn,null,v.createElement(Ln,{animation:E},u&&C?v.createElement(On,{key:C,id:u.id,ref:_,as:l,activatorEvent:d,adjustScale:t,className:o,transition:a,rect:T,style:{zIndex:c,...n},transform:M},s):null))});function Wn(e,t,s){const r=e.slice();return r.splice(s<0?r.length+s:s,0,r.splice(t,1)[0]),r}function Fn(e,t){return e.reduce((e,s,r)=>{const n=t.get(s);return n&&(e[r]=n),e},Array(e.length))}function Gn(e){return null!==e&&e>=0}const Kn=e=>{let{rects:t,activeIndex:s,overIndex:r,index:n}=e;const a=Wn(t,r,s),i=t[n],l=a[n];return l&&i?{x:l.left-i.left,y:l.top-i.top,scaleX:l.width/i.width,scaleY:l.height/i.height}:null},Un={scaleX:1,scaleY:1},qn=e=>{var t;let{activeIndex:s,activeNodeRect:r,index:n,rects:a,overIndex:i}=e;const l=null!=(t=a[s])?t:r;if(!l)return null;if(n===s){const e=a[i];return e?{x:0,y:s<i?e.top+e.height-(l.top+l.height):e.top-l.top,...Un}:null}const o=function(e,t,s){const r=e[t],n=e[t-1],a=e[t+1];if(!r)return 0;if(s<t)return n?r.top-(n.top+n.height):a?a.top-(r.top+r.height):0;return a?a.top-(r.top+r.height):n?r.top-(n.top+n.height):0}(a,n,s);return n>s&&n<=i?{x:0,y:-l.height-o,...Un}:n<s&&n>=i?{x:0,y:l.height+o,...Un}:{x:0,y:0,...Un}};const Hn="Sortable",Vn=v.createContext({activeIndex:-1,containerId:Hn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Kn,disabled:{draggable:!1,droppable:!1}});function Xn(e){let{children:t,id:s,items:r,strategy:n=Kn,disabled:a=!1}=e;const{active:i,dragOverlay:l,droppableRects:o,over:c,measureDroppableContainers:d}=En(),u=ws(Hn,s),x=Boolean(null!==l.rect),h=m.useMemo(()=>r.map(e=>"object"==typeof e&&"id"in e?e.id:e),[r]),p=null!=i,f=i?h.indexOf(i.id):-1,g=c?h.indexOf(c.id):-1,b=m.useRef(h),j=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}(h,b.current),y=-1!==g&&-1===f||j,w=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(a);ps(()=>{j&&p&&d(h)},[j,h,p,d]),m.useEffect(()=>{b.current=h},[h]);const N=m.useMemo(()=>({activeIndex:f,containerId:u,disabled:w,disableTransforms:y,items:h,overIndex:g,useDragOverlay:x,sortedRects:Fn(h,o),strategy:n}),[f,u,w.draggable,w.droppable,y,h,g,o,x,n]);return v.createElement(Vn.Provider,{value:N},t)}const Yn=e=>{let{id:t,items:s,activeIndex:r,overIndex:n}=e;return Wn(s,r,n).indexOf(t)},Jn=e=>{let{containerId:t,isSorting:s,wasDragging:r,index:n,items:a,newIndex:i,previousItems:l,previousContainerId:o,transition:c}=e;return!(!c||!r)&&((l===a||n!==i)&&(!!s||i!==n&&t===o))},Qn={duration:200,easing:"ease"},Zn="transform",ea=Ts.Transition.toString({property:Zn,duration:0,easing:"linear"}),ta={roleDescription:"sortable"};function sa(e){let{animateLayoutChanges:t=Jn,attributes:s,disabled:r,data:n,getNewIndex:a=Yn,id:i,strategy:l,resizeObserverConfig:o,transition:c=Qn}=e;const{items:d,containerId:u,activeIndex:x,disabled:h,disableTransforms:p,sortedRects:f,overIndex:g,useDragOverlay:b,strategy:v}=m.useContext(Vn),j=function(e,t){var s,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(s=null==e?void 0:e.draggable)?s:t.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:t.droppable}}(r,h),y=d.indexOf(i),w=m.useMemo(()=>({sortable:{containerId:u,index:y,items:d},...n}),[u,n,y,d]),N=m.useMemo(()=>d.slice(d.indexOf(i)),[d,i]),{rect:k,node:C,isOver:S,setNodeRef:M}=function(e){let{data:t,disabled:s=!1,id:r,resizeObserverConfig:n}=e;const a=ws("Droppable"),{active:i,dispatch:l,over:o,measureDroppableContainers:c}=m.useContext(fn),d=m.useRef({disabled:s}),u=m.useRef(!1),x=m.useRef(null),h=m.useRef(null),{disabled:p,updateMeasurementsFor:f,timeout:g}={..._n,...n},b=gs(null!=f?f:r),v=tn({callback:m.useCallback(()=>{u.current?(null!=h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{c(Array.isArray(b.current)?b.current:[b.current]),h.current=null},g)):u.current=!0},[g]),disabled:p||!i}),j=m.useCallback((e,t)=>{v&&(t&&(v.unobserve(t),u.current=!1),e&&v.observe(e))},[v]),[y,w]=vs(j),N=gs(t);return m.useEffect(()=>{v&&y.current&&(v.disconnect(),u.current=!1,v.observe(y.current))},[y,v]),m.useEffect(()=>(l({type:$s.RegisterDroppable,element:{id:r,key:a,disabled:s,node:y,rect:x,data:N}}),()=>l({type:$s.UnregisterDroppable,key:a,id:r})),[r]),m.useEffect(()=>{s!==d.current.disabled&&(l({type:$s.SetDroppableDisabled,id:r,key:a,disabled:s}),d.current.disabled=s)},[r,a,s,l]),{active:i,rect:x,isOver:(null==o?void 0:o.id)===r,node:y,over:o,setNodeRef:w}}({id:i,data:w,disabled:j.droppable,resizeObserverConfig:{updateMeasurementsFor:N,...o}}),{active:T,activatorEvent:E,activeNodeRect:_,attributes:L,setNodeRef:D,listeners:R,isDragging:I,over:z,setActivatorNodeRef:O,transform:A}=Tn({id:i,data:w,attributes:{...ta,...s},disabled:j.draggable}),$=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return m.useMemo(()=>e=>{t.forEach(t=>t(e))},t)}(M,D),B=Boolean(T),P=B&&!p&&Gn(x)&&Gn(g),W=!b&&I,F=W&&P?A:null,G=P?null!=F?F:(null!=l?l:v)({rects:f,activeNodeRect:_,activeIndex:x,overIndex:g,index:y}):null,K=Gn(x)&&Gn(g)?a({id:i,items:d,activeIndex:x,overIndex:g}):y,U=null==T?void 0:T.id,q=m.useRef({activeId:U,items:d,newIndex:K,containerId:u}),H=d!==q.current.items,V=t({active:T,containerId:u,isDragging:I,isSorting:B,id:i,index:y,items:d,newIndex:q.current.newIndex,previousItems:q.current.items,previousContainerId:q.current.containerId,transition:c,wasDragging:null!=q.current.activeId}),X=function(e){let{disabled:t,index:s,node:r,rect:n}=e;const[a,i]=m.useState(null),l=m.useRef(s);return ps(()=>{if(!t&&s!==l.current&&r.current){const e=n.current;if(e){const t=ar(r.current,{ignoreTransform:!0}),s={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(s.x||s.y)&&i(s)}}s!==l.current&&(l.current=s)},[t,s,r,n]),m.useEffect(()=>{a&&i(null)},[a]),a}({disabled:!V,index:y,node:C,rect:k});return m.useEffect(()=>{B&&q.current.newIndex!==K&&(q.current.newIndex=K),u!==q.current.containerId&&(q.current.containerId=u),d!==q.current.items&&(q.current.items=d)},[B,K,u,d]),m.useEffect(()=>{if(U===q.current.activeId)return;if(null!=U&&null==q.current.activeId)return void(q.current.activeId=U);const e=setTimeout(()=>{q.current.activeId=U},50);return()=>clearTimeout(e)},[U]),{active:T,activeIndex:x,attributes:L,data:w,rect:k,index:y,newIndex:K,items:d,isOver:S,isSorting:B,isDragging:I,listeners:R,node:C,overIndex:g,over:z,setNodeRef:$,setActivatorNodeRef:O,setDroppableNodeRef:M,setDraggableNodeRef:D,transform:null!=X?X:G,transition:function(){if(X||H&&q.current.newIndex===y)return ea;if(W&&!Ss(E)||!c)return;if(B||V)return Ts.Transition.toString({...c,property:Zn});return}()}}function ra({item:e,groupId:t,isHighlighted:r,isSelected:n,batchMode:a,editingItemId:i,editingTitle:l,onItemClick:o,onEditItem:c,onSaveEdit:d,onTogglePin:u,onToggleTodo:m,onDeleteItem:x,onMoveItem:h,setEditingItemId:p,setEditingTitle:f,extractDomain:g}){const{attributes:b,listeners:v,setNodeRef:j,transform:y,transition:w,isDragging:N}=sa({id:e.id}),k={transform:Ts.Transform.toString(y),transition:w,opacity:N?.5:1},C=i===e.id;return s.jsxs("div",{ref:j,style:k,className:"group flex items-center gap-3 p-3 rounded border transition-all "+(r?"bg-warning/10 border-warning/30":n?"bg-primary/10 border-primary/30":"bg-card border-border hover:bg-muted"),children:[!a&&s.jsx("button",{...b,...v,className:"cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground",children:s.jsx(be,{className:"w-4 h-4"})}),a&&s.jsx("input",{type:"checkbox",checked:n,onChange:t=>{t.stopPropagation(),o(e,t)},className:"checkbox"}),s.jsx("img",{src:`https://www.google.com/s2/favicons?domain=${g(e.url)}&sz=32`,alt:"",className:"w-5 h-5 flex-shrink-0",onError:e=>{e.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>'}}),s.jsx("div",{className:"flex-1 min-w-0",children:C?s.jsx("input",{type:"text",value:l,onChange:e=>f(e.target.value),onKeyDown:s=>{"Enter"===s.key?d(t,e.id):"Escape"===s.key&&p(null)},className:"input w-full text-sm",autoFocus:!0}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-foreground hover:text-primary truncate",onClick:e=>!a&&e.stopPropagation(),children:e.title}),1===e.is_pinned&&s.jsx(Ee,{className:"w-3 h-3 text-warning flex-shrink-0"}),1===e.is_todo&&s.jsx(ze,{className:"w-3 h-3 text-accent flex-shrink-0"})]}),s.jsx("p",{className:"text-xs text-muted-foreground truncate",children:e.url})]})}),!a&&s.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:C?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>d(t,e.id),className:"p-1.5 text-success hover:bg-success/10 rounded transition-colors",title:"保存",children:s.jsx(H,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>p(null),className:"p-1.5 text-muted-foreground hover:bg-muted rounded transition-colors",title:"取消",children:s.jsx(We,{className:"w-4 h-4"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 text-muted-foreground hover:bg-muted rounded transition-colors",title:"打开链接",children:s.jsx(oe,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>c(e),className:"p-1.5 text-muted-foreground hover:bg-muted rounded transition-colors",title:"编辑",children:s.jsx(Te,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>u(t,e.id,e.is_pinned||0),className:"p-1.5 rounded transition-colors "+(1===e.is_pinned?"text-warning bg-warning/10 hover:bg-warning/20":"text-muted-foreground hover:bg-muted"),title:1===e.is_pinned?"取消固定":"固定",children:s.jsx(Ee,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>m(t,e.id,e.is_todo||0),className:"p-1.5 rounded transition-colors "+(1===e.is_todo?"text-accent bg-accent/10 hover:bg-accent/20":"text-muted-foreground hover:bg-muted"),title:1===e.is_todo?"取消待办":"标记待办",children:s.jsx(ze,{className:"w-4 h-4"})}),h&&s.jsx("button",{onClick:()=>h(e),className:"p-1.5 text-muted-foreground hover:bg-muted rounded transition-colors",title:"移动到其他组",children:s.jsx(xe,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>x(t,e.id,e.title),className:"p-1.5 text-destructive hover:bg-destructive/10 rounded transition-colors",title:"删除",children:s.jsx(Oe,{className:"w-4 h-4"})})]})})]})}function na({items:e,groupId:t,highlightedDomain:r,selectedItems:n,batchMode:a,editingItemId:i,editingTitle:l,onItemClick:o,onEditItem:c,onSaveEdit:d,onTogglePin:u,onToggleTodo:m,onDeleteItem:x,onMoveItem:h,setEditingItemId:p,setEditingTitle:f,extractDomain:g}){return e&&0!==e.length?s.jsx(Xn,{items:e.map(e=>e.id),strategy:qn,children:s.jsx("div",{className:"space-y-2",children:e.map(e=>{const b=g(e.url),v=r===b,j=n.has(e.id);return s.jsx(ra,{item:e,groupId:t,isHighlighted:v,isSelected:j,batchMode:a,editingItemId:i,editingTitle:l,onItemClick:o,onEditItem:c,onSaveEdit:d,onTogglePin:u,onToggleTodo:m,onDeleteItem:x,onMoveItem:h,setEditingItemId:p,setEditingTitle:f,extractDomain:g},e.id)})})}):s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"此标签页组没有标签页"})}function aa({trigger:e,items:t,align:r="right"}){const[n,a]=m.useState(!1),[i,l]=m.useState({top:0,left:0,right:0}),o=m.useRef(null),c=m.useRef(null);return m.useEffect(()=>{if(n&&o.current){const e=o.current.getBoundingClientRect();l({top:e.bottom+4,left:"left"===r?e.left:0,right:"right"===r?window.innerWidth-e.right:0})}},[n,r]),m.useEffect(()=>{const e=e=>{o.current&&!o.current.contains(e.target)&&c.current&&!c.current.contains(e.target)&&a(!1)};return n&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[n]),s.jsxs(s.Fragment,{children:[s.jsx("div",{ref:o,onClick:()=>a(!n),children:e}),n&&b.createPortal(s.jsx("div",{ref:c,className:"fixed w-56 rounded shadow-2xl border py-1",style:{top:`${i.top}px`,left:"left"===r?`${i.left}px`:"auto",right:"right"===r?`${i.right}px`:"auto",zIndex:999999,backgroundColor:"var(--card)",borderColor:"var(--border)"},children:t.map((e,t)=>s.jsxs("div",{children:[e.divider&&t>0&&s.jsx("div",{className:"my-1 h-px bg-border"}),s.jsxs("button",{onClick:()=>{e.disabled||(e.onClick(),a(!1))},disabled:e.disabled,className:`w-full flex items-center gap-3 px-4 py-2 text-sm text-left transition-colors ${e.danger?"text-destructive hover:bg-destructive/10":"text-foreground hover:bg-muted"} ${e.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.icon&&s.jsx("span",{className:"flex-shrink-0",children:e.icon}),s.jsx("span",{className:"flex-1",children:e.label})]})]},t))}),document.body)]})}function ia({isOpen:e,currentGroup:t,allGroups:r,onConfirm:n,onCancel:a}){const[i,l]=m.useState(null),[o,c]=m.useState(new Set);m.useEffect(()=>(document.body.style.overflow=e?"hidden":"",()=>{document.body.style.overflow=""}),[e]);const d=e=>{const t=new Set([e]);return r.filter(t=>t.parent_id===e).forEach(e=>{d(e.id).forEach(e=>t.add(e))}),t},u=d(t.id),x=r.filter(e=>1===e.is_folder&&!u.has(e.id)),h=(e=null)=>x.filter(t=>(t.parent_id||null)===e).sort((e,t)=>(e.position||0)-(t.position||0)),p=()=>{l(null),a()};if(!e)return null;const f=(e,t=0)=>e.map(e=>{const r=o.has(e.id),n=i===e.id,a=h(e.id),d=a.length>0;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-colors "+(n?"bg-primary text-primary-content":"hover:bg-muted"),style:{paddingLeft:20*t+12+"px"},onClick:()=>l(e.id),children:[d?s.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{const t=new Set(o);t.has(e)?t.delete(e):t.add(e),c(t)})(e.id)},className:"w-4 h-4 flex items-center justify-center hover:bg-muted/80 rounded",children:r?s.jsx(V,{className:"w-3 h-3"}):s.jsx(X,{className:"w-3 h-3"})}):s.jsx("div",{className:"w-4"}),s.jsx(fe,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"flex-1 truncate text-sm",children:e.title}),void 0!==e.item_count&&s.jsx("span",{className:"text-xs opacity-60",children:e.item_count})]}),r&&d&&s.jsx("div",{children:f(a,t+1)})]},e.id)}),g=h(null);return s.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-fade-in",children:[s.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:p}),s.jsxs("div",{className:"relative card rounded-3xl shadow-2xl border max-w-lg w-full animate-scale-in",style:{backgroundColor:"var(--card)",borderColor:"var(--border)"},children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"font-bold text-2xl text-base-content",children:"移动到文件夹"}),s.jsxs("p",{className:"text-sm text-base-content/70 mt-2",children:['选择目标文件夹，将"',t.title,'"移动到该位置']})]}),s.jsxs("div",{className:"border rounded-xl overflow-hidden mb-6",style:{borderColor:"var(--border)",maxHeight:"400px",overflowY:"auto"},children:[s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors border-b "+(null===i?"bg-primary text-primary-content":"hover:bg-muted"),style:{borderColor:"var(--border)"},onClick:()=>l(null),children:[s.jsx(ve,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"flex-1 text-sm font-medium",children:"根目录"})]}),s.jsx("div",{className:"py-1",children:g.length>0?f(g):s.jsx("div",{className:"px-3 py-8 text-center text-sm text-muted-foreground",children:"没有可用的文件夹"})})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:p,className:"btn btn-outline flex-1",children:"取消"}),s.jsx("button",{onClick:()=>{n(i)},className:"btn flex-1",disabled:i===t.parent_id,children:"确定移动"})]})]})]})}function la({group:e,level:t,isLast:r,parentLines:n,selectedGroupId:a,onSelectGroup:i,expandedGroups:l,toggleGroup:o,editingGroupId:c,setEditingGroupId:d,editingTitle:u,setEditingTitle:x,onRenameGroup:h,onRefresh:p,activeId:f,overId:g,dropPosition:b,onOpenMoveDialog:v}){var j,y;const w=a===e.id,N=l.has(e.id),k=((null==(j=e.children)?void 0:j.length)||0)>0,C=1===e.is_folder,S=c===e.id,M=f===e.id,T=g===e.id&&!M,E=(null==(y=e.tags)?void 0:y.includes("__locked__"))||!1,{attributes:_,listeners:L,setNodeRef:D,isDragging:R}=sa({id:e.id,data:{type:C?"folder":"group",parentId:e.parent_id},disabled:E}),I={opacity:R?.4:1,cursor:E?"not-allowed":R?"grabbing":"grab",transition:"opacity 0.2s ease"},z=m.useRef(null),O=m.useRef(0),A=()=>{h&&!E&&(d(e.id),x(e.title))},$=async()=>{const t=u.trim();if(!t)return void alert("标题不能为空");if(t.length>100)return void alert("标题长度不能超过 100 个字符");if(/[<>:"/\\|?*]/g.test(t))alert('标题不能包含特殊字符: < > : " / \\ | ? *');else if(t!==e.title){if(h)try{await h(e.id,t),d(null)}catch(s){alert("重命名失败，请重试")}}else d(null)},B=function({onRefresh:e,onStartRename:t,onOpenMoveDialog:s}){const r=(e,t)=>{if(!e.items||0===e.items.length)return void alert("没有可打开的标签页");const s="new"===t?"新窗口":"current"===t?"当前窗口":"隐身窗口";if(!(e.items.length>5)||confirm(`确定要在${s}中打开 ${e.items.length} 个标签页吗？`)){if("current"===t&&e.items&&e.items.length>0){const t=e.items[0];return void(t&&(window.location.href=t.url))}try{const t=`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>正在打开标签页...</title>\n  <style>\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      min-height: 100vh;\n      margin: 0;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n    }\n    .container {\n      text-align: center;\n      padding: 2rem;\n      background: rgba(255, 255, 255, 0.1);\n      backdrop-filter: blur(10px);\n      border-radius: 1rem;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n      max-width: 600px;\n    }\n    h1 { margin: 0 0 1rem 0; font-size: 2rem; }\n    .progress {\n      margin: 2rem 0;\n      font-size: 1.5rem;\n      font-weight: bold;\n    }\n    .status {\n      margin: 1rem 0;\n      padding: 1rem;\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 0.5rem;\n      font-size: 0.9rem;\n    }\n    .links {\n      margin-top: 2rem;\n      text-align: left;\n      max-height: 300px;\n      overflow-y: auto;\n      padding: 1rem;\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 0.5rem;\n    }\n    .link-item {\n      padding: 0.5rem;\n      margin: 0.25rem 0;\n      background: rgba(255, 255, 255, 0.1);\n      border-radius: 0.25rem;\n      font-size: 0.85rem;\n      word-break: break-all;\n    }\n    .link-item.opened {\n      background: rgba(76, 175, 80, 0.3);\n    }\n    .link-item.failed {\n      background: rgba(244, 67, 54, 0.3);\n    }\n    button {\n      margin-top: 1rem;\n      padding: 0.75rem 2rem;\n      font-size: 1rem;\n      background: white;\n      color: #667eea;\n      border: none;\n      border-radius: 0.5rem;\n      cursor: pointer;\n      font-weight: bold;\n      transition: transform 0.2s;\n    }\n    button:hover {\n      transform: scale(1.05);\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <h1>🚀 正在打开标签页</h1>\n    <div class="progress">\n      <span id="current">0</span> / <span id="total">${e.items.length}</span>\n    </div>\n    <div class="status" id="status">准备打开...</div>\n    <div class="links" id="links"></div>\n    <button onclick="window.close()" style="display:none" id="closeBtn">关闭此窗口</button>\n  </div>\n  <script>\n    const urls = ${JSON.stringify(e.items.map(e=>({url:e.url,title:e.title})))};\n    let opened = 0;\n    let failed = 0;\n    \n    const linksContainer = document.getElementById('links');\n    const statusEl = document.getElementById('status');\n    const currentEl = document.getElementById('current');\n    const closeBtnEl = document.getElementById('closeBtn');\n    \n    urls.forEach((item, index) => {\n      const div = document.createElement('div');\n      div.className = 'link-item';\n      div.id = 'link-' + index;\n      div.textContent = (index + 1) + '. ' + item.title;\n      linksContainer.appendChild(div);\n    });\n    \n    async function openTabs() {\n      for (let i = 0; i < urls.length; i++) {\n        const item = urls[i];\n        const linkEl = document.getElementById('link-' + i);\n        \n        try {\n          statusEl.textContent = '正在打开: ' + item.title;\n          const newWindow = window.open(item.url, '_blank', 'noopener,noreferrer');\n          \n          if (newWindow) {\n            opened++;\n            linkEl.className = 'link-item opened';\n          } else {\n            failed++;\n            linkEl.className = 'link-item failed';\n          }\n        } catch (error) {\n          console.error('Failed to open:', item.url, error);\n          failed++;\n          linkEl.className = 'link-item failed';\n        }\n        \n        currentEl.textContent = (i + 1);\n        \n        if (i < urls.length - 1) {\n          await new Promise(resolve => setTimeout(resolve, 100));\n        }\n      }\n      \n      if (failed > 0) {\n        statusEl.textContent = '✅ 成功打开 ' + opened + ' 个，❌ 失败 ' + failed + ' 个';\n        statusEl.style.background = 'rgba(255, 152, 0, 0.3)';\n      } else {\n        statusEl.textContent = '✅ 全部打开成功！共 ' + opened + ' 个标签页';\n        statusEl.style.background = 'rgba(76, 175, 80, 0.3)';\n      }\n      \n      closeBtnEl.style.display = 'block';\n    }\n    \n    setTimeout(openTabs, 500);\n  <\/script>\n</body>\n</html>`,r=new Blob([t],{type:"text/html"}),n=URL.createObjectURL(r);window.open(n,"_blank","width=800,height=600")?(alert(`已在${s}中打开标签页管理器`),setTimeout(()=>URL.revokeObjectURL(n),5e3)):alert("无法打开新窗口，请检查浏览器弹窗设置")}catch(r){alert("打开标签页失败，请重试")}}};return{onOpenInNewWindow:e=>{r(e,"new")},onOpenInCurrentWindow:e=>{r(e,"current")},onOpenInIncognito:e=>{r(e,"incognito")},onRename:e=>{t(e.id,e.title)},onShare:async e=>{try{const t=(await Yt.createShare(e.id,{is_public:!0,expires_in_days:30})).share_url;try{await navigator.clipboard.writeText(t),alert(`分享链接已创建并复制到剪贴板：\n\n${t}\n\n有效期：30天`)}catch{alert(`分享链接已创建：\n\n${t}\n\n有效期：30天\n\n（复制到剪贴板失败，请手动复制）`)}}catch(t){alert("创建分享链接失败")}},onCopyToClipboard:async e=>{if(!e.items||0===e.items.length)return void alert("此分组没有标签页");const t=e.items.map(e=>`${e.title}\n${e.url}`).join("\n\n");try{await navigator.clipboard.writeText(t),alert("已复制到剪贴板")}catch(s){alert("复制失败")}},onImportLinks:async t=>{const s=prompt("请粘贴要导入的链接（每行一个）：\n\n提示：可以粘贴多行链接，每行一个URL");if(!s)return;const r=s.split("\n").map(e=>e.trim()).filter(e=>e&&(e.startsWith("http://")||e.startsWith("https://")));if(0!==r.length)try{const s=r.map(e=>{try{const t=new URL(e);return{title:t.hostname,url:e,favicon:`${t.origin}/favicon.ico`}}catch{return{title:e,url:e}}});await Yt.addItemsToGroup(t.id,s),alert(`成功导入 ${r.length} 个链接`),await(null==e?void 0:e())}catch(n){alert("导入失败")}else alert("没有找到有效的链接")},onCreateFolderAbove:async t=>{try{await Yt.createFolder("新文件夹",t.parent_id),await(null==e?void 0:e())}catch(s){alert("创建文件夹失败")}},onCreateFolderInside:async t=>{if(1===t.is_folder)try{await Yt.createFolder("新文件夹",t.id),await(null==e?void 0:e())}catch(s){alert("创建文件夹失败")}},onCreateFolderBelow:async t=>{try{await Yt.createFolder("新文件夹",t.parent_id),await(null==e?void 0:e())}catch(s){alert("创建文件夹失败")}},onCreateGroupAbove:async t=>{try{await Yt.createTabGroup({title:"新分组",parent_id:t.parent_id,is_folder:!1}),await(null==e?void 0:e())}catch(s){alert("创建分组失败")}},onCreateGroupInside:async t=>{if(1===t.is_folder)try{await Yt.createTabGroup({title:"新分组",parent_id:t.id,is_folder:!1}),await(null==e?void 0:e())}catch(s){alert("创建分组失败")}},onCreateGroupBelow:async t=>{try{await Yt.createTabGroup({title:"新分组",parent_id:t.parent_id,is_folder:!1}),await(null==e?void 0:e())}catch(s){alert("创建分组失败")}},onPinToTop:async t=>{try{await Yt.updateTabGroup(t.id,{position:-1}),await(null==e?void 0:e())}catch(s){alert("固定失败")}},onRemoveDuplicates:async t=>{if(!t.items||0===t.items.length)return;const s=new Set,r=[];if(t.items.forEach(e=>{s.has(e.url)?r.push(e.id):s.add(e.url)}),0!==r.length){if(confirm(`找到 ${r.length} 个重复项，是否删除？`))try{await Promise.all(r.map(e=>Yt.deleteTabGroupItem(e))),await(null==e?void 0:e()),alert(`已删除 ${r.length} 个重复项`)}catch(n){alert("删除失败")}}else alert("没有找到重复项")},onLock:async t=>{try{const s=t.tags||[];let r;r=s.includes("__locked__")?s.filter(e=>"__locked__"!==e):[...s,"__locked__"],await Yt.updateTabGroup(t.id,{tags:r}),await(null==e?void 0:e())}catch(s){alert("操作失败")}},onMove:async e=>{s?s(e):alert("移动功能开发中（请使用拖拽）")},onMoveToTrash:async t=>{if(confirm(`确定要删除"${t.title}"吗？`))try{await Yt.deleteTabGroup(t.id),await(null==e?void 0:e())}catch(s){alert("删除失败")}}}}({onRefresh:p||(async()=>{}),onStartRename:(e,t)=>{d(e),x(t)},onOpenMoveDialog:v}),P=[{label:"在新窗口中打开",icon:s.jsx(oe,{className:"w-4 h-4"}),onClick:()=>B.onOpenInNewWindow(e),disabled:C},{label:"在此窗口中打开",icon:s.jsx(oe,{className:"w-4 h-4"}),onClick:()=>B.onOpenInCurrentWindow(e),disabled:C},{label:"重命名",icon:s.jsx(Te,{className:"w-4 h-4"}),onClick:()=>B.onRename(e),disabled:E,divider:!0},{label:"共享为网页",icon:s.jsx(Re,{className:"w-4 h-4"}),onClick:()=>B.onShare(e),disabled:C},{label:"复制到剪贴板",icon:s.jsx(ne,{className:"w-4 h-4"}),onClick:()=>B.onCopyToClipboard(e)},{label:"在上方创建文件夹",icon:s.jsx(pe,{className:"w-4 h-4"}),onClick:()=>B.onCreateFolderAbove(e),divider:!0},{label:"在内部创建文件夹",icon:s.jsx(pe,{className:"w-4 h-4"}),onClick:()=>B.onCreateFolderInside(e),disabled:!C},{label:"在下方创建文件夹",icon:s.jsx(pe,{className:"w-4 h-4"}),onClick:()=>B.onCreateFolderBelow(e)},{label:"在上方创建分组",icon:s.jsx(ue,{className:"w-4 h-4"}),onClick:()=>B.onCreateGroupAbove(e)},{label:"在内部创建分组",icon:s.jsx(ue,{className:"w-4 h-4"}),onClick:()=>B.onCreateGroupInside(e),disabled:!C},{label:"在下方创建分组",icon:s.jsx(ue,{className:"w-4 h-4"}),onClick:()=>B.onCreateGroupBelow(e)},{label:"移除重复项",icon:s.jsx(ne,{className:"w-4 h-4"}),onClick:()=>B.onRemoveDuplicates(e),disabled:C,divider:!0},{label:"移动",icon:s.jsx(Me,{className:"w-4 h-4"}),onClick:()=>B.onMove(e),disabled:E},{label:"固定到顶部",icon:s.jsx(Ee,{className:"w-4 h-4"}),onClick:()=>B.onPinToTop(e)},{label:E?"解锁":"锁定",icon:s.jsx(Se,{className:"w-4 h-4"}),onClick:()=>B.onLock(e)},{label:"移至回收站",icon:s.jsx(Oe,{className:"w-4 h-4"}),onClick:()=>B.onMoveToTrash(e),disabled:E,danger:!0,divider:!0}];return s.jsxs("div",{ref:D,style:I,className:"relative",children:[T&&"before"===b&&s.jsx("div",{className:"absolute left-0 right-0 pointer-events-none bg-primary rounded-sm animate-pulse",style:{top:"-2px",height:"3px",zIndex:999,boxShadow:"0 0 8px hsl(var(--primary) / 0.5)"}}),T&&"inside"===b&&C&&s.jsx("div",{className:"absolute inset-0 pointer-events-none border-2 border-primary bg-primary/15 rounded-md animate-pulse",style:{zIndex:999,boxShadow:"0 0 12px hsl(var(--primary) / 0.3)"}}),T&&"after"===b&&s.jsx("div",{className:"absolute left-0 right-0 pointer-events-none bg-primary rounded-sm animate-pulse",style:{bottom:"-2px",height:"3px",zIndex:999,boxShadow:"0 0 8px hsl(var(--primary) / 0.5)"}}),s.jsxs("div",{className:`group flex items-center gap-1 px-3 py-1.5 hover:bg-muted relative ${w?"bg-primary/10":""} ${M?"opacity-50":""}`,style:{paddingLeft:12+20*t+"px"},children:[t>0&&s.jsx("div",{className:"absolute left-0 top-0 h-full pointer-events-none",style:{width:12+20*t+"px"},children:Array.from({length:t}).map((e,a)=>{const i=a===t-1,l=a<t-1?n[a]:!r,o=12+20*a;return s.jsxs("div",{className:"absolute",style:{left:`${o}px`,top:0,height:"100%"},children:[l&&s.jsx("div",{className:"absolute left-0 top-0 w-px h-full bg-border/50"}),i&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute left-0 top-0 w-px h-1/2 bg-border/50"}),s.jsx("div",{className:"absolute left-0 top-1/2 w-2 h-px bg-border/50"})]})]},a)})}),s.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.jsx("button",{onClick:t=>{t.stopPropagation(),o(e.id,t)},className:"w-4 h-4 flex items-center justify-center hover:bg-muted rounded flex-shrink-0",children:k?N?s.jsx(V,{className:"w-3 h-3 text-muted-foreground"}):s.jsx(X,{className:"w-3 h-3 text-muted-foreground"}):s.jsx("div",{className:"w-3 h-3"})}),s.jsxs("div",{..._,...E?{}:L,className:"flex items-center gap-2 flex-1 "+(E?"cursor-not-allowed":"cursor-grab active:cursor-grabbing"),children:[C?N?s.jsx(he,{className:"w-4 h-4 text-primary flex-shrink-0"}):s.jsx(fe,{className:"w-4 h-4 text-primary flex-shrink-0"}):s.jsx(te,{className:"w-2 h-2 flex-shrink-0 text-primary "+(w?"fill-current":"")}),S?s.jsx("input",{type:"text",value:u,onChange:e=>x(e.target.value),onBlur:$,onKeyDown:t=>{"Enter"===t.key?(t.preventDefault(),$()):"Escape"===t.key&&(d(null),x(e.title))},className:"text-sm flex-1 px-1 py-0.5 border border-primary rounded bg-card text-foreground focus:outline-none",autoFocus:!0,onClick:e=>e.stopPropagation()}):s.jsx("span",{onClick:t=>{t.stopPropagation(),i(e.id),O.current++,1===O.current?z.current=setTimeout(()=>{O.current=0},300):2===O.current&&(z.current&&clearTimeout(z.current),O.current=0,A())},className:"text-sm flex-1 truncate cursor-pointer "+(w?"text-primary font-medium":"text-foreground"),children:e.title})]}),E&&s.jsx(Se,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}),!C&&s.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:e.item_count||0}),s.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:s.jsx(aa,{trigger:s.jsx("button",{className:"p-1 hover:bg-muted rounded transition-colors",children:s.jsxs("svg",{className:"w-4 h-4 text-muted-foreground",fill:"currentColor",viewBox:"0 0 16 16",children:[s.jsx("circle",{cx:"8",cy:"3",r:"1.5"}),s.jsx("circle",{cx:"8",cy:"8",r:"1.5"}),s.jsx("circle",{cx:"8",cy:"13",r:"1.5"})]})}),items:P,align:"right"})})]})]}),N&&k&&s.jsx("div",{children:e.children.map((m,j)=>s.jsx(la,{group:m,level:t+1,isLast:j===e.children.length-1,parentLines:[...n,!r],selectedGroupId:a,onSelectGroup:i,expandedGroups:l,toggleGroup:o,editingGroupId:c,setEditingGroupId:d,editingTitle:u,setEditingTitle:x,onRenameGroup:h,onRefresh:p,activeId:f,overId:g,dropPosition:b,onOpenMoveDialog:v},m.id))})]})}function oa({tabGroups:e,selectedGroupId:t,onSelectGroup:r,onCreateFolder:n,onRenameGroup:a,onMoveGroup:i,onRefresh:l}){const[o,c]=m.useState(new Set),[d,u]=m.useState(null),[x,h]=m.useState(""),[p,f]=m.useState(null),[g,b]=m.useState(null),[v,j]=m.useState(null),[y,w]=m.useState(!1),[N,k]=m.useState(null),C=m.useRef(null),S=m.useRef(null),M=Fs(Ws(Br,{activationConstraint:{distance:8}}),Ws(Ir)),T=e.reduce((e,t)=>1===t.is_folder?e:e+(t.item_count||0),0),E=(e,t)=>{t.stopPropagation(),c(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},_=function(e){const t=new Map,s=[];e.forEach(e=>{t.set(e.id,{...e,children:[]})}),e.forEach(e=>{const r=t.get(e.id);if(e.parent_id){const n=t.get(e.parent_id);n?(n.children=n.children||[],n.children.push(r)):s.push(r)}else s.push(r)});const r=e=>{e.sort((e,t)=>(e.position||0)-(t.position||0)),e.forEach(e=>{e.children&&e.children.length>0&&r(e.children)})};return r(s),s}(e),L=e.map(e=>e.id);return s.jsxs(s.Fragment,{children:[s.jsxs(Cn,{sensors:M,collisionDetection:e=>{const t=(e=>{let{droppableContainers:t,droppableRects:s,pointerCoordinates:r}=e;if(!r)return[];const n=[];for(const a of t){const{id:e}=a,t=s.get(e);if(t&&Zs(r,t)){const s=Vs(t).reduce((e,t)=>e+Ks(r,t),0),i=Number((s/4).toFixed(4));n.push({id:e,data:{droppableContainer:a,value:i}})}}return n.sort(qs)})(e);return t&&t.length>0?t:Ys(e)},onDragStart:t=>{const s=t.active.id,r=e.find(e=>e.id===s);He("🚀🚀🚀 Drag Start:",{id:s,title:null==r?void 0:r.title,isFolder:null==r?void 0:r.is_folder}),t.activatorEvent instanceof PointerEvent?(C.current=t.activatorEvent.clientY,S.current=t.activatorEvent.clientX):(C.current=null,S.current=null),f(s)},onDragOver:t=>{var s;const r=null==(s=t.over)?void 0:s.id;if(b(r),!r||!t.over)return void j(null);const n=e.find(e=>e.id===r);if(!n)return void j(null);const a=t.over.rect,i=t.active.rect.current,l=i.initial;if(!a||!l||0===a.height)return void j(null);const o=i.translated;let c,d;c=null!==C.current?C.current+t.delta.y:o?o.top+o.height/2:l.top+t.delta.y+l.height/2,d=null!==S.current?S.current+t.delta.x:o?o.left+o.width/2:l.left+t.delta.x+l.width/2;const u=(c-a.top)/a.height,m=(d-a.left)/a.width,x=Math.min(Math.max(u,0),1),h=Math.min(Math.max(m,0),1);if(He("🎯 DragOver:",{overId:r,overTitle:n.title,isFolder:n.is_folder,relativeY:x.toFixed(2),relativeX:h.toFixed(2),pointerY:c.toFixed(2),pointerX:d.toFixed(2),overTop:a.top,overHeight:a.height,overWidth:a.width}),1===n.is_folder){j(x>=.15&&x<=.85||h>=.45?"inside":x<.15?"before":"after")}else j(x<.5?"before":"after")},onDragEnd:async t=>{const{active:s,over:r}=t,n=v;if(f(null),b(null),j(null),C.current=null,S.current=null,!r||s.id===r.id||!i)return;const a=e.find(e=>e.id===s.id),l=e.find(e=>e.id===r.id);if(a&&l)if(He("🎯 DragEnd:",{draggedId:a.id,draggedTitle:a.title,targetId:l.id,targetTitle:l.title,dropPosition:n}),"inside"===n&&1===l.is_folder){if(1===a.is_folder){const t=(s,r)=>{const n=e.find(e=>e.id===r);return!(!n||!n.parent_id)&&(n.parent_id===s||t(s,n.parent_id))};if(t(a.id,l.id))return}const t=e.filter(e=>e.parent_id===l.id),s=(t.length>0?Math.max(...t.map(e=>e.position||0)):-1)+1;await i(a.id,l.id,s)}else if("before"===n||"after"===n){const t=l.parent_id||null;let s;e.filter(e=>(e.parent_id||null)===t&&e.id!==a.id).sort((e,t)=>(e.position||0)-(t.position||0)),s="before"===n?l.position||0:(l.position||0)+1,await i(a.id,t,s)}else{const t=l.parent_id||null,s=e.filter(e=>(e.parent_id||null)===t),r=(s.length>0?Math.max(...s.map(e=>e.position||0)):-1)+1;await i(a.id,t,r)}},onDragCancel:()=>{C.current=null,S.current=null,f(null),b(null),j(null)},children:[s.jsxs("div",{className:"w-full h-full bg-card border-r border-border flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"px-3 py-2 border-b border-border flex items-center justify-between",children:[s.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"标签页组"}),n&&s.jsx("button",{onClick:n,className:"w-6 h-6 flex items-center justify-center hover:bg-muted rounded transition-colors",title:"创建文件夹",children:s.jsx(pe,{className:"w-4 h-4 text-muted-foreground"})})]}),s.jsx(Xn,{items:L,strategy:qn,children:s.jsx("div",{className:"flex-1 overflow-y-auto",children:s.jsxs("div",{className:"relative",children:[s.jsxs("div",{onClick:()=>r(null),className:"group flex items-center gap-2 px-3 py-1.5 cursor-pointer hover:bg-muted "+(null===t?"bg-primary/10":""),children:[s.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:s.jsx(te,{className:"w-2 h-2 "+(null===t?"fill-primary text-primary":"text-muted-foreground")})}),s.jsx("span",{className:"text-sm flex-1 "+(null===t?"text-primary font-medium":"text-foreground"),children:"全部"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:T})]}),0===_.length?s.jsx("div",{className:"px-3 py-8 text-center",children:s.jsx("p",{className:"text-xs text-muted-foreground/50",children:"暂无分组"})}):s.jsxs("div",{className:"relative",children:[_.length>0&&s.jsx("div",{className:"absolute pointer-events-none left-3 top-0 bottom-0 w-px bg-border/50"}),_.map((e,n)=>s.jsx(la,{group:e,level:1,isLast:n===_.length-1,parentLines:[!0],selectedGroupId:t,onSelectGroup:r,expandedGroups:o,toggleGroup:E,editingGroupId:d,setEditingGroupId:u,editingTitle:x,setEditingTitle:h,onRenameGroup:a,onRefresh:l,activeId:p,overId:g,dropPosition:v,onOpenMoveDialog:e=>{k(e),w(!0)}},e.id))]})]})})})]}),s.jsx(Pn,{children:p?s.jsx("div",{className:"opacity-80 bg-card border-2 border-primary rounded shadow-lg cursor-grabbing",style:{padding:"6px 12px"},children:(()=>{const t=e.find(e=>e.id===p);if(!t)return null;const r=1===t.is_folder;return s.jsxs("div",{className:"flex items-center gap-2",children:[r?s.jsx(fe,{className:"w-4 h-4 text-primary"}):s.jsx(te,{className:"w-2 h-2 text-primary fill-current"}),s.jsx("span",{className:"text-sm text-foreground",children:t.title})]})})()}):null})]}),N&&s.jsx(ia,{isOpen:y,currentGroup:N,allGroups:e,onConfirm:async t=>{if(!i)return;const s=e.filter(e=>(e.parent_id||null)===t),r=(s.length>0?Math.max(...s.map(e=>e.position||0)):-1)+1;await i(N.id,t,r),w(!1),k(null)},onCancel:()=>{w(!1),k(null)}})]})}Tr.Down,Tr.Right,Tr.Up,Tr.Left;const ca=k(e=>({toasts:[],addToast:(t,s,r=3e3)=>{const n=`toast-${Date.now()}-${Math.random()}`;e(a=>({toasts:[...a.toasts,{id:n,type:t,message:s,duration:r,onClose:t=>{e(e=>({toasts:e.toasts.filter(e=>e.id!==t)}))}}]}))},removeToast:t=>{e(e=>({toasts:e.toasts.filter(e=>e.id!==t)}))},success:(e,t)=>{ca.getState().addToast("success",e,t)},error:(e,t)=>{ca.getState().addToast("error",e,t)},info:(e,t)=>{ca.getState().addToast("info",e,t)},warning:(e,t)=>{ca.getState().addToast("warning",e,t)}}));function da({tabGroups:e,onUpdate:t}){const[r,n]=m.useState(null),[a,i]=m.useState(null),[l,o]=m.useState(""),{success:c,error:d}=ca(),u=[];e.forEach(e=>{var t;null==(t=e.items)||t.forEach(t=>{t.is_todo&&u.push({item:t,groupId:e.id,groupTitle:e.title})})});const x=u.sort((e,t)=>new Date(t.item.created_at||0).getTime()-new Date(e.item.created_at||0).getTime()),h=async(e,s)=>{n(e);try{await Yt.updateTabGroupItem(e,{is_todo:s?0:1}),c(s?"已取消待办":"已标记为待办"),t()}catch(r){d("操作失败，请重试")}finally{n(null)}},p=async e=>{if(l.trim()){n(e);try{await Yt.updateTabGroupItem(e,{title:l.trim()}),c("重命名成功"),i(null),o(""),t()}catch(s){d("重命名失败，请重试")}finally{n(null)}}else d("标题不能为空")};return s.jsxs("div",{className:"w-full h-full bg-card border-l border-border overflow-y-auto flex flex-col",children:[s.jsxs("div",{className:"p-4 border-b border-border bg-muted sticky top-0 z-10 shadow-md",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ne,{className:"w-5 h-5 text-foreground"}),s.jsx("h2",{className:"text-lg font-bold text-foreground",children:"待办事项"})]}),s.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(te,{className:"w-3 h-3 text-muted-foreground"}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:[x.length," 个待办"]})]}),x.length>0&&s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(Z,{className:"w-3 h-3 text-muted-foreground"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:"待完成"})]})]})]}),s.jsx("div",{className:"p-4 space-y-3",children:0===x.length?s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(Ne,{className:"w-10 h-10 text-muted-foreground"})}),s.jsx("p",{className:"text-muted-foreground text-sm font-medium",children:"暂无待办事项"}),s.jsx("p",{className:"text-muted-foreground/70 text-xs mt-2",children:'在标签页上点击"待办"按钮添加'})]}):x.map(({item:u,groupId:m,groupTitle:x})=>{const f=u.created_at?_(new Date(u.created_at),{addSuffix:!0,locale:as}):"";return s.jsx("div",{className:"group bg-card rounded-lg p-4 border border-border hover:shadow-md hover:border-primary/30 transition-all duration-200",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("button",{onClick:()=>h(u.id,u.is_todo||0),disabled:r===u.id,className:`flex-shrink-0 w-6 h-6 rounded border-2 flex items-center justify-center transition-all duration-200 ${r===u.id?"opacity-50 cursor-not-allowed":"hover:scale-110 hover:border-primary"} ${u.is_todo?"border-primary bg-primary/10":"border-border hover:bg-muted"}`,children:u.is_todo&&s.jsx(H,{className:"w-4 h-4 text-primary"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[a===u.id?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:l,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key?p(u.id):"Escape"===e.key&&(i(null),o(""))},className:"input flex-1 text-sm",autoFocus:!0}),s.jsx("button",{onClick:()=>p(u.id),className:"text-success hover:text-success/80",children:s.jsx(H,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>{i(null),o("")},className:"text-muted-foreground hover:text-foreground",children:s.jsx(Oe,{className:"w-4 h-4"})})]}):s.jsx("h3",{className:"text-sm font-semibold text-foreground truncate group-hover:text-primary transition-colors",children:u.title}),s.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full font-medium",children:[s.jsx(te,{className:"w-2 h-2 fill-current"}),x]}),f&&s.jsx("span",{className:"text-xs text-muted-foreground/70",children:f})]}),u.url&&s.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[s.jsx(oe,{className:"w-3 h-3 text-muted-foreground/70"}),s.jsx("p",{className:"text-xs text-muted-foreground truncate",children:new URL(u.url).hostname})]})]}),s.jsx(aa,{trigger:s.jsx("button",{className:"flex-shrink-0 p-1 text-muted-foreground hover:text-foreground hover:bg-muted rounded transition-colors",children:s.jsx(le,{className:"w-4 h-4"})}),items:[{label:"在新窗口中打开",icon:s.jsx(oe,{className:"w-4 h-4"}),onClick:()=>{return e=u.url,void window.open(e,"_blank","noopener,noreferrer");var e}},{label:"在此窗口中打开",icon:s.jsx(oe,{className:"w-4 h-4"}),onClick:()=>{return e=u.url,void(window.location.href=e);var e}},{label:"在新的隐身窗口中打开",icon:s.jsx(oe,{className:"w-4 h-4"}),onClick:()=>{d("隐身模式打开需要浏览器扩展支持")}},{label:"重命名",icon:s.jsx(Te,{className:"w-4 h-4"}),onClick:()=>(e=>{i(e.id),o(e.title)})(u)},{label:u.is_todo?"取消任务标记":"标记为已完成任务",icon:s.jsx(Z,{className:"w-4 h-4"}),onClick:()=>h(u.id,u.is_todo||0)},{label:"移动到其他分组",icon:s.jsx(xe,{className:"w-4 h-4"}),onClick:()=>(async(s,r)=>{const a=e.filter(e=>e.id!==r&&!e.is_folder);if(0===a.length)return void d("没有可移动到的分组");const i=a[0];if(i){if(confirm(`确定要将此标签页移动到"${i.title}"吗？`)){n(s);try{await Yt.moveTabGroupItem(s,i.id),c(`已移动到"${i.title}"`),t()}catch(l){d("移动失败，请重试")}finally{n(null)}}}else d("没有可移动到的分组")})(u.id,m)},{label:"标记为已归档",icon:s.jsx(P,{className:"w-4 h-4"}),onClick:()=>(async e=>{if(confirm("确定要归档这个标签页吗？归档后可以在归档视图中查看。")){n(e);try{await Yt.updateTabGroupItem(e,{is_archived:1}),c("标签页已归档"),t()}catch(s){d("归档失败，请重试")}finally{n(null)}}})(u.id)},{label:"移至回收站",icon:s.jsx(Oe,{className:"w-4 h-4"}),onClick:()=>(async e=>{if(confirm("确定要删除这个标签页吗？")){n(e);try{await Yt.deleteTabGroupItem(e),c("标签页已删除"),t()}catch(s){d("删除失败，请重试")}finally{n(null)}}})(u.id),danger:!0}]})]})},u.id)})})]})}function ua({children:e,side:t,defaultWidth:r,minWidth:n,maxWidth:a,storageKey:i}){const[l,o]=m.useState(()=>{const e=localStorage.getItem(i);return e?parseInt(e,10):r}),[c,d]=m.useState(!1),u=m.useRef(null);m.useEffect(()=>{localStorage.setItem(i,l.toString())},[l,i]);m.useEffect(()=>{const e=e=>{if(!c||!u.current)return;const s=u.current.getBoundingClientRect();let r;r="left"===t?e.clientX-s.left:s.right-e.clientX,r=Math.max(n,Math.min(a,r)),o(r)},s=()=>{d(!1)};return c&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}},[c,t,n,a]);return s.jsxs("div",{ref:u,className:"relative flex-shrink-0 bg-card",style:{width:`${l}px`},children:[e,s.jsx("div",{className:`absolute top-0 ${"left"===t?"right-0":"left-0"} h-full w-1 cursor-col-resize group hover:bg-primary transition-colors ${c?"bg-primary":"bg-transparent"}`,onMouseDown:e=>{e.preventDefault(),d(!0)},children:s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 left-1/2 bg-card border border-border rounded p-1 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm",children:s.jsx(be,{className:"w-3 h-3 text-muted-foreground"})})}),s.jsx("button",{onClick:()=>{o(r)},className:"absolute bottom-4 left-1/2 -translate-x-1/2 p-2 bg-card border border-border rounded shadow-sm hover:bg-muted hover:shadow-md transition-all opacity-0 hover:opacity-100 group-hover:opacity-100",title:"恢复默认宽度",children:s.jsx(Le,{className:"w-4 h-4 text-muted-foreground"})})]})}function ma(e,t){if(!t)return!0;const s=t.toLowerCase();for(const r of e)if(r&&r.toLowerCase().includes(s))return!0;return!1}function xa({isOpen:e,itemTitle:t,currentGroupId:r,availableGroups:n,onMove:a,onClose:i}){const[l,o]=m.useState("");if(!e)return null;const c=n.filter(e=>e.id!==r&&1!==e.is_folder);return s.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center bg-background/80 backdrop-blur-sm",children:s.jsxs("div",{className:"border border-border rounded-lg shadow-xl w-full max-w-md mx-4",style:{backgroundColor:"var(--card)"},children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[s.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"移动标签页"}),s.jsx("button",{onClick:i,className:"p-1 text-muted-foreground hover:text-foreground rounded transition-colors",children:s.jsx(We,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsx("div",{children:s.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["将 ",s.jsxs("span",{className:"font-medium text-foreground",children:['"',t,'"']})," 移动到："]})}),s.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:0===c.length?s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(he,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),s.jsx("p",{children:"没有可用的目标组"})]}):c.map(e=>s.jsx("button",{onClick:()=>o(e.id),className:"w-full text-left p-3 rounded-lg border-2 transition-all "+(l===e.id?"border-primary shadow-md":"border-border hover:bg-muted hover:border-muted-foreground/20"),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-foreground truncate",children:e.title}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.item_count||0," 个标签页"]})]}),l===e.id&&s.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0 ml-2",style:{backgroundColor:"var(--primary)"},children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:3.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7",style:{color:"var(--primary-foreground)"}})})})]})},e.id))})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t border-border",children:[s.jsx("button",{onClick:i,className:"px-4 py-2 text-sm text-muted-foreground hover:text-foreground rounded-lg hover:bg-muted transition-colors",children:"取消"}),s.jsx("button",{onClick:()=>{l&&(a(l),i())},disabled:!l,className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"移动"})]})]})})}function ha(){var e,t;const[r,n]=m.useState([]),[a,i]=m.useState(!0),[l,o]=m.useState(null),[c,d]=m.useState(null),[u,x]=m.useState(""),[h,p]=m.useState(""),[f,g]=m.useState(null),[b,v]=m.useState(new Set),[j,y]=m.useState(!1),[w,N]=m.useState("created"),[k,C]=m.useState(null),[S,M]=m.useState(null),T=m.useRef(null),[E,L]=m.useState({isOpen:!1,item:null,currentGroupId:""}),[D,R]=m.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),{editingItemId:I,setEditingItemId:z,editingTitle:O,setEditingTitle:A,editingGroupId:$,setEditingGroupId:B,editingGroupTitle:P,setEditingGroupTitle:W,handleDelete:F,handleOpenAll:G,handleExportMarkdown:K,handleEditGroup:U,handleSaveGroupEdit:q,handleEditItem:H,handleSaveEdit:V,handleTogglePin:X,handleToggleTodo:Y,handleDeleteItem:J}=function({setTabGroups:e,setDeletingId:t,setConfirmDialog:s,confirmDialog:r}){const{success:n,error:a}=ca(),[i,l]=m.useState(null),[o,c]=m.useState(""),[d,u]=m.useState(null),[x,h]=m.useState(""),p=e=>{try{return _(new Date(e),{addSuffix:!0,locale:as})}catch{return e}};return{editingItemId:i,setEditingItemId:l,editingTitle:o,setEditingTitle:c,editingGroupId:d,setEditingGroupId:u,editingGroupTitle:x,setEditingGroupTitle:h,formatDate:p,handleDelete:(i,l)=>{s({isOpen:!0,title:"删除标签页组",message:`确定要删除标签页组"${l}"吗？此操作将移至回收站。`,onConfirm:async()=>{s({...r,isOpen:!1}),t(i);try{await Yt.deleteTabGroup(i),e(e=>e.filter(e=>e.id!==i)),n("已移至回收站")}catch(l){a("删除失败，请重试")}finally{t(null)}}})},handleOpenAll:e=>{if(!e||0===e.length)return void a("没有可打开的标签页");const t=e.length,s=t>10?`即将打开 ${t} 个标签页。\n\n⚠️ 如果浏览器拦截弹窗，请在地址栏点击"允许弹窗"。\n\n是否继续？`:`确定要打开 ${t} 个标签页吗？`;window.confirm(s)&&(e.forEach((e,t)=>{setTimeout(()=>{window.open(e.url,"_blank","noopener,noreferrer")},20*t)}),n(`正在打开 ${t} 个标签页...`))},handleExportMarkdown:e=>{const t=e.items||[];let s=`# ${e.title}\n\n`;s+=`创建时间: ${p(e.created_at)}\n`,s+=`标签页数量: ${t.length}\n\n`,e.tags&&e.tags.length>0&&(s+=`标签: ${e.tags.join(", ")}\n\n`),s+="---\n\n",t.forEach((e,t)=>{s+=`${t+1}. [${e.title}](${e.url})\n`,1===e.is_pinned&&(s+="   - 📌 已固定\n"),1===e.is_todo&&(s+="   - ✅ 待办\n"),s+="\n"});const r=new Blob([s],{type:"text/markdown"}),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=`${e.title}-${Date.now()}.md`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),n("导出成功")},handleEditGroup:e=>{u(e.id),h(e.title)},handleSaveGroupEdit:async t=>{if(x.trim())try{await Yt.updateTabGroup(t,{title:x}),e(e=>e.map(e=>e.id===t?{...e,title:x}:e)),u(null),h(""),n("重命名成功")}catch(s){a("重命名失败，请重试")}else a("标题不能为空")},handleEditItem:e=>{l(e.id),c(e.title)},handleSaveEdit:async(t,s)=>{if(o.trim())try{await Yt.updateTabGroupItem(s,{title:o}),e(e=>e.map(e=>{var r;return e.id===t?{...e,items:null==(r=e.items)?void 0:r.map(e=>e.id===s?{...e,title:o}:e)}:e})),l(null),c(""),n("编辑成功")}catch(r){a("编辑失败，请重试")}else a("标题不能为空")},handleTogglePin:async(t,s,r)=>{const i=1===r?0:1;try{await Yt.updateTabGroupItem(s,{is_pinned:i}),e(e=>e.map(e=>{var r;return e.id===t?{...e,items:null==(r=e.items)?void 0:r.map(e=>e.id===s?{...e,is_pinned:i}:e)}:e})),n(1===i?"已固定":"已取消固定")}catch(l){a("操作失败，请重试")}},handleToggleTodo:async(t,s,r)=>{const i=1===r?0:1;try{await Yt.updateTabGroupItem(s,{is_todo:i}),e(e=>e.map(e=>{var r;return e.id===t?{...e,items:null==(r=e.items)?void 0:r.map(e=>e.id===s?{...e,is_todo:i}:e)}:e})),n(1===i?"已标记待办":"已取消待办")}catch(l){a("操作失败，请重试")}},handleDeleteItem:(t,i,l)=>{s({isOpen:!0,title:"删除标签页",message:`确定要删除"${l}"吗？此操作不可撤销。`,onConfirm:async()=>{s({...r,isOpen:!1});try{await Yt.deleteTabGroupItem(i),e(e=>e.map(e=>{var s;return e.id===t?{...e,items:null==(s=e.items)?void 0:s.filter(e=>e.id!==i),item_count:(e.item_count||0)-1}:e})),n("删除成功")}catch(l){a("删除失败，请重试")}}})}}}({setTabGroups:n,setDeletingId:d,setConfirmDialog:R,confirmDialog:D}),{handleBatchDelete:Q,handleBatchPin:Z,handleBatchTodo:ee,handleBatchExport:te,handleDeselectAll:se}=function({tabGroups:e,setTabGroups:t,selectedItems:s,setSelectedItems:r,setConfirmDialog:n,confirmDialog:a}){const{success:i,error:l}=ca();return{handleBatchDelete:()=>{0!==s.size&&n({isOpen:!0,title:"批量删除",message:`确定要删除选中的 ${s.size} 个标签页吗？`,onConfirm:async()=>{n({...a,isOpen:!1});try{await Promise.all(Array.from(s).map(e=>Yt.deleteTabGroupItem(e))),t(e=>e.map(e=>{var t;return{...e,items:null==(t=e.items)?void 0:t.filter(e=>!s.has(e.id)),item_count:(e.item_count||0)-Array.from(s).filter(t=>{var s;return null==(s=e.items)?void 0:s.some(e=>e.id===t)}).length}})),r(new Set),i("批量删除成功")}catch(e){l("批量删除失败，请重试")}}})},handleBatchPin:async()=>{if(0!==s.size)try{await Promise.all(Array.from(s).map(e=>Yt.updateTabGroupItem(e,{is_pinned:1}))),t(e=>e.map(e=>{var t;return{...e,items:null==(t=e.items)?void 0:t.map(e=>s.has(e.id)?{...e,is_pinned:1}:e)}})),r(new Set),i("批量固定成功")}catch(e){l("批量固定失败，请重试")}},handleBatchTodo:async()=>{if(0!==s.size)try{await Promise.all(Array.from(s).map(e=>Yt.updateTabGroupItem(e,{is_todo:1}))),t(e=>e.map(e=>{var t;return{...e,items:null==(t=e.items)?void 0:t.map(e=>s.has(e.id)?{...e,is_todo:1}:e)}})),r(new Set),i("批量标记待办成功")}catch(e){l("批量标记待办失败，请重试")}},handleBatchExport:()=>{if(0===s.size)return;const t=[];e.forEach(e=>{var r;null==(r=e.items)||r.forEach(e=>{s.has(e.id)&&t.push(e)})});let r="# 批量导出的标签页\n\n";r+=`导出时间: ${(new Date).toLocaleString("zh-CN")}\n`,r+=`标签页数量: ${t.length}\n\n`,r+="---\n\n",t.forEach((e,t)=>{r+=`${t+1}. [${e.title}](${e.url})\n`,1===e.is_pinned&&(r+="   - 📌 已固定\n"),1===e.is_todo&&(r+="   - ✅ 待办\n"),r+="\n"});const n=new Blob([r],{type:"text/markdown"}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.download=`batch-export-${Date.now()}.md`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a),i("导出成功")},handleDeselectAll:()=>{r(new Set)}}}({tabGroups:r,setTabGroups:n,selectedItems:b,setSelectedItems:v,setConfirmDialog:R,confirmDialog:D}),re=Fs(Ws(Br,{activationConstraint:{distance:8}}),Ws(Ir));m.useEffect(()=>{ne()},[]),m.useEffect(()=>{const e=setTimeout(()=>{p(u)},300);return()=>clearTimeout(e)},[u]),m.useEffect(()=>(T.current&&(clearTimeout(T.current),T.current=null),u.trim()&&(T.current=setTimeout(()=>{x(""),p("")},15e3)),()=>{T.current&&(clearTimeout(T.current),T.current=null)}),[u]);const ne=async()=>{try{i(!0),o(null);const e=await Yt.getAllTabGroups();n(e)}catch(e){o("加载标签页组失败")}finally{i(!1)}},ae=async()=>{try{const e=await Yt.getAllTabGroups();S&&e.find(e=>e.id===S);n(e)}catch(e){o("刷新失败")}},ie=(e,t)=>{if(j){t.preventDefault();const s=new Set(b);return s.has(e.id)?s.delete(e.id):s.add(e.id),void v(s)}const s=le(e.url);g(f===s?null:s)},le=e=>{try{return new URL(e).hostname}catch{return""}},oe=e=>{const t=r.find(t=>{var s;return null==(s=t.items)?void 0:s.some(t=>t.id===e.id)});t&&L({isOpen:!0,item:e,currentGroupId:t.id})},ce=m.useMemo(()=>{if(!r||0===r.length)return[];if(!S)return r;const e=r.find(e=>e.id===S);if(!e)return[];if(1===e.is_folder){return[e,...r.filter(e=>e.parent_id===S)]}return[e]},[S,r]),de=m.useMemo(()=>{if(!ce||0===ce.length)return[];if(!h.trim())return ce;const e=h,t=[];for(const s of ce){if(ma([s.title],e))t.push(s);else if(s.items&&s.items.length>0){const r=s.items.filter(t=>ma([t.title,t.url],e));r.length>0&&t.push({...s,items:r})}}return t},[ce,h]),ue=m.useMemo(()=>de&&0!==de.length?function(e,t){const s=[...e];switch(t){case"title":return s.sort((e,t)=>e.title.localeCompare(t.title,"zh-CN"));case"count":return s.sort((e,t)=>(t.item_count||0)-(e.item_count||0));default:return s.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())}}(de,w):[],[de,w]);return a?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-primary/30 border-t-primary rounded-full animate-spin"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"加载中..."})]})}):l?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-destructive mb-4",children:l}),s.jsx("button",{onClick:ne,className:"px-4 py-2 rounded-lg border border-border hover:bg-muted/50 transition-colors",style:{color:"var(--foreground)"},children:"重试"})]})}):s.jsxs("div",{className:"flex h-screen overflow-hidden bg-background",children:[s.jsx(ua,{side:"left",defaultWidth:240,minWidth:200,maxWidth:400,storageKey:"tab-groups-left-sidebar-width",children:s.jsx(oa,{tabGroups:r,selectedGroupId:S,onSelectGroup:M,onCreateFolder:async()=>{try{await Yt.createFolder("新文件夹"),await ae()}catch(e){o("创建文件夹失败")}},onRenameGroup:async(e,t)=>{try{await Yt.updateTabGroup(e,{title:t}),await ae()}catch(s){o("重命名失败")}},onMoveGroup:async(e,t,s)=>{try{He("📦 handleMoveGroup:",{groupId:e,newParentId:t,newPosition:s});const n=r.find(t=>t.id===e);if(!n)return void Ve("Dragged group not found");const a=r.filter(e=>(e.parent_id||null)===t);a.sort((e,t)=>(e.position||0)-(t.position||0));const i=a.findIndex(t=>t.id===e);-1!==i&&a.splice(i,1),a.splice(s,0,n);const l=a.map((e,s)=>({id:e.id,position:s,parent_id:t}));He("  → Reordering",l.length,"items"),await Promise.all(l.map(e=>Yt.updateTabGroup(e.id,{position:e.position,parent_id:e.parent_id}))),await ae()}catch(n){o("移动失败")}},onRefresh:ae})}),s.jsx("div",{className:"flex-1 overflow-y-auto bg-muted/30",children:s.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:[s.jsxs("div",{className:"mb-6",children:[r.length>0&&s.jsxs("div",{className:"flex items-center gap-4 w-full",children:[s.jsx("h1",{className:"text-xl font-semibold text-foreground whitespace-nowrap flex-shrink-0",children:"标签页组"}),s.jsx(Qt,{searchQuery:u,onSearchChange:x,sortBy:w,onSortChange:N,onBatchModeToggle:()=>y(!j),batchMode:j})]}),j&&b.size>0&&s.jsx("div",{className:"mt-4",children:s.jsx(Zt,{selectedCount:b.size,onSelectAll:()=>{const e=new Set;r.forEach(t=>{var s;null==(s=t.items)||s.forEach(t=>{e.add(t.id)})}),v(e)},onDeselectAll:se,onBatchDelete:Q,onBatchPin:Z,onBatchTodo:ee,onBatchExport:te,onCancel:()=>{y(!1),v(new Set)}})})]}),0===r.length&&s.jsx(es,{isSearching:!1,searchQuery:""}),r.length>0&&0===de.length&&s.jsx(es,{isSearching:!0,searchQuery:u}),ue.length>0&&s.jsx(Cn,{sensors:re,collisionDetection:Ys,onDragEnd:async e=>{var t,s;const{active:a,over:i}=e;if(!i||a.id===i.id)return;let l,o,c,d;for(const n of r){const e=null==(t=n.items)?void 0:t.find(e=>e.id===a.id);if(e){l=n,o=e;break}}for(const n of r){const e=null==(s=n.items)?void 0:s.find(e=>e.id===i.id);if(e){c=n,d=e;break}}if(l&&o&&c&&d)if(l.id===c.id){const e=l.items.findIndex(e=>e.id===a.id),t=l.items.findIndex(e=>e.id===i.id),s=Wn(l.items,e,t);n(e=>e.map(e=>e.id===l.id?{...e,items:s}:e));try{await Promise.all(s.map((e,t)=>Yt.updateTabGroupItem(e.id,{position:t})))}catch(u){n(e=>e.map(e=>e.id===l.id?{...e,items:l.items}:e))}}else{const e=c.items.findIndex(e=>e.id===i.id),t=l.items.filter(e=>e.id!==a.id),s=[...c.items];s.splice(e,0,o),n(e=>e.map(e=>e.id===l.id?{...e,items:t,item_count:t.length}:e.id===c.id?{...e,items:s,item_count:s.length}:e));try{await Yt.moveTabGroupItem(o.id,c.id,e),await Promise.all(t.map((e,t)=>Yt.updateTabGroupItem(e.id,{position:t}))),He("✅ Item moved across groups successfully")}catch(u){n(e=>e.map(e=>e.id===l.id?{...e,items:l.items,item_count:l.items.length}:e.id===c.id?{...e,items:c.items,item_count:c.items.length}:e))}}},children:s.jsx("div",{className:"grid grid-cols-1 gap-6",children:ue.map(e=>s.jsxs("div",{className:"card border-l-[3px] border-l-primary p-6 hover:shadow-xl transition-all duration-200",children:[s.jsx(is,{group:e,isEditingTitle:$===e.id,editingTitle:P,onEditTitle:()=>U(e),onSaveTitle:()=>q(e.id),onCancelEdit:()=>{B(null),W("")},onTitleChange:W,onOpenAll:()=>G(e.items||[]),onExport:()=>K(e),onDelete:()=>F(e.id,e.title),isDeleting:c===e.id,onShareClick:()=>C(e.id)}),e.items&&e.items.length>0&&s.jsx(na,{items:e.items,groupId:e.id,highlightedDomain:f,selectedItems:b,batchMode:j,editingItemId:I,editingTitle:O,onItemClick:ie,onEditItem:H,onSaveEdit:V,onTogglePin:X,onToggleTodo:Y,onDeleteItem:J,onMoveItem:oe,setEditingItemId:z,setEditingTitle:A,extractDomain:le})]},e.id))})}),k&&s.jsx(Jt,{groupId:k,groupTitle:(null==(e=r.find(e=>e.id===k))?void 0:e.title)||"",onClose:()=>C(null)}),s.jsx(xa,{isOpen:E.isOpen,itemTitle:(null==(t=E.item)?void 0:t.title)||"",currentGroupId:E.currentGroupId,availableGroups:r,onMove:async e=>{const{item:t,currentGroupId:s}=E;if(!t)return;const a=r.find(e=>e.id===s),i=r.find(t=>t.id===e);if(!a||!i)return;const l=a.items.filter(e=>e.id!==t.id),o=[...i.items||[],t];n(t=>t.map(t=>t.id===s?{...t,items:l,item_count:l.length}:t.id===e?{...t,items:o,item_count:o.length}:t));try{await Yt.moveTabGroupItem(t.id,e,o.length-1),await Promise.all(l.map((e,t)=>Yt.updateTabGroupItem(e.id,{position:t}))),He("✅ Item moved to group successfully")}catch(c){n(t=>t.map(t=>{var r;return t.id===s?{...t,items:a.items,item_count:a.items.length}:t.id===e?{...t,items:i.items,item_count:(null==(r=i.items)?void 0:r.length)||0}:t}))}},onClose:()=>L({isOpen:!1,item:null,currentGroupId:""})}),s.jsx(xt,{isOpen:D.isOpen,title:D.title,message:D.message,onConfirm:D.onConfirm,onCancel:()=>R({...D,isOpen:!1})})]})}),s.jsx(ua,{side:"right",defaultWidth:320,minWidth:280,maxWidth:500,storageKey:"tab-groups-right-sidebar-width",children:s.jsx(da,{tabGroups:r,onUpdate:ne})})]})}function pa(){var e;const{id:t}=j(),r=x(),{success:n,error:a}=ca(),[i,l]=m.useState(null),[o,c]=m.useState(!0),[d,u]=m.useState(null),[h,p]=m.useState(!1),[f,g]=m.useState(""),[b,v]=m.useState(!1),[y,w]=m.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});m.useEffect(()=>{t&&N(t)},[t]);const N=async e=>{try{c(!0),u(null);const t=await Yt.getTabGroup(e);l(t),g(t.title)}catch(t){u("加载标签页组失败")}finally{c(!1)}},k=async()=>{if(i&&f.trim())try{v(!0);const e=await Yt.updateTabGroup(i.id,{title:f.trim()});l(e),p(!1),n("标题更新成功")}catch(e){a("更新标题失败，请重试")}finally{v(!1)}},C=()=>{g((null==i?void 0:i.title)||""),p(!1)};return o?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-primary/30 border-t-primary rounded-full animate-spin"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"加载中..."})]})}):d||!i?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-destructive mb-4",children:d||"标签页组不存在"}),s.jsx("button",{onClick:()=>r("/tab"),className:"px-4 py-2 rounded-lg border border-border hover:bg-muted/50 transition-colors",style:{color:"var(--foreground)"},children:"返回列表"})]})}):s.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-5xl",children:[s.jsxs("div",{className:"mb-6",children:[s.jsxs("button",{onClick:()=>r("/tab"),className:"flex items-center gap-2 mb-4 text-sm hover:opacity-70 transition-opacity",style:{color:"var(--muted-foreground)"},children:[s.jsx(W,{className:"w-4 h-4"}),"返回列表"]}),s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1",children:[h?s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("input",{type:"text",value:f,onChange:e=>g(e.target.value),className:"flex-1 px-3 py-2 rounded-lg border border-border bg-card text-lg font-semibold",style:{color:"var(--foreground)"},autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&k(),"Escape"===e.key&&C()}}),s.jsx("button",{onClick:k,disabled:b||!f.trim(),className:"p-2 rounded-lg bg-success text-success-foreground hover:bg-success/90 transition-colors disabled:opacity-50",children:s.jsx(H,{className:"w-5 h-5"})}),s.jsx("button",{onClick:C,disabled:b,className:"p-2 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:s.jsx(We,{className:"w-5 h-5"})})]}):s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--foreground)"},children:i.title}),s.jsx("button",{onClick:()=>p(!0),className:"p-1.5 rounded-lg hover:bg-muted/50 transition-colors",title:"编辑标题",children:s.jsx(Te,{className:"w-4 h-4",style:{color:"var(--muted-foreground)"}})})]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm",style:{color:"var(--muted-foreground)"},children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(U,{className:"w-4 h-4"}),s.jsx("span",{children:(e=>{try{return _(new Date(e),{addSuffix:!0,locale:as})}catch{return e}})(i.created_at)})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(oe,{className:"w-4 h-4"}),s.jsxs("span",{children:[(null==(e=i.items)?void 0:e.length)||0," 个标签页"]})]})]})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{onClick:()=>{i&&w({isOpen:!0,title:"删除标签页组",message:`确定要删除标签页组"${i.title}"吗？此操作不可撤销。`,onConfirm:async()=>{w({...y,isOpen:!1});try{await Yt.deleteTabGroup(i.id),n("删除成功"),r("/tab")}catch(e){a("删除失败，请重试")}}})},className:"px-4 py-2 rounded-lg border border-border hover:bg-destructive/10 hover:border-destructive/50 transition-colors flex items-center gap-2",title:"删除标签页组",children:[s.jsx(Oe,{className:"w-4 h-4 text-destructive"}),s.jsx("span",{className:"text-sm font-medium text-destructive",children:"删除"})]})})]})]}),s.jsx("div",{className:"space-y-3",children:i.items&&i.items.length>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"rounded-2xl border border-border bg-gradient-to-br from-emerald-500/10 to-teal-500/10 p-4 mb-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(we,{className:"w-5 h-5",style:{color:"var(--foreground)"}}),s.jsxs("span",{className:"font-medium",style:{color:"var(--foreground)"},children:["共 ",i.items.length," 个标签页"]})]}),s.jsxs("button",{onClick:()=>{if(!i||!i.items)return;const e=i.items,t=e.length;w({isOpen:!0,title:"打开所有标签页",message:t>10?`即将打开 ${t} 个标签页，将分批打开以避免浏览器拦截。\n\n每批 10 个，间隔 1 秒。\n\n是否继续？`:`确定要在新标签页中打开 ${t} 个链接吗？`,onConfirm:async()=>{w({...y,isOpen:!1});const s=Math.ceil(t/10);for(let r=0;r<t;r+=10){const a=Math.floor(r/10)+1,i=e.slice(r,r+10);s>1&&n(`正在打开第 ${a}/${s} 批...`),i.forEach((e,t)=>{setTimeout(()=>{window.open(e.url,"_blank","noopener,noreferrer")},100*t)}),r+10<t&&await new Promise(e=>setTimeout(e,1e3))}n(`已成功打开 ${t} 个标签页！`)}})},className:"px-3 py-1.5 rounded-lg bg-success text-success-foreground text-sm font-medium hover:shadow-lg hover:bg-success/90 transition-all duration-200 flex items-center gap-1.5",children:[s.jsx(Le,{className:"w-3.5 h-3.5"}),"全部恢复"]})]})}),i.items.map((e,t)=>s.jsxs("div",{className:"group relative flex items-center gap-3 p-4 rounded-xl border border-border bg-card hover:border-success/50 hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>{return t=e.url,void window.open(t,"_blank","noopener,noreferrer");var t},children:[s.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-success/20 to-success/10 flex-shrink-0",children:s.jsx("span",{className:"text-sm font-semibold",style:{color:"var(--foreground)"},children:t+1})}),e.favicon&&s.jsx("img",{src:e.favicon,alt:"",className:"w-5 h-5 rounded flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-medium truncate mb-0.5",style:{color:"var(--foreground)"},children:e.title}),s.jsx("p",{className:"text-sm truncate",style:{color:"var(--muted-foreground)"},children:e.url})]}),s.jsx(oe,{className:"w-5 h-5 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",style:{color:"var(--muted-foreground)"}})]},e.id))]}):s.jsxs("div",{className:"text-center py-12 rounded-2xl border border-border bg-card",children:[s.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center",children:s.jsx(oe,{className:"w-8 h-8",style:{color:"var(--muted-foreground)"}})}),s.jsx("p",{className:"text-lg font-medium mb-1",style:{color:"var(--foreground)"},children:"此标签页组没有标签页"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"标签页组已被清空"})]})}),s.jsx(xt,{isOpen:y.isOpen,title:y.title,message:y.message,onConfirm:y.onConfirm,onCancel:()=>w({...y,isOpen:!1})})]})}function fa(){const{success:e,error:t}=ca(),[r,n]=m.useState([]),[a,i]=m.useState(!0),[l,o]=m.useState(null),[c,d]=m.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});m.useEffect(()=>{u()},[]);const u=async()=>{try{i(!0),o(null);const e=await Yt.getTrash();n(e.tab_groups)}catch(e){o("加载回收站失败")}finally{i(!1)}};return a?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"加载中..."})]})}):l?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-destructive mb-4",children:l}),s.jsx("button",{onClick:u,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90",children:"重试"})]})}):s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs(g,{to:"/tab",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground mb-4 transition-colors",children:[s.jsx(W,{className:"w-5 h-5"}),s.jsx("span",{children:"返回标签页组"})]}),s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(P,{className:"w-8 h-8 text-muted-foreground"}),s.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"回收站"})]}),s.jsx("p",{className:"text-muted-foreground",children:"已删除的标签页组将保留在这里，可以恢复或永久删除"})]}),0===r.length?s.jsxs("div",{className:"text-center py-16",children:[s.jsx(P,{className:"w-16 h-16 text-muted-foreground/30 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"回收站是空的"}),s.jsx("p",{className:"text-muted-foreground",children:"没有已删除的标签页组"})]}):s.jsx("div",{className:"space-y-4",children:r.map(r=>s.jsx("div",{className:"card p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:r.title}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(we,{className:"w-4 h-4"}),s.jsxs("span",{children:[r.item_count||0," 个标签页"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(U,{className:"w-4 h-4"}),s.jsxs("span",{children:["删除于"," ",r.deleted_at?_(new Date(r.deleted_at),{addSuffix:!0,locale:as}):"未知"]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>{return s=r.id,a=r.title,void d({isOpen:!0,title:"恢复标签页组",message:`确定要恢复"${a}"吗？`,onConfirm:async()=>{d({...c,isOpen:!1});try{await Yt.restoreTabGroup(s),n(e=>e.filter(e=>e.id!==s)),e("恢复成功")}catch(r){t("恢复失败，请重试")}}});var s,a},className:"flex items-center gap-2 px-4 py-2 bg-success text-success-foreground rounded-lg hover:bg-success/90 transition-colors",children:[s.jsx(Le,{className:"w-4 h-4"}),"恢复"]}),s.jsxs("button",{onClick:()=>{return s=r.id,a=r.title,void d({isOpen:!0,title:"永久删除",message:`确定要永久删除"${a}"吗？此操作不可撤销！`,onConfirm:async()=>{d({...c,isOpen:!1});try{await Yt.permanentDeleteTabGroup(s),n(e=>e.filter(e=>e.id!==s)),e("删除成功")}catch(r){t("删除失败，请重试")}}});var s,a},className:"flex items-center gap-2 px-4 py-2 bg-destructive text-destructive-foreground rounded-lg hover:bg-destructive/90 transition-colors",children:[s.jsx(Oe,{className:"w-4 h-4"}),"永久删除"]})]})]})},r.id))}),s.jsx(xt,{isOpen:c.isOpen,title:c.title,message:c.message,onConfirm:c.onConfirm,onCancel:()=>d({...c,isOpen:!1})})]})}function ga(){const[e,t]=m.useState(null),[r,n]=m.useState(!0),[a,i]=m.useState(null),[l,o]=m.useState(30),c=m.useCallback(async()=>{try{n(!0),i(null);const e=await Yt.getStatistics(l);t(e)}catch(e){i("加载统计数据失败")}finally{n(!1)}},[l]);return m.useEffect(()=>{c()},[c]),r?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"加载中..."})]})}):a||!e?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-destructive mb-4",children:a||"加载失败"}),s.jsx("button",{onClick:c,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90",children:"重试"})]})}):s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs(g,{to:"/tab",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground mb-4 transition-colors",children:[s.jsx(W,{className:"w-5 h-5"}),s.jsx("span",{children:"返回标签页组"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(q,{className:"w-8 h-8 text-primary"}),s.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"使用统计"})]}),s.jsxs("select",{value:l,onChange:e=>o(Number(e.target.value)),className:"px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-card text-foreground",children:[s.jsx("option",{value:7,children:"最近 7 天"}),s.jsx("option",{value:30,children:"最近 30 天"}),s.jsx("option",{value:90,children:"最近 90 天"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(we,{className:"w-8 h-8 text-primary"}),s.jsx("span",{className:"text-3xl font-bold text-foreground",children:e.summary.total_groups})]}),s.jsx("p",{className:"text-muted-foreground",children:"标签页组"})]}),s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(Ae,{className:"w-8 h-8 text-success"}),s.jsx("span",{className:"text-3xl font-bold text-foreground",children:e.summary.total_items})]}),s.jsx("p",{className:"text-muted-foreground",children:"标签页"})]}),s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(Re,{className:"w-8 h-8 text-accent"}),s.jsx("span",{className:"text-3xl font-bold text-foreground",children:e.summary.total_shares})]}),s.jsx("p",{className:"text-muted-foreground",children:"分享"})]}),s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(P,{className:"w-8 h-8 text-muted-foreground"}),s.jsx("span",{className:"text-3xl font-bold text-foreground",children:e.summary.total_deleted_groups})]}),s.jsx("p",{className:"text-muted-foreground",children:"回收站"})]})]}),s.jsxs("div",{className:"card p-6 mb-8",children:[s.jsxs("h2",{className:"text-xl font-semibold text-foreground mb-4 flex items-center gap-2",children:[s.jsx(ge,{className:"w-6 h-6 text-primary"}),"热门域名 Top 10"]}),0===e.top_domains.length?s.jsx("p",{className:"text-muted-foreground text-center py-8",children:"暂无数据"}):s.jsx("div",{className:"space-y-3",children:e.top_domains.map((t,r)=>s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("span",{className:"text-lg font-semibold text-muted-foreground/50 w-8",children:r+1}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"text-foreground font-medium",children:t.domain}),s.jsxs("span",{className:"text-muted-foreground",children:[t.count," 个"]})]}),s.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:s.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:(e.top_domains[0]?t.count/e.top_domains[0].count*100:0)+"%"}})})]})]},t.domain))})]}),s.jsxs("div",{className:"card p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-foreground mb-4 flex items-center gap-2",children:[s.jsx(we,{className:"w-6 h-6 text-primary"}),"标签页组大小分布"]}),0===e.group_size_distribution.length?s.jsx("p",{className:"text-muted-foreground text-center py-8",children:"暂无数据"}):s.jsx("div",{className:"space-y-3",children:e.group_size_distribution.map(t=>s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-foreground font-medium w-20",children:[t.range," 个"]}),s.jsx("div",{className:"flex-1",children:s.jsx("div",{className:"flex items-center justify-between mb-1",children:s.jsx("div",{className:"w-full bg-muted rounded-full h-8",children:s.jsx("div",{className:"bg-success h-8 rounded-full transition-all flex items-center justify-end pr-3",style:{width:t.count/Math.max(...e.group_size_distribution.map(e=>e.count))*100+"%",minWidth:"60px"},children:s.jsx("span",{className:"text-primary-foreground font-semibold",children:t.count})})})})})]},t.range))})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8",children:[s.jsxs("div",{className:"card p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"标签页组创建趋势"}),0===e.trends.groups.length?s.jsx("p",{className:"text-muted-foreground text-center py-8",children:"暂无数据"}):s.jsx("div",{className:"space-y-2",children:e.trends.groups.slice(-10).map(e=>s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:e.date}),s.jsxs("span",{className:"font-semibold text-foreground",children:[e.count," 个"]})]},e.date))})]}),s.jsxs("div",{className:"card p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"标签页添加趋势"}),0===e.trends.items.length?s.jsx("p",{className:"text-muted-foreground text-center py-8",children:"暂无数据"}):s.jsx("div",{className:"space-y-2",children:e.trends.items.slice(-10).map(e=>s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:e.date}),s.jsxs("span",{className:"font-semibold text-foreground",children:[e.count," 个"]})]},e.date))})]})]})]})}async function ba(){return(await Qe.get("/settings/api-keys")).data}async function va(e){return(await Qe.post("/settings/api-keys",e)).data}async function ja(e){await Qe.delete(`/settings/api-keys/${e}`)}async function ya(e){await Qe.delete(`/settings/api-keys/${e}?hard=true`)}const wa={all:["api-keys"],lists:()=>[...wa.all,"list"],list:()=>[...wa.lists()],details:()=>[...wa.all,"detail"],detail:e=>[...wa.details(),e],logs:e=>[...wa.all,"logs",e]};function Na(e){return r({queryKey:wa.detail(e),queryFn:()=>async function(e){return(await Qe.get(`/settings/api-keys/${e}`)).data}(e),enabled:!!e})}function ka(e,t=10){return r({queryKey:wa.logs(e),queryFn:()=>async function(e,t=10){return(await Qe.get(`/settings/api-keys/${e}/logs?limit=${t}`)).data}(e,t),enabled:!!e})}const Ca="bookmarks.read",Sa="tags.read",Ma="user.read",Ta={READ_ONLY:{name:"只读",description:"仅查看数据，不能修改",permissions:[Ca,Sa,Ma]},BASIC:{name:"基础使用",description:"可以添加书签和标签，但不能删除",permissions:["bookmarks.create",Ca,"tags.create",Sa,"tags.assign",Ma]},FULL:{name:"完整权限",description:"拥有所有操作权限",permissions:["bookmarks.*","tags.*","ai.suggest",Ma]}};function Ea(e){return{"bookmarks.create":"创建书签","bookmarks.read":"读取书签","bookmarks.update":"更新书签","bookmarks.delete":"删除书签","bookmarks.*":"所有书签权限","tags.create":"创建标签","tags.read":"读取标签","tags.update":"更新标签","tags.delete":"删除标签","tags.assign":"分配标签","tags.*":"所有标签权限","ai.suggest":"AI 智能建议","user.read":"读取用户信息","user.preferences.read":"读取用户偏好"}[e]||e}function _a({onClose:e}){const t=function(){const e=n();return a({mutationFn:va,onSuccess:()=>{e.invalidateQueries({queryKey:wa.lists()})}})}(),[r,i]=m.useState("basic"),[l,o]=m.useState({name:"",description:"",template:"BASIC",permissions:[],expires_at:null}),[c,d]=m.useState(null),[u,x]=m.useState(!1),h=()=>{"basic"===r?i("permissions"):"permissions"===r?i("expiration"):"expiration"===r&&f()},p=()=>{"permissions"===r?i("basic"):"expiration"===r&&i("permissions")},f=async()=>{try{const e=await t.mutateAsync(l);d(e),i("success")}catch{alert("创建失败，请重试")}},g=()=>{if("basic"===r)return l.name.trim().length>0;if("permissions"===r){const e=l.template?Ta[l.template].permissions:l.permissions;return e&&e.length>0}return!0};return s.jsx("div",{className:"fixed inset-0 bg-background flex items-center justify-center z-50",children:s.jsxs("div",{className:"card rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:["basic"===r&&s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-bold text-foreground mb-4",children:"创建 API Key - 步骤 1/3"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"名称 *"}),s.jsx("input",{type:"text",className:"input w-full",placeholder:"例如：Chrome 插件 - 工作电脑",value:l.name,onChange:e=>o({...l,name:e.target.value})}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"用于识别此 Key 的用途"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"描述 (可选)"}),s.jsx("textarea",{className:"input w-full h-20 resize-none",placeholder:"例如：用于浏览器插件访问",value:l.description,onChange:e=>o({...l,description:e.target.value})})]})]}),s.jsxs("div",{className:"flex justify-between mt-6",children:[s.jsx("button",{className:"btn",onClick:e,children:"取消"}),s.jsx("button",{className:"btn btn-primary",onClick:h,disabled:!g(),children:"下一步 →"})]})]}),"permissions"===r&&s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-bold text-foreground mb-4",children:"创建 API Key - 步骤 2/3"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-3",children:"快速选择:"}),s.jsx("div",{className:"space-y-2",children:Object.keys(Ta).map(e=>s.jsxs("label",{className:"flex items-start gap-3 p-3 border border-border rounded-lg cursor-pointer hover:bg-muted/30",children:[s.jsx("input",{type:"radio",name:"template",checked:l.template===e,onChange:()=>o({...l,template:e}),className:"mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"font-medium text-foreground",children:[Ta[e].name,"BASIC"===e&&s.jsx("span",{className:"ml-2 text-xs bg-primary text-primary-content px-2 py-0.5 rounded",children:"推荐"})]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:Ta[e].description})]})]},e))})]}),s.jsxs("div",{className:"p-4 bg-muted/30 border border-border rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-foreground mb-2",children:"包含的权限:"}),s.jsx("div",{className:"space-y-1 text-xs text-muted-foreground",children:(l.template?Ta[l.template].permissions:l.permissions||[]).map(e=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:"✓"}),s.jsx("span",{className:"font-medium",children:Ea(e)}),s.jsxs("span",{className:"text-muted-foreground/60",children:["(",e,")"]})]},e))})]})]}),s.jsxs("div",{className:"flex justify-between mt-6",children:[s.jsx("button",{className:"btn",onClick:p,children:"← 上一步"}),s.jsx("button",{className:"btn btn-primary",onClick:h,disabled:!g(),children:"下一步 →"})]})]}),"expiration"===r&&s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-bold text-foreground mb-4",children:"创建 API Key - 步骤 3/3"}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-3",children:"过期时间:"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border rounded-lg cursor-pointer hover:bg-muted/30",children:[s.jsx("input",{type:"radio",name:"expires",checked:null===l.expires_at,onChange:()=>o({...l,expires_at:null})}),s.jsx("span",{className:"text-foreground",children:"永不过期"})]}),s.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border rounded-lg cursor-pointer hover:bg-muted/30",children:[s.jsx("input",{type:"radio",name:"expires",checked:"30d"===l.expires_at,onChange:()=>o({...l,expires_at:"30d"})}),s.jsx("span",{className:"text-foreground",children:"30 天后"})]}),s.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border rounded-lg cursor-pointer hover:bg-muted/30",children:[s.jsx("input",{type:"radio",name:"expires",checked:"90d"===l.expires_at,onChange:()=>o({...l,expires_at:"90d"})}),s.jsx("span",{className:"text-foreground",children:"90 天后"})]})]})]})}),s.jsxs("div",{className:"flex justify-between mt-6",children:[s.jsx("button",{className:"btn",onClick:p,children:"← 上一步"}),s.jsx("button",{className:"btn btn-primary",onClick:h,disabled:t.isPending,children:t.isPending?"创建中...":"创建 API Key"})]})]}),"success"===r&&c&&s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"text-4xl mb-3",children:"⚠️"}),s.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:"创建成功！请妥善保存此 Key"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"您的 API Key:"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"input flex-1 font-mono text-sm",value:c.key,readOnly:!0,onClick:e=>e.currentTarget.select()}),s.jsx("button",{className:"btn",onClick:()=>{c&&(navigator.clipboard.writeText(c.key),x(!0),setTimeout(()=>x(!1),2e3))},children:u?"✓ 已复制":"📋 复制"})]})]}),s.jsxs("div",{className:"p-4 bg-warning/10 border border-warning/30 rounded-lg mb-6",children:[s.jsx("h4",{className:"font-medium text-warning mb-2",children:"⚠️ 重要提示："}),s.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1 list-disc list-inside",children:[s.jsx("li",{children:"此 Key 仅显示一次，关闭后无法再查看"}),s.jsx("li",{children:"请立即复制并保存到安全的地方"}),s.jsxs("li",{children:["后续您只能看到前缀: ",c.key_prefix,"..."]})]})]}),s.jsx("div",{className:"flex justify-center",children:s.jsx("button",{className:"btn btn-primary",onClick:e,children:"我已保存，关闭"})})]})]})})}function La({apiKey:e,onViewDetails:t,onRevoke:r,onDelete:n}){const a={active:"🟢",revoked:"🔴",expired:"🟠"}[e.status],i={active:"活跃",revoked:"已撤销",expired:"已过期"}[e.status],l=e.last_used_at?_(new Date(e.last_used_at),{addSuffix:!0,locale:as}):"从未使用";return s.jsx("div",{className:"p-3 sm:p-4 md:p-5 bg-gradient-to-br from-primary/5 to-secondary/5 border border-primary/20 rounded-xl",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-1 truncate",children:e.name}),s.jsxs("code",{className:"text-xs sm:text-sm text-muted-foreground font-mono break-all",children:[e.key_prefix,"..."]})]}),e.description&&s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-3 leading-relaxed",children:e.description}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 text-xs text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{children:"状态:"}),s.jsx("span",{children:a}),s.jsx("strong",{children:i})]}),s.jsxs("div",{children:["权限: ",s.jsxs("strong",{children:[e.permissions.length," 项"]})]}),s.jsxs("div",{children:["最后使用: ",s.jsx("strong",{className:"break-words",children:l})]}),s.jsxs("div",{children:["创建于:"," ",s.jsx("strong",{children:new Date(e.created_at).toLocaleDateString("zh-CN")})]}),e.expires_at&&s.jsxs("div",{className:"sm:col-span-2",children:["过期时间:"," ",s.jsx("strong",{children:new Date(e.expires_at).toLocaleDateString("zh-CN")})]})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto sm:ml-4",children:[s.jsx("button",{className:"btn btn-sm w-full sm:w-auto touch-manipulation",onClick:t,children:"查看详情"}),"active"===e.status&&s.jsx("button",{className:"btn btn-sm btn-error w-full sm:w-auto touch-manipulation",onClick:r,children:"撤销"}),n&&s.jsx("button",{className:"btn btn-sm w-full sm:w-auto touch-manipulation "+("active"===e.status?"btn-outline btn-error":"btn-error"),onClick:n,children:"删除"})]})]})})}function Da({apiKey:e,onClose:t}){const{data:r}=Na(e.id),{data:n}=ka(e.id,10),a=r||e,i=(null==n?void 0:n.logs)||[],l=null==r?void 0:r.stats,o={active:"🟢",revoked:"🔴",expired:"🟠"}[a.status],c={active:"活跃",revoked:"已撤销",expired:"已过期"}[a.status];return s.jsx("div",{className:"fixed inset-0 bg-background flex items-center justify-center z-50",children:s.jsx("div",{className:"card rounded-2xl shadow-2xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-xl font-bold text-foreground",children:a.name}),s.jsx("button",{className:"btn btn-sm",onClick:t,children:"关闭"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-sm font-medium text-foreground mb-3",children:"基本信息:"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"Key 前缀:"}),s.jsxs("code",{className:"font-mono",children:[a.key_prefix,"..."]})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"状态:"}),s.jsxs("span",{children:[o," ",c]})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"创建时间:"}),s.jsx("span",{children:new Date(a.created_at).toLocaleString("zh-CN")})]}),a.expires_at&&s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"过期时间:"}),s.jsx("span",{children:new Date(a.expires_at).toLocaleString("zh-CN")})]}),!a.expires_at&&s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"过期时间:"}),s.jsx("span",{children:"永不过期"})]}),a.description&&s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"描述:"}),s.jsx("span",{children:a.description})]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-sm font-medium text-foreground mb-3",children:"权限:"}),s.jsx("div",{className:"grid grid-cols-1 gap-2",children:a.permissions.map(e=>s.jsxs("div",{className:"text-xs bg-primary/10 text-primary px-3 py-2 rounded flex items-center gap-2",children:[s.jsx("span",{children:"✓"}),s.jsx("span",{className:"font-medium",children:Ea(e)}),s.jsxs("span",{className:"text-primary/60",children:["(",e,")"]})]},e))})]}),l&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-sm font-medium text-foreground mb-3",children:"使用情况:"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"最后使用:"}),s.jsx("span",{children:l.last_used_at?_(new Date(l.last_used_at),{addSuffix:!0,locale:as}):"从未使用"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"使用次数:"}),s.jsxs("span",{children:[l.total_requests," 次"]})]}),l.last_used_ip&&s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-muted-foreground w-28",children:"最后 IP:"}),s.jsx("span",{children:l.last_used_ip})]})]})]}),i.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-foreground mb-3",children:"最近活动: (最多显示 10 条)"}),s.jsx("div",{className:"bg-muted/30 border border-border rounded-lg overflow-hidden",children:s.jsxs("table",{className:"w-full text-xs",children:[s.jsx("thead",{className:"bg-muted",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"时间"}),s.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"方法"}),s.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"端点"}),s.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"状态"})]})}),s.jsx("tbody",{children:i.map((e,t)=>s.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[s.jsx("td",{className:"px-3 py-2 text-muted-foreground",children:new Date(e.created_at).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),s.jsx("td",{className:"px-3 py-2",children:s.jsx("code",{className:"text-xs",children:e.method})}),s.jsx("td",{className:"px-3 py-2 font-mono",children:e.endpoint}),s.jsx("td",{className:"px-3 py-2",children:s.jsx("span",{className:e.status<300?"text-success":e.status<400?"text-warning":"text-error",children:e.status})})]},t))})]})})]}),0===i.length&&s.jsx("div",{className:"text-center text-sm text-muted-foreground py-6",children:"暂无使用记录"})]})})})}function Ra(){const{data:e,isLoading:t}=r({queryKey:wa.list(),queryFn:ba}),i=function(){const e=n();return a({mutationFn:ja,onSuccess:()=>{e.invalidateQueries({queryKey:wa.lists()})}})}(),l=function(){const e=n();return a({mutationFn:ya,onSuccess:()=>{e.invalidateQueries({queryKey:wa.lists()})}})}(),[o,c]=m.useState(!1),[d,u]=m.useState(null);if(t)return s.jsx("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:s.jsx("div",{className:"text-center text-muted-foreground",children:"加载中..."})});const x=(null==e?void 0:e.keys)||[],h=(null==e?void 0:e.quota)||{used:0,limit:3};return s.jsxs("div",{className:"container mx-auto px-3 sm:px-4 py-6 sm:py-8 max-w-5xl",children:[s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[s.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground",children:"API Keys 管理"}),s.jsx("button",{className:"btn btn-primary w-full sm:w-auto touch-manipulation",onClick:()=>c(!0),disabled:h.used>=h.limit,children:"+ 创建新的 API Key"})]}),s.jsxs("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-muted/30 border border-border rounded-lg",children:[s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-2 leading-relaxed",children:"API Keys 用于第三方应用（如浏览器插件）安全访问您的 TMarks 数据。 您可以随时撤销不需要的 Key。"}),s.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["当前使用: ",s.jsxs("strong",{children:[h.used," / ",h.limit>=999?"无限制":h.limit]})]})]}),0===x.length?s.jsxs("div",{className:"text-center py-8 sm:py-12",children:[s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:"还没有创建任何 API Key"}),s.jsx("button",{className:"btn btn-primary w-full sm:w-auto touch-manipulation",onClick:()=>c(!0),children:"创建第一个 API Key"})]}):s.jsx("div",{className:"space-y-3 sm:space-y-4",children:x.map(e=>s.jsx(La,{apiKey:e,onViewDetails:()=>u(e),onRevoke:()=>(async e=>{if(confirm("确定要撤销此 API Key 吗？撤销后无法恢复。"))try{await i.mutateAsync(e),alert("API Key 已撤销")}catch{alert("撤销失败，请重试")}})(e.id),onDelete:()=>(async e=>{if(confirm("确定要彻底删除此 API Key 吗？该操作不可恢复，并会清除所有使用记录。"))try{await l.mutateAsync(e),alert("API Key 已永久删除")}catch{alert("删除失败，请重试")}})(e.id)},e.id))}),s.jsxs("div",{className:"mt-6 p-4 bg-info/10 border border-info/30 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-info mb-2",children:"💡 提示："}),s.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1 list-disc list-inside",children:[s.jsxs("li",{children:["每个账户最多创建 ",h.limit>=999?"无限制":`${h.limit} 个`," API Key"]}),s.jsx("li",{children:"API Key 创建后仅显示一次，请妥善保存"}),s.jsx("li",{children:"如果 Key 泄露，请立即撤销"})]})]})]}),o&&s.jsx(_a,{onClose:()=>c(!1)}),d&&s.jsx(Da,{apiKey:d,onClose:()=>u(null)})]})}const Ia="/api/public",za={getSettings:async()=>(await Qe.get("/settings/share")).data.share,updateSettings:async e=>(await Qe.put("/settings/share",e)).data.share,async getPublicShare(e){var t;const s=`${Ia.replace(/\/$/,"")}/${encodeURIComponent(e)}`,r=await fetch(s,{headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error("无法加载公开分享内容");const n=await r.json();if(!n.data)throw new Error((null==(t=n.error)?void 0:t.message)||"公开内容不存在");return n.data},async getPublicSharePaginated(e,t){var s;const r=new URLSearchParams;(null==t?void 0:t.page_size)&&r.set("page_size",String(t.page_size)),(null==t?void 0:t.page_cursor)&&r.set("page_cursor",t.page_cursor);const n=r.toString(),a=`${Ia.replace(/\/$/,"")}/${encodeURIComponent(e)}${n?`?${n}`:""}`,i=await fetch(a,{headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error("无法加载公开分享内容");const l=await i.json();if(!l.data)throw new Error((null==(s=l.error)?void 0:s.message)||"公开内容不存在");return l.data}},Oa="share-settings";function Aa(){const{data:e,isLoading:t}=r({queryKey:[Oa],queryFn:()=>za.getSettings(),staleTime:3e5}),i=function(){const e=n();return a({mutationFn:e=>za.updateSettings(e),onSuccess:t=>{e.setQueryData([Oa],t)}})}(),[l,o]=m.useState(!1),[c,d]=m.useState(""),[u,x]=m.useState(""),[h,p]=m.useState(""),[f,g]=m.useState(!1);m.useEffect(()=>{e&&(o(e.enabled),d(e.slug||""),x(e.title||""),p(e.description||""))},[e]);const b=m.useMemo(()=>c?"undefined"==typeof window?`/share/${c}`:`${window.location.origin}/share/${c}`:"",[c]);return s.jsxs("div",{className:"max-w-3xl mx-auto py-8",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"公开分享设置"}),s.jsxs("div",{className:"card p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold",children:"启用公开分享"}),s.jsx("p",{className:"text-sm text-base-content/70",children:"开启后可将书签以只读页面公开给任何人访问。"})]}),s.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[s.jsx("span",{children:"开启公开分享"}),s.jsx("input",{type:"checkbox",checked:l,onChange:e=>o(e.target.checked),disabled:t||i.isPending})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-medium text-base-content/70",children:"分享链接后缀"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"input flex-1",placeholder:"例如：my-bookmarks",value:c,onChange:e=>d(e.target.value.replace(/[^a-zA-Z0-9-]/g,"").toLowerCase()),disabled:t||i.isPending}),s.jsx("button",{type:"button",className:"btn btn-sm",onClick:()=>{i.mutate({regenerate_slug:!0,enabled:!0,title:u.trim()||null,description:h.trim()||null})},disabled:i.isPending,children:"重新生成"})]}),s.jsx("p",{className:"text-xs text-base-content/60",children:"仅支持字母、数字与短横线，留空将自动生成。"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-medium text-base-content/70",children:"页面标题"}),s.jsx("input",{type:"text",className:"input",placeholder:"公开页面标题，用于向访客介绍",value:u,onChange:e=>x(e.target.value),disabled:t||i.isPending})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-medium text-base-content/70",children:"页面描述"}),s.jsx("textarea",{className:"input min-h-[80px]",placeholder:"可选描述，向访客说明书签集合内容",value:h,onChange:e=>p(e.target.value),disabled:t||i.isPending})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-medium text-base-content/70",children:"分享链接"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"input flex-1",readOnly:!0,value:b||"生成后显示分享链接"}),s.jsx("button",{type:"button",className:"btn btn-sm",onClick:async()=>{if(b)try{await navigator.clipboard.writeText(b),g(!0),setTimeout(()=>g(!1),1500)}catch(e){}},disabled:!b,children:f?"已复制":"复制"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-outline",onClick:()=>{e&&(o(e.enabled),d(e.slug||""),x(e.title||""),p(e.description||""))},disabled:t||i.isPending,children:"重置"}),s.jsx("button",{type:"button",className:"btn btn-sm",onClick:()=>{i.mutate({enabled:l,slug:c.trim()||null,title:u.trim()||null,description:h.trim()||null})},disabled:i.isPending,children:i.isPending?"保存中...":"保存设置"})]})]})]})}function $a({progress:e,variant:t="default",showSpeed:r=!0,showETA:n=!0,className:a=""}){const[i,l]=m.useState(0),[o,c]=m.useState(!1);return m.useEffect(()=>{const t=setTimeout(()=>{l(e.percentage)},100);return()=>clearTimeout(t)},[e.percentage]),m.useEffect(()=>{if(e.percentage>=100){const e=setTimeout(()=>{c(!0)},500);return()=>clearTimeout(e)}c(!1)},[e.percentage]),"compact"===t?s.jsxs("div",{className:`flex items-center space-x-3 ${a}`,children:[s.jsx("div",{className:"flex-shrink-0",children:o?s.jsx(ee,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):s.jsx(ke,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 animate-spin"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.status}),s.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:[Math.round(i),"%"]})]}),s.jsx("div",{className:"mt-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:s.jsx("div",{className:"bg-blue-600 dark:bg-blue-400 h-1.5 rounded-full transition-all duration-500 ease-out",style:{width:`${i}%`}})})]})]}):"detailed"===t?s.jsxs("div",{className:`space-y-3 sm:space-y-4 ${a}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[s.jsx("div",{className:"flex-shrink-0",children:o?s.jsx(ee,{className:"h-5 w-5 sm:h-6 sm:w-6 text-green-600 dark:text-green-400"}):s.jsx(ke,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 dark:text-blue-400 animate-spin"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"text-sm sm:text-base md:text-lg font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.status}),e.message&&s.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 truncate",children:e.message})]})]}),s.jsxs("div",{className:"text-right flex-shrink-0",children:[s.jsxs("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100",children:[Math.round(i),"%"]}),s.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:[e.current," / ",e.total]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 sm:h-3 overflow-hidden",children:s.jsx("div",{className:"h-2 sm:h-3 rounded-full transition-all duration-500 ease-out bg-gradient-to-r from-blue-500 to-blue-600 dark:from-blue-400 dark:to-blue-500",style:{width:`${i}%`},children:s.jsx("div",{className:"h-full w-full bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"})})}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-1 sm:space-y-0 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[s.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[r&&e.speed&&s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(Fe,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:[Math.round(e.speed)," 项/秒"]})]}),n&&e.estimated_remaining&&s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(se,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:["剩余 ",Ba(e.estimated_remaining)]})]})]}),s.jsxs("div",{className:"whitespace-nowrap",children:["已处理 ",e.current.toLocaleString()," 项"]})]})]})]}):s.jsxs("div",{className:`space-y-2 sm:space-y-3 ${a}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[o?s.jsx(ee,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):s.jsx(ke,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600 dark:text-blue-400 animate-spin flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:e.status})]}),s.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-gray-100 flex-shrink-0 ml-2",children:[Math.round(i),"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 sm:h-2 overflow-hidden",children:s.jsx("div",{className:"bg-blue-600 dark:bg-blue-400 h-1.5 sm:h-2 rounded-full transition-all duration-500 ease-out relative",style:{width:`${i}%`},children:!o&&s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"})})}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-1 sm:space-y-0 text-xs text-gray-500 dark:text-gray-400",children:[s.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[s.jsxs("span",{className:"whitespace-nowrap",children:[e.current," / ",e.total]}),r&&e.speed&&s.jsxs("span",{className:"whitespace-nowrap",children:[Math.round(e.speed)," 项/秒"]}),n&&e.estimated_remaining&&s.jsxs("span",{className:"whitespace-nowrap",children:["剩余 ",Ba(e.estimated_remaining)]})]}),e.message&&s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.message})]})]})}function Ba(e){if(e<60)return`${Math.round(e)}秒`;if(e<3600){const t=Math.floor(e/60),s=Math.round(e%60);return s>0?`${t}分${s}秒`:`${t}分钟`}{const t=Math.floor(e/3600),s=Math.floor(e%3600/60);return s>0?`${t}小时${s}分钟`:`${t}小时`}}function Pa({errors:e,variant:t="error",title:r,dismissible:n=!0,collapsible:a=!0,showDetails:i=!1,maxVisible:l=3,onDismiss:o,onRetry:c,className:d=""}){const[u,x]=m.useState(!1),[h,p]=m.useState(null);if(0===e.length)return null;const f={error:{containerClass:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",iconClass:"text-red-600 dark:text-red-400",titleClass:"text-red-800 dark:text-red-200",textClass:"text-red-700 dark:text-red-300",icon:Q},warning:{containerClass:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",iconClass:"text-yellow-600 dark:text-yellow-400",titleClass:"text-yellow-800 dark:text-yellow-200",textClass:"text-yellow-700 dark:text-yellow-300",icon:$e},info:{containerClass:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",iconClass:"text-blue-600 dark:text-blue-400",titleClass:"text-blue-800 dark:text-blue-200",textClass:"text-blue-700 dark:text-blue-300",icon:je},success:{containerClass:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",iconClass:"text-green-600 dark:text-green-400",titleClass:"text-green-800 dark:text-green-200",textClass:"text-green-700 dark:text-green-300",icon:ee}}[t],g=f.icon,b=u?e:e.slice(0,l),v=e.length>l;return s.jsx("div",{className:`rounded-lg border p-3 sm:p-4 ${f.containerClass} ${d}`,children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start space-x-2 sm:space-x-3 flex-1 min-w-0",children:[s.jsx(g,{className:`h-4 w-4 sm:h-5 sm:w-5 mt-0.5 flex-shrink-0 ${f.iconClass}`}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:`text-sm sm:text-base font-semibold ${f.titleClass}`,children:r||Fa(t,e.length)}),s.jsx("div",{className:"mt-2 space-y-1.5 sm:space-y-2",children:b.map((e,r)=>s.jsx(Wa,{error:e,index:r,variant:t,showDetails:i,onCopy:()=>(async(e,t)=>{const s=[`错误: ${e.message}`,e.code&&`代码: ${e.code}`,e.field&&`字段: ${e.field}`,e.details&&`详情: ${e.details}`,e.timestamp&&`时间: ${e.timestamp}`].filter(Boolean).join("\n");try{await navigator.clipboard.writeText(s),p(e.id||t.toString()),setTimeout(()=>p(null),2e3)}catch(r){}})(e,r),isCopied:h===(e.id||r.toString())},e.id||r))}),v&&a&&s.jsx("button",{onClick:()=>x(!u),className:`mt-3 inline-flex items-center space-x-1 text-xs sm:text-sm font-medium ${f.textClass} hover:underline touch-manipulation`,children:u?s.jsxs(s.Fragment,{children:[s.jsx(Y,{className:"h-3 w-3 sm:h-4 sm:w-4"}),s.jsx("span",{children:"收起"})]}):s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"h-3 w-3 sm:h-4 sm:w-4"}),s.jsxs("span",{className:"hidden sm:inline",children:["显示更多 (",e.length-l," 个)"]}),s.jsxs("span",{className:"sm:hidden",children:["更多 (",e.length-l,")"]})]})})]})]}),s.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 ml-2 flex-shrink-0",children:[c&&s.jsx("button",{onClick:c,className:`p-1.5 sm:p-2 rounded-md ${f.textClass} hover:bg-black/5 dark:hover:bg-white/5 touch-manipulation`,title:"重试",children:s.jsx(_e,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),n&&s.jsx("button",{onClick:o,className:`p-1.5 sm:p-2 rounded-md ${f.textClass} hover:bg-black/5 dark:hover:bg-white/5 touch-manipulation`,title:"关闭",children:s.jsx(We,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]})]})})}function Wa({error:e,variant:t,showDetails:r,onCopy:n,isCopied:a}){const[i,l]=m.useState(!1),o={error:"text-red-700 dark:text-red-300",warning:"text-yellow-700 dark:text-yellow-300",info:"text-blue-700 dark:text-blue-300",success:"text-green-700 dark:text-green-300"}[t];return s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("p",{className:`text-xs sm:text-sm ${o} leading-relaxed`,children:[e.field&&s.jsxs("span",{className:"font-semibold",children:[e.field,": "]}),s.jsx("span",{className:"break-words",children:e.message}),e.code&&s.jsx("span",{className:"ml-2 px-1.5 py-0.5 text-xs bg-black/10 dark:bg-white/10 rounded whitespace-nowrap",children:e.code})]}),e.details&&(r||i)&&s.jsx("div",{className:"mt-2 p-2 bg-black/5 dark:bg-white/5 rounded text-xs font-mono break-all",children:e.details})]}),s.jsxs("div",{className:"flex items-center space-x-1 ml-2 flex-shrink-0",children:[e.details&&!r&&s.jsx("button",{onClick:()=>l(!i),className:`p-1.5 rounded text-xs ${o} hover:bg-black/5 dark:hover:bg-white/5 touch-manipulation`,title:"查看详情",children:i?s.jsx(Y,{className:"h-3 w-3"}):s.jsx(V,{className:"h-3 w-3"})}),s.jsx("button",{onClick:n,className:`p-1.5 rounded text-xs ${o} hover:bg-black/5 dark:hover:bg-white/5 touch-manipulation`,title:a?"已复制":"复制错误信息",children:a?s.jsx(ee,{className:"h-3 w-3"}):s.jsx(ne,{className:"h-3 w-3"})})]})]}),e.timestamp&&s.jsx("p",{className:`text-xs ${o} opacity-75 truncate`,children:new Date(e.timestamp).toLocaleString()})]})}function Fa(e,t){return{error:1===t?"发生错误":`发生 ${t} 个错误`,warning:1===t?"警告":`${t} 个警告`,info:1===t?"信息":`${t} 条信息`,success:1===t?"成功":`${t} 个成功操作`}[e]||"通知"}function Ga({onExport:e}){var t,r;const[n,a]=m.useState("json"),[i,l]=m.useState(!1),[o,c]=m.useState(null),[d,u]=m.useState(null),[x,h]=m.useState(null),[p,f]=m.useState({include_tags:!0,include_metadata:!0,format_options:{pretty_print:!0,include_click_stats:!1,include_user_info:!1}}),g=async()=>{var t,s,r,a,i,o,c;l(!0),u(null),h({current:0,total:100,status:"准备导出..."});try{const l=new URLSearchParams({format:n,include_metadata:p.include_metadata.toString(),include_tags:p.include_tags.toString(),pretty_print:(null==(s=null==(t=p.format_options)?void 0:t.pretty_print)?void 0:s.toString())||"true",include_stats:(null==(a=null==(r=p.format_options)?void 0:r.include_click_stats)?void 0:a.toString())||"false",include_user:(null==(o=null==(i=p.format_options)?void 0:i.include_user_info)?void 0:o.toString())||"false"});h({current:25,total:100,status:"正在生成导出数据..."});const d=await fetch(`/api/v1/export?${l}`);if(!d.ok){const e=await d.json();throw new Error(e.message||"Export failed")}h({current:75,total:100,status:"正在下载文件..."});const u=d.headers.get("Content-Disposition"),m=(null==(c=null==u?void 0:u.match(/filename="([^"]+)"/))?void 0:c[1])||`tmarks-export-${Date.now()}.${n}`,x=await d.blob(),f=window.URL.createObjectURL(x),g=document.createElement("a");g.href=f,g.download=m,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(f),h({current:100,total:100,status:"导出完成"}),null==e||e(n,p)}catch(d){const e=d instanceof Error?d.message:"导出失败，请重试";u(e)}finally{l(!1),setTimeout(()=>h(null),2e3)}},b=[{value:"json",label:"JSON",description:"TMarks 标准格式，包含完整数据",icon:re,recommended:!0},{value:"html",label:"HTML",description:"浏览器书签格式，兼容性好",icon:me,recommended:!1}];return s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground",children:"导出书签"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"将您的书签数据导出为文件，支持多种格式"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-foreground",children:"导出格式"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:b.map(e=>{const t=e.icon;return s.jsx("div",{className:"relative rounded-lg border p-3 sm:p-4 cursor-pointer transition-all touch-manipulation "+(n===e.value?"border-primary bg-primary/10":"border-border hover:border-border/80"),onClick:()=>a(e.value),children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(t,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"font-medium text-foreground text-sm sm:text-base",children:e.label}),e.recommended&&s.jsx("span",{className:"px-2 py-0.5 text-xs bg-success/10 text-success rounded flex-shrink-0",children:"推荐"})]}),s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:e.description})]}),s.jsx("input",{type:"radio",name:"format",value:e.value,checked:n===e.value,onChange:()=>a(e.value),className:"h-4 w-4 text-primary border-border focus:ring-primary flex-shrink-0 mt-0.5"})]})},e.value)})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("label",{className:"block text-sm font-medium text-foreground",children:"导出选项"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:p.include_tags,onChange:e=>f(t=>({...t,include_tags:e.target.checked})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"包含标签信息"})]}),s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:p.include_metadata,onChange:e=>f(t=>({...t,include_metadata:e.target.checked})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"包含元数据"})]}),"json"===n&&s.jsxs(s.Fragment,{children:[s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:null==(t=p.format_options)?void 0:t.pretty_print,onChange:e=>f(t=>({...t,format_options:{...t.format_options,pretty_print:e.target.checked}})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"格式化 JSON（便于阅读）"})]}),s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:null==(r=p.format_options)?void 0:r.include_click_stats,onChange:e=>f(t=>({...t,format_options:{...t.format_options,include_click_stats:e.target.checked}})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"包含点击统计"})]})]})]})]}),o&&s.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:[s.jsx("h4",{className:"text-sm font-semibold text-foreground mb-3",children:"导出预览"}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-primary",children:o.total_bookmarks}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"书签数量"})]}),s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-success",children:o.total_tags}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"标签数量"})]}),s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-warning",children:o.pinned_bookmarks}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"置顶书签"})]}),s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-foreground",children:Ka(o.estimated_size)}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"预计大小"})]})]})]}),x&&s.jsx($a,{progress:{current:x.current,total:x.total,percentage:x.current/x.total*100,status:x.status},variant:"default",showSpeed:!1,showETA:!1}),d&&s.jsx(Pa,{errors:[{message:d}],variant:"error",title:"导出失败",dismissible:!0,onDismiss:()=>u(null),onRetry:g}),s.jsxs("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3",children:[s.jsx("button",{onClick:async()=>{try{const e=await fetch("/api/v1/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({format:n})});if(e.ok){const t=await e.json();c(t.stats)}}catch(e){}},disabled:i,className:"w-full sm:w-auto px-4 py-3 sm:py-2 text-sm font-medium text-foreground bg-card border border-border rounded-md hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation",children:"预览信息"}),s.jsxs("button",{onClick:g,disabled:i,className:"w-full sm:w-auto flex items-center justify-center space-x-2 px-4 py-3 sm:py-2 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation",children:[i?s.jsx(ke,{className:"h-4 w-4 animate-spin"}):s.jsx(ie,{className:"h-4 w-4"}),s.jsx("span",{children:i?"导出中...":"开始导出"})]})]})]})}function Ka(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function Ua({onFileSelect:e,accept:t="*",maxSize:r=10485760,disabled:n=!1,className:a="",children:i}){const[l,o]=m.useState({isDragOver:!1,isValidDrag:!1,error:null}),c=m.useRef(null),d=m.useCallback(e=>{var s;if(e.size>r)return`文件大小超过限制 (${qa(r)})`;if("*"!==t){const r=t.split(",").map(e=>e.trim()),n="."+(null==(s=e.name.split(".").pop())?void 0:s.toLowerCase());if(!r.some(t=>t.startsWith(".")?t===n:e.type.match(t.replace("*",".*"))))return`不支持的文件类型，请选择: ${r.join(", ")}`}return null},[t,r]),u=m.useCallback(t=>{const s=d(t);s?o(e=>({...e,error:s})):(o(e=>({...e,error:null})),e(t))},[d,e]),x=m.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),n)return;const t=Array.from(e.dataTransfer.files),s=1===t.length&&t[0]&&null===d(t[0]);o(e=>({...e,isDragOver:!0,isValidDrag:s||!1}))},[n,d]),h=m.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),p=m.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.contains(e.relatedTarget)||o(e=>({...e,isDragOver:!1,isValidDrag:!1}))},[]),f=m.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),o(e=>({...e,isDragOver:!1,isValidDrag:!1})),n)return;const t=Array.from(e.dataTransfer.files);1===t.length&&t[0]&&u(t[0])},[n,u]),g=m.useCallback(()=>{var e;n||null==(e=c.current)||e.click()},[n]),b=m.useCallback(e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&u(s)},[u]),v=m.useCallback(()=>{o(e=>({...e,error:null}))},[]),j=["relative border-2 border-dashed rounded-lg transition-all duration-200 cursor-pointer","hover:border-gray-400 dark:hover:border-gray-500","focus-within:ring-2 focus-within:ring-blue-500 focus-within:ring-offset-2",a];return n?j.push("opacity-50 cursor-not-allowed"):l.isDragOver?l.isValidDrag?j.push("border-green-500 bg-green-50 dark:bg-green-900/20"):j.push("border-red-500 bg-red-50 dark:bg-red-900/20"):j.push("border-gray-300 dark:border-gray-600"),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:j.join(" "),onDragEnter:x,onDragOver:h,onDragLeave:p,onDrop:f,onClick:g,children:[s.jsx("input",{ref:c,type:"file",accept:t,onChange:b,className:"sr-only",disabled:n}),i||s.jsx("div",{className:"p-6 sm:p-8 text-center",children:s.jsxs("div",{className:"flex flex-col items-center space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"p-3 sm:p-3 rounded-full "+(l.isDragOver?l.isValidDrag?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30":"bg-gray-100 dark:bg-gray-800"),children:l.isDragOver?l.isValidDrag?s.jsx(ee,{className:"h-8 w-8 sm:h-8 sm:w-8 text-green-600 dark:text-green-400"}):s.jsx(Q,{className:"h-8 w-8 sm:h-8 sm:w-8 text-red-600 dark:text-red-400"}):s.jsx(Be,{className:"h-8 w-8 sm:h-8 sm:w-8 text-gray-400"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900 dark:text-gray-100",children:l.isDragOver?l.isValidDrag?"松开以上传文件":"文件格式不支持":"拖拽文件到此处或点击选择"}),s.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["*"!==t&&`支持格式: ${t}`,r&&` • 最大 ${qa(r)}`]})]}),!l.isDragOver&&s.jsxs("button",{type:"button",className:"inline-flex items-center px-4 py-3 sm:px-4 sm:py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 touch-manipulation",disabled:n,children:[s.jsx(me,{className:"h-4 w-4 mr-2"}),"选择文件"]})]})}),l.isDragOver&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-5 rounded-lg pointer-events-none"})]}),l.error&&s.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Q,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),s.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:l.error})]}),s.jsxs("button",{onClick:v,className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200",children:[s.jsx("span",{className:"sr-only",children:"关闭"}),"×"]})]})]})}function qa(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function Ha({onImport:e}){var t;const r=x(),[n,a]=m.useState("html"),[i,l]=m.useState(null),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[h,p]=m.useState(null),[f,g]=m.useState(null),[b,v]=m.useState(null),[j,y]=m.useState({skip_duplicates:!0,create_missing_tags:!0,preserve_timestamps:!0,batch_size:50,max_concurrent:5,default_tag_color:"hsl(var(--primary))",folder_as_tag:!0}),w=m.useRef(null),N=[{value:"html",label:"HTML",description:"浏览器导出的书签文件",icon:me,extensions:[".html",".htm"],recommended:!0},{value:"json",label:"JSON",description:"JSON 格式的书签数据",icon:re,extensions:[".json"],recommended:!1},{value:"markdown",label:"Markdown",description:"Markdown 格式的书签列表",icon:de,extensions:[".md",".markdown"],recommended:!1}],k=async e=>{var t;u(!0);try{const s="."+(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase()),r=N.find(e=>e.value===n);if(!(null==r?void 0:r.extensions.includes(s)))return void v({valid:!1,errors:[{field:"file",message:`文件格式不匹配，期望 ${null==r?void 0:r.extensions.join(", ")}，实际为 ${s}`}],warnings:[]});const a=52428800;if(e.size>a)return void v({valid:!1,errors:[{field:"file",message:`文件过大，最大支持 ${Va(a)}，当前文件 ${Va(e.size)}`}],warnings:[]});await e.text(),v({valid:!0,errors:[],warnings:[]})}catch{v({valid:!1,errors:[{field:"file",message:"文件读取失败，请确保文件未损坏"}],warnings:[]})}finally{u(!1)}},C=()=>{l(null),g(null),v(null),p(null),w.current&&(w.current.value="")};return s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground",children:"导入书签"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"从其他平台导入您的书签数据"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-foreground",children:"文件格式"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:N.map(e=>{const t=e.icon;return s.jsx("div",{className:"relative rounded-lg border p-3 sm:p-4 cursor-pointer transition-all touch-manipulation "+(n===e.value?"border-primary bg-primary/10":"border-border hover:border-border/80"),onClick:()=>a(e.value),children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(t,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"font-medium text-foreground text-sm sm:text-base",children:e.label}),e.recommended&&s.jsx("span",{className:"px-2 py-0.5 text-xs bg-success/10 text-success rounded flex-shrink-0",children:"推荐"})]}),s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:e.description}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["支持: ",e.extensions.join(", ")]})]}),s.jsx("input",{type:"radio",name:"format",value:e.value,checked:n===e.value,onChange:()=>a(e.value),className:"h-4 w-4 text-primary border-border focus:ring-primary flex-shrink-0 mt-0.5"})]})},e.value)})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-foreground",children:"选择文件"}),s.jsx(Ua,{onFileSelect:e=>{l(e),g(null),k(e)},accept:null==(t=N.find(e=>e.value===n))?void 0:t.extensions.join(","),maxSize:52428800,disabled:o,children:i?s.jsx("div",{className:"p-6 text-center",children:s.jsx("div",{className:"flex flex-col items-center space-y-3",children:d?s.jsxs(s.Fragment,{children:[s.jsx(ke,{className:"h-8 w-8 text-primary animate-spin"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-medium text-foreground",children:"正在验证文件..."}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.name," (",Va(i.size),")"]})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"h-8 w-8 text-success"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-medium text-foreground",children:"文件已选择"}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.name," (",Va(i.size),")"]})]}),s.jsx("button",{onClick:C,className:"px-4 py-2 text-sm font-medium text-foreground bg-card border border-border rounded-md hover:bg-muted",children:"重新选择"})]})})}):null})]}),b&&s.jsx(Pa,{errors:b.errors,variant:b.valid?"success":"error",title:b.valid?"文件验证通过":"文件验证失败",dismissible:!1,collapsible:!0,showDetails:!0}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("label",{className:"block text-sm font-medium text-foreground",children:"导入选项"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:j.skip_duplicates,onChange:e=>y(t=>({...t,skip_duplicates:e.target.checked})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"跳过重复的书签"})]}),s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:j.create_missing_tags,onChange:e=>y(t=>({...t,create_missing_tags:e.target.checked})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"自动创建缺失的标签"})]}),s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:j.preserve_timestamps,onChange:e=>y(t=>({...t,preserve_timestamps:e.target.checked})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"保留原始时间戳"})]}),"html"===n&&s.jsxs("label",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"checkbox",checked:j.folder_as_tag,onChange:e=>y(t=>({...t,folder_as_tag:e.target.checked})),className:"h-4 w-4 text-primary border-border rounded focus:ring-primary"}),s.jsx("span",{className:"text-sm text-foreground",children:"将文件夹转换为标签"})]})]})]}),h&&s.jsx($a,{progress:{current:h.current,total:h.total,percentage:h.current/h.total*100,status:h.status,message:`正在处理第 ${h.current} / ${h.total} 项`},variant:"detailed",showSpeed:!0,showETA:!0}),f&&s.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:[s.jsx("h4",{className:"text-sm font-semibold text-foreground mb-3",children:"导入结果"}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-success",children:f.success}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"成功导入"})]}),s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-destructive",children:f.failed}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"导入失败"})]}),s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-warning",children:f.skipped}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"跳过重复"})]}),s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx("div",{className:"text-lg sm:text-xl font-bold text-primary",children:f.total}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"总计处理"})]})]}),f.total>0&&s.jsxs("div",{className:"mt-4",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm mb-2",children:[s.jsx("span",{className:"text-muted-foreground",children:"成功率"}),s.jsxs("span",{className:"font-medium text-foreground",children:[Math.round(f.success/f.total*100),"%"]})]}),s.jsx("div",{className:"w-full bg-border rounded-full h-2",children:s.jsx("div",{className:"bg-success h-2 rounded-full transition-all duration-500",style:{width:f.success/f.total*100+"%"}})})]}),f.errors.length>0&&s.jsx("div",{className:"mt-4",children:s.jsx(Pa,{errors:f.errors.map(e=>({message:e.error,code:e.code,details:`书签: ${e.item.title||e.item.url}`})),variant:"error",title:`导入错误 (${f.errors.length})`,dismissible:!1,collapsible:!0,maxVisible:2})}),f.success>0&&s.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3",children:[s.jsxs("button",{onClick:()=>r("/bookmarks"),className:"flex-1 flex items-center justify-center space-x-2 px-4 py-3 sm:py-2 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary touch-manipulation",children:[s.jsx("span",{children:"查看导入的书签"}),s.jsx(F,{className:"h-4 w-4"})]}),s.jsx("button",{onClick:C,className:"flex-1 px-4 py-3 sm:py-2 text-sm font-medium text-foreground bg-card border border-border rounded-md hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary touch-manipulation",children:"继续导入"})]})]}),!f&&s.jsx("div",{className:"flex space-x-3",children:s.jsxs("button",{onClick:async()=>{if(i){c(!0),p({current:0,total:100,status:"准备导入..."});try{const t=await i.text(),s=await fetch("/api/v1/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({format:n,content:t,options:j})});if(!s.ok){const e=await s.json();throw new Error(e.message||"导入失败")}const r=await s.json();g(r),null==e||e(r)}catch(t){g({success:0,failed:1,skipped:0,total:1,errors:[{index:0,item:{title:"",url:"",tags:[]},error:t instanceof Error?t.message:"未知错误",code:"UNKNOWN_ERROR"}],created_bookmarks:[],created_tags:[]})}finally{c(!1),p(null)}}},disabled:!i||!(null==b?void 0:b.valid)||o||d,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 sm:py-2 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation",children:[o?s.jsx(ke,{className:"h-4 w-4 animate-spin"}):s.jsx(Be,{className:"h-4 w-4"}),s.jsx("span",{children:o?"导入中...":"开始导入"})]})})]})}function Va(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function Xa(){var e;const t=x(),r=n(),[a,i]=m.useState("export"),[l,o]=m.useState(null),c=[{id:"export",label:"导出数据",icon:ie,description:"将书签数据导出为文件"},{id:"import",label:"导入数据",icon:Be,description:"从文件导入书签数据"}];return s.jsxs("div",{className:"min-h-screen bg-background pb-16 sm:pb-0",children:[s.jsx("div",{className:"bg-card border-b border-border",children:s.jsx("div",{className:"max-w-4xl mx-auto px-3 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center justify-between h-14 sm:h-16",children:[s.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[s.jsx("button",{onClick:()=>t(-1),className:"p-2 text-muted-foreground hover:text-foreground rounded-md hover:bg-muted touch-manipulation transition-colors",children:s.jsx(W,{className:"h-5 w-5 sm:h-5 sm:w-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-foreground",children:"数据管理"}),s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground hidden sm:block",children:"导入和导出您的书签数据"})]})]}),l&&s.jsxs("div",{className:"hidden md:flex items-center space-x-2 text-sm text-muted-foreground",children:[s.jsx(_e,{className:"h-4 w-4"}),s.jsxs("span",{children:["最近操作: ","export"===l.type?"导出":"导入","(",l.timestamp,")"]})]})]})})}),s.jsxs("div",{className:"max-w-4xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-8",children:[s.jsxs("div",{className:"mb-4 sm:mb-6 md:mb-8",children:[s.jsx("div",{className:"border-b border-border",children:s.jsx("nav",{className:"-mb-px flex space-x-2 sm:space-x-6 md:space-x-8 overflow-x-auto scrollbar-hide",children:c.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>i(e.id),className:"group inline-flex items-center py-3 sm:py-4 px-3 sm:px-2 md:px-1 border-b-2 font-medium whitespace-nowrap touch-manipulation transition-colors duration-200 "+(a===e.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted"),children:[s.jsx(t,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0 "+(a===e.id?"text-primary":"text-muted-foreground group-hover:text-foreground")}),s.jsx("span",{className:"text-sm sm:text-base font-medium",children:e.label})]},e.id)})})}),s.jsx("div",{className:"mt-2 sm:mt-3 md:mt-4 px-1",children:s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:null==(e=c.find(e=>e.id===a))?void 0:e.description})})]}),s.jsx("div",{className:"card shadow-float",children:s.jsxs("div",{className:"p-4 sm:p-6",children:["export"===a&&s.jsx(Ga,{onExport:(e,t)=>{o({type:"export",timestamp:(new Date).toLocaleString(),details:`导出为 ${e.toUpperCase()} 格式${t.include_tags?"，包含标签":""}${t.include_metadata?"，包含元数据":""}`})}}),"import"===a&&s.jsx(Ha,{onImport:e=>{o({type:"import",timestamp:(new Date).toLocaleString(),details:`成功导入 ${e.success} 个书签，创建 ${e.created_tags.length} 个标签${e.failed>0?`，${e.failed} 个失败`:""}`}),r.invalidateQueries({queryKey:[jt]}),r.invalidateQueries({queryKey:[dt]})}})]})}),l&&s.jsx("div",{className:"mt-6 sm:mt-8 card shadow-float",children:s.jsxs("div",{className:"p-4 sm:p-6",children:[s.jsx("h3",{className:"text-base sm:text-lg font-medium text-foreground mb-3 sm:mb-4",children:"最近操作"}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-8 sm:h-8 rounded-full flex items-center justify-center "+("export"===l.type?"bg-primary/10 text-primary":"bg-success/10 text-success"),children:"export"===l.type?s.jsx(ie,{className:"h-4 w-4"}):s.jsx(Be,{className:"h-4 w-4"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-2",children:[s.jsx("span",{className:"font-medium text-foreground text-sm sm:text-base",children:"export"===l.type?"数据导出":"数据导入"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground mt-1 sm:mt-0",children:l.timestamp})]}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1 break-words",children:l.details})]})]})]})}),s.jsx("div",{className:"mt-4 sm:mt-6 md:mt-8 bg-primary/5 rounded-lg border border-primary/20",children:s.jsxs("div",{className:"p-3 sm:p-4 md:p-6",children:[s.jsx("h3",{className:"text-sm sm:text-base md:text-lg font-semibold text-foreground mb-3 sm:mb-4",children:"使用说明"}),s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"text-sm font-semibold text-foreground flex items-center",children:[s.jsx("span",{className:"w-2 h-2 bg-primary rounded-full mr-2 flex-shrink-0"}),"导出功能"]}),s.jsxs("div",{className:"ml-4 space-y-1.5",children:[s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-primary rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"支持 JSON 和 HTML 两种格式"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-primary rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"JSON 格式包含完整数据，适合备份和迁移"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-primary rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"HTML 格式兼容浏览器，可直接导入其他浏览器"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-primary rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"可选择包含标签、元数据等信息"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"text-sm font-semibold text-foreground flex items-center",children:[s.jsx("span",{className:"w-2 h-2 bg-success rounded-full mr-2 flex-shrink-0"}),"导入功能"]}),s.jsxs("div",{className:"ml-4 space-y-1.5",children:[s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-success rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"支持从浏览器导出的 HTML 书签文件"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-success rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"支持 JSON 格式的书签数据"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-success rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"自动检测和跳过重复书签"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-success rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"可将文件夹结构转换为标签"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-success rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"支持批量处理大文件"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"text-sm font-semibold text-foreground flex items-center",children:[s.jsx("span",{className:"w-2 h-2 bg-warning rounded-full mr-2 flex-shrink-0"}),"注意事项"]}),s.jsxs("div",{className:"ml-4 space-y-1.5",children:[s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-warning rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"导入前建议先导出当前数据作为备份"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-warning rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"大文件导入可能需要较长时间，请耐心等待"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-warning rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"导入过程中请勿关闭页面"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"w-1 h-1 bg-warning rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"如遇到问题，可查看错误详情进行排查"})]})]})]})]})]})})]})]})}function Ya(){return s.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"浏览器权限设置"}),s.jsx("p",{className:"text-muted-foreground",children:"配置 TMarks 所需的浏览器权限，以获得最佳使用体验"})]}),s.jsx("div",{className:"card p-6 mb-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:s.jsx(oe,{className:"w-6 h-6 text-primary"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"弹窗权限"}),s.jsx("p",{className:"text-muted-foreground",children:'允许 TMarks 打开弹窗，以便使用"一键打开全部标签页"功能。'})]})]})}),s.jsx("div",{className:"card p-6 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[s.jsx(je,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"如何允许弹窗？"}),s.jsxs("ol",{className:"space-y-3 text-sm text-muted-foreground",children:[s.jsxs("li",{className:"flex gap-2",children:[s.jsx("span",{className:"font-semibold text-foreground",children:"1."}),s.jsx("span",{children:'在标签页组详情页面，点击"全部恢复"按钮'})]}),s.jsxs("li",{className:"flex gap-2",children:[s.jsx("span",{className:"font-semibold text-foreground",children:"2."}),s.jsx("span",{children:"浏览器地址栏会出现弹窗拦截图标（通常在右侧）"})]}),s.jsxs("li",{className:"flex gap-2",children:[s.jsx("span",{className:"font-semibold text-foreground",children:"3."}),s.jsx("span",{children:'点击该图标，选择"始终允许 [网站] 显示弹出式窗口"'})]}),s.jsxs("li",{className:"flex gap-2",children:[s.jsx("span",{className:"font-semibold text-foreground",children:"4."}),s.jsx("span",{children:'刷新页面后，再次点击"全部恢复"即可正常使用'})]})]})]})]})}),s.jsx("div",{className:"card p-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Q,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"各浏览器设置方法"}),s.jsxs("div",{className:"space-y-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-foreground mb-1",children:"Chrome / Edge"}),s.jsxs("p",{className:"text-muted-foreground",children:["地址栏右侧会出现 ",s.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-muted text-foreground font-mono text-xs",children:"🚫"}),' 图标， 点击后选择"始终允许弹出式窗口和重定向"']})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-foreground mb-1",children:"Firefox"}),s.jsx("p",{className:"text-muted-foreground",children:'地址栏左侧会出现弹窗拦截提示，点击"选项" → "允许 [网站] 的弹出式窗口"'})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-foreground mb-1",children:"Safari"}),s.jsx("p",{className:"text-muted-foreground",children:'菜单栏：Safari → 设置 → 网站 → 弹出式窗口 → 找到当前网站 → 选择"允许"'})]})]})]})]})}),s.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-foreground mb-2",children:"💡 为什么需要弹窗权限？"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:'"一键打开全部标签页"功能需要同时打开多个网页。浏览器为了安全考虑，默认会拦截批量打开的弹窗。 允许 TMarks 的弹窗权限后，您就可以一次性打开标签页组中的所有网页，大大提高工作效率。'})]})]})}const Ja=["list","minimal","card","title"],Qa={all:"全部书签",public:"仅公开",private:"仅私密"},Za=["all","public","private"];function ei({mode:e}){return"card"===e?s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 5a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5h6v6h-6zM4 15h6v6H4zM14 15h6v6h-6z"})}):"minimal"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 5.5v13M17 5.5v13"})]}):"title"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h8M4 12h12M4 18h10"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5v2M18 11v2M16 17v2"})]}):s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 4h18l-7 8v6l-4 2v-8L3 4z"})})}function ti({filter:e}){return"public"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):"private"===e?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:[s.jsx("rect",{x:"4",y:"10",width:"16",height:"10",rx:"2",ry:"2"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10V7a4 4 0 118 0v3"})]}):s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}function si(){var e,t,n;const{slug:a=""}=j(),[i,l]=m.useState([]),[o,c]=m.useState([]),[d,u]=m.useState(""),[x,h]=m.useState(""),[p,f]=m.useState("card"),[g,v]=m.useState("popular"),[y,w]=m.useState("all"),[N,k]=m.useState("grid"),[C,S]=m.useState(!1),[M,T]=m.useState(1),E=m.useRef(null),_=m.useRef(null),L=m.useRef(null),D=m.useRef(null),R=m.useRef(null),[I,z]=m.useState(null),[O,A]=m.useState(null),[$,B]=m.useState(!1),[P,W]=m.useState(!1),F=m.useRef(null),G=m.useRef(null),K=function(e,t){return r({queryKey:["public-share",e],queryFn:()=>za.getPublicShare(e),enabled:t&&Boolean(e),staleTime:6e4})}(a,Boolean(a)),U=m.useMemo(()=>{var e;return(null==(e=K.data)?void 0:e.bookmarks)||[]},[null==(e=K.data)?void 0:e.bookmarks]),[q,H]=m.useState("usage");m.useEffect(()=>(E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{c(i)},300),()=>{E.current&&clearTimeout(E.current)}),[i]),m.useEffect(()=>{const e=setTimeout(()=>{h(d)},500);return()=>clearTimeout(e)},[d]);const V=m.useMemo(()=>"all"===y?U:"public"===y?U.filter(e=>e.is_public):U.filter(e=>!e.is_public),[U,y]),X=m.useMemo(()=>0===i.length?V:V.filter(e=>{var t;const s=(null==(t=e.tags)?void 0:t.map(e=>e.id))||[];return i.every(e=>s.includes(e))}),[V,i]),Y=m.useMemo(()=>{const e=V,t=o.length?e.filter(e=>{var t;const s=(null==(t=e.tags)?void 0:t.map(e=>e.id))||[];return o.every(e=>s.includes(e))}):e;return[...x.trim()?t.filter(e=>{const t=x.trim().toLowerCase();return e.title.toLowerCase().includes(t)||(e.description||"").toLowerCase().includes(t)||e.url.toLowerCase().includes(t)}):t].sort((e,t)=>{switch(g){case"updated":return new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime();case"pinned":return e.is_pinned!==t.is_pinned?Number(t.is_pinned)-Number(e.is_pinned):new Date(t.created_at).getTime()-new Date(e.created_at).getTime();case"popular":return(t.click_count||0)!==(e.click_count||0)?(t.click_count||0)-(e.click_count||0):t.last_clicked_at&&e.last_clicked_at?new Date(t.last_clicked_at).getTime()-new Date(e.last_clicked_at).getTime():0;default:return new Date(t.created_at).getTime()-new Date(e.created_at).getTime()}})},[V,o,x,g]),J=m.useMemo(()=>Y.slice(0,30*M),[Y,M]),Q=J.length<Y.length,Z=Math.min(30,Y.length-30*(M-1)),ee=null==(t=K.data)?void 0:t.profile,te=m.useMemo(()=>{var e;const t=[...(null==(e=K.data)?void 0:e.tags)||[]];return"name"===q?t.sort((e,t)=>e.name.localeCompare(t.name,"zh-CN")):t.sort((e,t)=>(t.bookmark_count||0)-(e.bookmark_count||0))},[null==(n=K.data)?void 0:n.tags,q]);m.useEffect(()=>{T(1)},[o,x,g,y]),m.useEffect(()=>{const e=e=>{var t,s,r,n;const a=e.target;!$||(null==(t=_.current)?void 0:t.contains(a))||(null==(s=D.current)?void 0:s.contains(a))||(B(!1),z(null)),!P||(null==(r=L.current)?void 0:r.contains(a))||(null==(n=R.current)?void 0:n.contains(a))||(W(!1),A(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[$,P]),m.useEffect(()=>(F.current&&(clearTimeout(F.current),F.current=null),i.length>0&&(F.current=setTimeout(()=>{l([])},3e4)),()=>{F.current&&(clearTimeout(F.current),F.current=null)}),[i]),m.useEffect(()=>(G.current&&(clearTimeout(G.current),G.current=null),d.trim()&&(G.current=setTimeout(()=>{u("")},15e3)),()=>{G.current&&(clearTimeout(G.current),G.current=null)}),[d]);const se="undefined"!=typeof document&&P&&O?b.createPortal(s.jsx("div",{ref:e=>{R.current=e},className:"rounded-lg border border-border shadow-lg overflow-hidden",style:{position:"absolute",top:O.top,left:O.left,width:O.width??180,backgroundColor:"var(--card)",zIndex:1e3},children:Za.map(e=>s.jsxs("button",{type:"button",onClick:()=>(w(e),W(!1),A(null),void(R.current=null)),className:"w-full px-3 py-2 text-sm flex items-center gap-2 transition-colors "+(y===e?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:bg-muted"),children:[s.jsx(ti,{filter:e}),s.jsx("span",{children:Qa[e]})]},e))}),document.body):null,re="undefined"!=typeof document&&$&&I?b.createPortal(s.jsx("div",{ref:e=>{D.current=e},className:"rounded-lg border border-border shadow-lg overflow-hidden",style:{position:"absolute",top:I.top,left:I.left,width:I.width??200,backgroundColor:"var(--card)",zIndex:1e3},children:Ja.map(e=>s.jsxs("button",{type:"button",onClick:()=>(f(e),B(!1),z(null),void(D.current=null)),className:"w-full px-3 py-2 text-sm flex items-center gap-2 transition-colors "+(p===e?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:bg-muted"),children:[s.jsx(ei,{mode:e}),s.jsx("span",{children:"list"===e?"列表视图":"card"===e?"卡片视图":"minimal"===e?"极简列表":"标题瀑布"})]},e))}),document.body):null;return s.jsxs(s.Fragment,{children:[se,re,s.jsxs("div",{className:"w-full mx-auto py-3 sm:py-4 md:py-6 px-3 sm:px-4 md:px-6",children:[K.isLoading&&s.jsx("div",{className:"text-center text-muted-foreground py-24",children:"正在加载公开书签..."}),K.isError&&!K.isLoading&&s.jsx("div",{className:"text-center text-muted-foreground py-24",children:"分享链接无效或内容已下线。"}),!K.isLoading&&!K.isError&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-3 sm:gap-4 md:gap-6",children:[s.jsx("aside",{className:"hidden lg:block lg:col-span-3 order-2 lg:order-1 fixed top-[calc(5rem+0.75rem)] sm:top-[calc(5rem+1rem)] md:top-[calc(5rem+1.5rem)] left-3 sm:left-4 md:left-6 bottom-3 w-[calc(25%-1.5rem)] z-40",children:s.jsx(gt,{selectedTags:i,onTagsChange:l,bookmarks:X,isLoadingBookmarks:K.isLoading,tagLayout:N,onTagLayoutChange:k,readOnly:!0,availableTags:te,tagSortBy:q,onTagSortChange:H})}),s.jsx("main",{className:"lg:col-span-9 lg:col-start-4 order-1 lg:order-2",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-5",children:[s.jsx("div",{className:"card shadow-float",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-primary",children:(null==ee?void 0:ee.title)||`${(null==ee?void 0:ee.username)||"访客"}的书签精选`}),(null==ee?void 0:ee.description)&&s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:ee.description})]}),U.length>0&&s.jsx("div",{className:"text-sm text-muted-foreground",children:Y.length===U.length?s.jsxs("span",{children:["共 ",U.length," 个书签"]}):s.jsxs("span",{children:["筛选出 ",Y.length," / ",U.length," 个书签"]})})]})}),s.jsx("div",{className:"card shadow-float",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 w-full sm:min-w-[280px]",children:[s.jsx("button",{onClick:()=>S(!0),className:"lg:hidden w-11 h-11 rounded-xl flex items-center justify-center transition-all shadow-float bg-card border border-border hover:bg-muted hover:border-primary/30 text-foreground",title:"打开标签","aria-label":"打开标签",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}),s.jsxs("div",{className:"relative flex-1",children:[s.jsx("svg",{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),s.jsx("input",{type:"text",className:"input w-full pl-10 sm:pl-12 h-11 sm:h-auto text-sm sm:text-base",placeholder:"搜索书签标题、描述或URL...",value:d,onChange:e=>u(e.target.value)})]})]}),s.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[s.jsx("div",{className:"relative flex-1 sm:flex-initial",children:s.jsx(Ot,{value:g,onChange:v,className:"w-full sm:w-auto"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"relative",children:s.jsx("button",{ref:L,onClick:()=>{W(e=>{const t=!e;if(t){if(L.current){const e=L.current.getBoundingClientRect(),t=Math.max(e.width+100,160),s=window.scrollX+window.innerWidth-t-12,r=Math.min(e.left+window.scrollX,s);A({top:e.bottom+window.scrollY+8,left:r,width:t})}B(!1),z(null)}else A(null);return t})},className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center transition-all shadow-float touch-manipulation "+("all"===y?"bg-muted text-foreground hover:bg-muted/80":"public"===y?"bg-success/10 text-success hover:bg-success/20":"bg-warning/10 text-warning hover:bg-warning/20"),title:`${Qa[y]}筛选`,"aria-label":`${Qa[y]}筛选`,type:"button",children:s.jsx(ti,{filter:y})})}),s.jsx("div",{className:"relative",children:s.jsx("button",{ref:_,onClick:()=>{B(e=>{const t=!e;if(t){if(_.current){const e=_.current.getBoundingClientRect(),t=Math.max(e.width+110,180),s=window.scrollX+window.innerWidth-t-12,r=Math.min(e.left+window.scrollX,s);z({top:e.bottom+window.scrollY+8,left:r,width:t})}W(!1),A(null)}else z(null);return t})},className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center transition-all shadow-float bg-muted text-foreground hover:bg-muted/80 touch-manipulation",title:"切换视图","aria-label":"切换视图",type:"button",children:s.jsx(ei,{mode:p})})})]})]})]})}),J.length>0?s.jsxs(s.Fragment,{children:[s.jsx(Dt,{bookmarks:J,viewMode:p,readOnly:!0}),s.jsx(It,{hasMore:Q,isLoading:!1,onLoadMore:()=>{T(e=>e+1)},currentCount:Z,totalLoaded:J.length})]}):!K.isLoading&&U.length>0?s.jsx("div",{className:"card text-center py-12",children:s.jsxs("div",{className:"text-muted-foreground mb-2",children:[s.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),s.jsx("p",{className:"text-lg font-medium",children:"没有找到匹配的书签"}),s.jsx("p",{className:"text-sm mt-2",children:"尝试调整筛选条件或搜索关键词"})]})}):null]})})]}),C&&s.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:()=>S(!1)}),s.jsxs("div",{className:"absolute left-0 top-0 bottom-0 w-80 max-w-[85vw] bg-background border-r border-border shadow-xl animate-in slide-in-from-left duration-300",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border bg-background",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"标签筛选"}),s.jsx("button",{onClick:()=>S(!1),className:"w-8 h-8 rounded-lg flex items-center justify-center hover:bg-muted transition-colors","aria-label":"关闭标签抽屉",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-background",children:s.jsx(gt,{selectedTags:i,onTagsChange:e=>{l(e),e.length>=2&&e.length>i.length&&setTimeout(()=>S(!1),500)},tagLayout:N,onTagLayoutChange:k,bookmarks:X,isLoadingBookmarks:K.isLoading,readOnly:!0,availableTags:te,tagSortBy:q,onTagSortChange:H})})]})]})]})]})}function ri(){return s.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-float",children:s.jsx(J,{className:"w-12 h-12",style:{color:"var(--foreground)"}})}),s.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--foreground)"},children:"TMarks 浏览器插件"}),s.jsx("p",{className:"text-lg",style:{color:"var(--muted-foreground)"},children:"一键保存标签页组，让书签管理更高效"})]}),s.jsxs("div",{className:"card shadow-float mb-8 text-center bg-gradient-to-br from-primary/5 to-secondary/5",children:[s.jsxs("button",{onClick:()=>{const e=document.createElement("a");e.href="/tmarks-extension.zip",e.download="tmarks-extension.zip",document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"inline-flex items-center gap-3 px-8 py-4 rounded-xl bg-gradient-to-br from-primary to-secondary text-lg font-semibold shadow-lg hover:shadow-xl transition-all hover:scale-105 active:scale-95",style:{color:"var(--primary-content)"},children:[s.jsx(ie,{className:"w-6 h-6"}),"下载插件 (Chrome/Edge)"]}),s.jsx("p",{className:"text-sm mt-4",style:{color:"var(--muted-foreground)"},children:"支持 Chrome、Edge 及其他 Chromium 内核浏览器"}),s.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:s.jsx("p",{className:"text-xs",style:{color:"var(--muted-foreground)"},children:"版本：1.0.0 | 大小：约 270 KB | 更新时间：2024-10-26"})})]}),s.jsxs("div",{className:"card shadow-float mb-8",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",style:{color:"var(--foreground)"},children:"✨ 主要功能"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ee,{className:"w-5 h-5 mt-0.5 flex-shrink-0 text-success"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",style:{color:"var(--foreground)"},children:"一键保存标签页组"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"将当前浏览器打开的所有标签页一键保存到 TMarks，包括标题、URL 和网站图标"})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ee,{className:"w-5 h-5 mt-0.5 flex-shrink-0 text-success"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",style:{color:"var(--foreground)"},children:"快速恢复标签页"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"从 TMarks 网站一键恢复之前保存的标签页组，继续之前的工作"})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ee,{className:"w-5 h-5 mt-0.5 flex-shrink-0 text-success"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",style:{color:"var(--foreground)"},children:"自动同步"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"标签页组自动同步到云端，多设备无缝切换"})]})]})]})]}),s.jsxs("div",{className:"card shadow-float mb-8",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",style:{color:"var(--foreground)"},children:"📦 安装步骤"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-bold text-primary",children:"1"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"下载插件压缩包"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"点击上方下载按钮，获取 tmarks-extension.zip 文件"})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-bold text-primary",children:"2"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"解压文件"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"将下载的 zip 文件解压到任意文件夹（建议放在不会删除的位置）"})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-bold text-primary",children:"3"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"打开扩展管理页面"}),s.jsx("p",{className:"text-sm mb-2",style:{color:"var(--muted-foreground)"},children:"在浏览器地址栏输入："}),s.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 font-mono text-sm",children:[s.jsx("p",{className:"mb-1",children:"Chrome: chrome://extensions/"}),s.jsx("p",{children:"Edge: edge://extensions/"})]})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-bold text-primary",children:"4"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"启用开发者模式"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:'在扩展管理页面右上角，打开"开发者模式"开关'})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-bold text-primary",children:"5"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"加载插件"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:'点击"加载已解压的扩展程序"，选择刚才解压的文件夹'})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-bold text-primary",children:"6"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"完成安装"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"插件图标会出现在浏览器工具栏，点击即可使用"})]})]})]})]}),s.jsx("div",{className:"card shadow-float bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20 mb-8",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Q,{className:"w-5 h-5 mt-0.5 flex-shrink-0 text-primary"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",style:{color:"var(--foreground)"},children:"💡 使用提示"}),s.jsxs("ul",{className:"text-sm space-y-1",style:{color:"var(--muted-foreground)"},children:[s.jsx("li",{children:"• 首次使用需要在插件中配置 TMarks 网站地址和 API Key"}),s.jsx("li",{children:'• API Key 可以在网站的"API Keys"页面创建'}),s.jsx("li",{children:"• 建议将插件图标固定到工具栏，方便快速访问"}),s.jsx("li",{children:"• 插件会自动保存标签页的标题、URL 和网站图标"})]})]})]})}),s.jsxs("div",{className:"card shadow-float",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",style:{color:"var(--foreground)"},children:"❓ 常见问题"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"Q: 插件安装后找不到图标？"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"A: 点击浏览器工具栏右侧的拼图图标，找到 TMarks 插件并点击固定按钮，图标就会显示在工具栏上。"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"Q: 如何获取 API Key？"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:'A: 登录 TMarks 网站后，点击右上角用户菜单中的"API Keys"，创建一个新的 API Key 并复制到插件配置中。'})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"Q: 插件支持哪些浏览器？"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:"A: 支持所有基于 Chromium 内核的浏览器，包括 Chrome、Edge、Brave、Opera 等。"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-1",style:{color:"var(--foreground)"},children:"Q: 保存的标签页组在哪里查看？"}),s.jsx("p",{className:"text-sm",style:{color:"var(--muted-foreground)"},children:'A: 在 TMarks 网站的"标签页"页面可以查看和管理所有保存的标签页组。'})]})]})]})]})}function ni(){return s.jsxs(y,{children:[s.jsx(w,{path:"/login",element:s.jsx(lt,{})}),s.jsx(w,{path:"/register",element:s.jsx(ot,{})}),s.jsx(w,{element:s.jsx(at,{}),children:s.jsx(w,{path:"/share/:slug",element:s.jsx(si,{})})}),s.jsx(w,{element:s.jsx(it,{}),children:s.jsxs(w,{element:s.jsx(nt,{}),children:[s.jsx(w,{path:"/",element:s.jsx(Xt,{})}),s.jsx(w,{path:"/tab",element:s.jsx(ha,{})}),s.jsx(w,{path:"/tab/trash",element:s.jsx(fa,{})}),s.jsx(w,{path:"/tab/statistics",element:s.jsx(ga,{})}),s.jsx(w,{path:"/tab/:id",element:s.jsx(pa,{})}),s.jsx(w,{path:"/api-keys",element:s.jsx(Ra,{})}),s.jsx(w,{path:"/share-settings",element:s.jsx(Aa,{})}),s.jsx(w,{path:"/import-export",element:s.jsx(Xa,{})}),s.jsx(w,{path:"/permissions",element:s.jsx(Ya,{})}),s.jsx(w,{path:"/extension",element:s.jsx(ri,{})}),s.jsx(w,{path:"*",element:s.jsx(f,{to:"/",replace:!0})})]})})]})}const ai={success:ee,error:Q,info:je,warning:$e},ii={success:{bg:"bg-success/10",border:"border-success/20",icon:"text-success",text:"text-success-foreground"},error:{bg:"bg-destructive/10",border:"border-destructive/20",icon:"text-destructive",text:"text-destructive-foreground"},info:{bg:"bg-primary/10",border:"border-primary/20",icon:"text-primary",text:"text-foreground"},warning:{bg:"bg-warning/10",border:"border-warning/20",icon:"text-warning",text:"text-warning-foreground"}};function li({id:e,type:t,message:r,duration:n=3e3,onClose:a}){const i=ai[t],l=ii[t];return m.useEffect(()=>{if(n>0){const t=setTimeout(()=>{a(e)},n);return()=>clearTimeout(t)}},[e,n,a]),s.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-lg border-2 shadow-lg ${l.bg} ${l.border} min-w-[320px] max-w-md animate-slide-in`,children:[s.jsx(i,{className:`w-5 h-5 ${l.icon} flex-shrink-0 mt-0.5`}),s.jsx("p",{className:`flex-1 text-sm ${l.text}`,children:r}),s.jsx("button",{onClick:()=>a(e),className:`${l.icon} hover:opacity-70 transition-opacity flex-shrink-0`,children:s.jsx(We,{className:"w-5 h-5"})})]})}function oi({toasts:e,onClose:t}){return s.jsx("div",{className:"fixed top-4 right-4 z-[100] flex flex-col gap-2",children:e.map(e=>s.jsx(li,{...e,onClose:t},e.id))})}const ci=new o({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:3e5}}});function di(){const{user:e,isAuthenticated:t,accessToken:r,refreshToken:n,clearAuth:a,refreshAccessToken:i}=et(),{toasts:l,removeToast:o}=ca(),{theme:d,colorTheme:u}=qe(),x=m.useRef(void 0);m.useEffect(()=>{const e=document.documentElement;e.setAttribute("data-theme",d),e.setAttribute("data-color-theme",u)},[d,u]),m.useEffect(()=>{t&&!r&&(n?i().catch(()=>{a()}):a())},[t,r,n,i,a]);const h=(null==e?void 0:e.id)??null;return m.useEffect(()=>{void 0!==x.current?x.current!==h&&(ci.clear(),x.current=h):x.current=h},[h]),s.jsx(c,{client:ci,children:s.jsxs(N,{children:[s.jsx(ni,{}),s.jsx(oi,{toasts:l,onClose:o})]})})}R.createRoot(document.getElementById("root")).render(s.jsx(v.StrictMode,{children:s.jsx(di,{})}));
